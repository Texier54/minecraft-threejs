var Ms=Object.defineProperty;var Di=t=>{throw TypeError(t)};var Ns=(t,i,e)=>i in t?Ms(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var y=(t,i,e)=>Ns(t,typeof i!="symbol"?i+"":i,e),Ps=(t,i,e)=>i.has(t)||Di("Cannot "+e);var ft=(t,i,e)=>(Ps(t,i,"read from private field"),e?e.call(t):i.get(t)),zi=(t,i,e)=>i.has(t)?Di("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e);import{V as S,C as Hs,E as Z,P as Us,M as F,a as Fs,b as Te,B as $,T as ii,S as Dn,N as At,c as w,R as qs,d as zn,g as H,e as E,f as kt,Q as ni,G as at,I as Zs,h as $s,i as Ks,j as js,k as Vs,D as Gs,l as Ys,A as Xs,m as Ws,n as Js,F as Qs,W as eo,o as to,p as io,q as no}from"./smelting-B9EyUaOG.js";const Ie=new Z(0,0,0,"YXZ"),Ae=new S,so={type:"change"},oo={type:"lock"},ro={type:"unlock"},Oi=Math.PI/2;class ao extends Hs{constructor(i,e=null){super(i,e),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=co.bind(this),this._onPointerlockChange=lo.bind(this),this._onPointerlockError=ho.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(i){return i.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(i){if(this.enabled===!1)return;const e=this.object;Ae.setFromMatrixColumn(e.matrix,0),Ae.crossVectors(e.up,Ae),e.position.addScaledVector(Ae,i)}moveRight(i){if(this.enabled===!1)return;const e=this.object;Ae.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(Ae,i)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function co(t){if(this.enabled===!1||this.isLocked===!1)return;const i=this.object;Ie.setFromQuaternion(i.quaternion),Ie.y-=t.movementX*.002*this.pointerSpeed,Ie.x-=t.movementY*.002*this.pointerSpeed,Ie.x=Math.max(Oi-this.maxPolarAngle,Math.min(Oi-this.minPolarAngle,Ie.x)),i.quaternion.setFromEuler(Ie),this.dispatchEvent(so)}function lo(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(oo),this.isLocked=!0):(this.dispatchEvent(ro),this.isLocked=!1)}function ho(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}var De;class fo{constructor(i,e,n){y(this,"radius",.5);y(this,"height",1.8);y(this,"maxSpeed",10);y(this,"jumpSpeed",10);y(this,"onGround",!1);y(this,"input",new S);y(this,"velocity",new S(0,0,0));zi(this,De,new S);y(this,"camera",new Us(75,window.innerWidth/window.innerHeight,.1,100));y(this,"controls",new ao(this.camera,document.body));y(this,"selectedCoords",null);y(this,"selectedCoordsNormal",null);this.socket=n,this.position.set(10,120,10),i.add(this.camera),this.scene=i,this.world=e,window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),this.boundsHelper=new F(new Fs(this.radius,this.radius,this.height,16),new Te({wireframe:!0}));const s=new $(.1,.1,.3),o=new ii().load("images/hand.png");o.colorSpace=Dn,o.magFilter=At,o.minFilter=At;const r=new Te({map:o});this.handMesh=new F(s,r),this.handMesh.position.set(.4,-.25,-.4),this.handMesh.rotation.x=.6,this.handMesh.rotation.z=-.4,this.handMesh.rotation.y=-.5,i.add(this.handMesh),this.camera.add(this.handMesh),this.punchDirection=1;const a=new Te({color:0,transparent:!0,opacity:.2}),h=new ii().load("images/break.png"),c=new w({map:h,transparent:!0}),l=new $(1.01,1.01,1.01);this.selectionBreakHelper=new F(l,c),this.scene.add(this.selectionBreakHelper);const u=new $(1.01,1.01,1.01);this.selectionHelper=new F(u,a),i.add(this.selectionHelper),this.raycaster=new qs,this.mouse=new zn,this.raycaster.far=5,document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),this.isDestroying=!1}getPlacementDirection(i){let e=new S;this.camera.getWorldDirection(e);const n=Math.max(Math.abs(e.x),0,Math.abs(e.z));let o=new S(Math.abs(e.x)===n?Math.sign(e.x):0,0,Math.abs(e.z)===n?Math.sign(e.z):0).negate();return o.x===1?{x:1,y:0,z:0}:o.x===-1?{x:-1,y:0,z:0}:o.z===1?{x:0,y:0,z:1}:o.z===-1?{x:0,y:0,z:-1}:{x:0,y:1,z:0}}onMouseDown(i){var n,s,o;if(this.controls.isLocked&&(this.isMouseDown=!0,this.animateHand(),this.selectedCoords))if(i.button==2){const r=this.world.getBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z);if(((n=this.inventory.getSelectedItem())==null?void 0:n.block)!==void 0&&H(r.id).interface!==!0&&H((s=this.inventory.getSelectedItem())==null?void 0:s.block).type==="block"){this.world.addBlock(this.selectedCoordsNormal.x,this.selectedCoordsNormal.y,this.selectedCoordsNormal.z,this.inventory.getSelectedItem().block,this.getPlacementDirection(this.selectedNormal)),this.inventory.removeBlock(this.inventory.getSelectedItem().block);var e=new Audio("audio/dirt1.ogg");e.play(),(o=this.socket.getSocket())==null||o.emit("addBlock",{x:this.selectedCoordsNormal.x,y:this.selectedCoordsNormal.y,z:this.selectedCoordsNormal.z,blockId:this.inventory.getSelectedItem().block})}else H(r.id).interface===!0&&this.ui.open(r.id)}else this.startDestroyingBlock(i)}startDestroyingBlock(i){var l,u;if(!this.isMouseDown||!this.selectedCoords)return;let e=0;const n=this.world.getBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z);console.log(n);let s=H(n.id).hardness*1e3,o=1;s*=1.5;const r=(l=this.inventory.getSelectedItem())==null?void 0:l.block;let a=null;r&&(a=H(r),a.type=="item"&&a.tool_type==H(n.id).tool&&(o=a.tool_material));let h=o/H(n.id).hardness;(u=H(n.id))!=null&&u.need_tool&&!(a&&a.type=="item"&&a.tool_type==H(n.id).tool)?h/=100:h/=30,s=Math.ceil(1/h)/20*1e3,h>1&&(s=0),console.log(s),this.isDestroying=!0,this.animateBlockBreaking(s),this.destructionInterval=setInterval(()=>{var d;if(!this.isMouseDown){clearInterval(this.destructionInterval),this.isDestroying=!1;return}if(e+=100,e>=s){const p=H(n.id);Object.hasOwn(p,"drops")?this.inventory.addBlock(p.drops):this.inventory.addBlock(n.id),this.world.removeBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z),(d=this.socket.getSocket())==null||d.emit("removeBlock",{x:this.selectedCoords.x,y:this.selectedCoords.y,z:this.selectedCoords.z});var f=new Audio("audio/dirt1.ogg");f.play(),this.isDestroying=!1,clearInterval(this.destructionInterval),setTimeout(()=>{this.startDestroyingBlock(i)},200)}},100)}onMouseUp(i){this.controls.isLocked&&i.button!=2&&(this.isDestroying=!1,clearInterval(this.destructionInterval),this.isMouseDown=!1)}animateHand(){this.handMesh.position.y+=this.punchDirection*.02,(this.handMesh.position.y>-.4||this.handMesh.position.y<-.6)&&(this.punchDirection*=-1)}update(i){this.updateRaycaster(i)}updateRaycaster(i){const e=this.raycaster.intersectObjects(i.children,!0);if(this.controls.isLocked)if(this.raycaster.setFromCamera(this.mouse,this.camera),e.length>0){const n=e[0],s=n.object.parent,o=new kt;n.object.getMatrixAt(n.instanceId,o),console.log(o),this.selectedCoords=s.position.clone();const r=new S,a=new ni;o.decompose(r,a,new S),this.selectedCoords.add(r),this.selectedCoords.set(Math.round(this.selectedCoords.x),Math.round(this.selectedCoords.y),Math.round(this.selectedCoords.z)),console.log(this.selectedCoords),this.selectedNormal=n.face.normal.clone(),this.selectedNormal.applyQuaternion(a).normalize(),this.selectedCoordsNormal=this.selectedCoords.clone().add(this.selectedNormal);const h=this.world.getBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z);if(h&&h.id!==E.empty.id){let c=H(h.id).geometry;c.computeBoundingBox();let l=new S;c.boundingBox.getSize(l),this.selectionHelper.scale.set(l.x+.01,l.y+.01,l.z+.01)}this.selectionHelper.position.copy(this.selectedCoords),this.selectionHelper.visible=!0}else this.selectedCoords=null,this.selectionHelper.visible=!1}animateBlockBreaking(i){this.selectionBreakHelper.position.copy(this.selectedCoords),this.selectionBreakHelper.visible=!0;const n=i/6;this.nextStep(n,0)}nextStep(i,e){if(e<=6&&this.isDestroying){const o=e%2,r=Math.floor(e/2);this.selectionBreakHelper.material.map.offset.set(o/2,r/3),this.selectionBreakHelper.material.map.repeat.set(1/2,1/3),e++,setTimeout(this.nextStep.bind(this),i,i,e)}else this.selectionBreakHelper.visible=!1}setBlockInHand(i){const e=H(i);if(e!=null&&e.material){this.scene.remove(this.meshHandItem),this.camera.remove(this.meshHandItem);const n=e.geometry.clone();n.scale(.3,.3,.3),this.meshHandItem=new F(n,e.material),this.meshHandItem.count=0,this.meshHandItem.castShadow=!0,this.meshHandItem.receiveShadow=!0,this.meshHandItem.rotation.x=-.2,this.meshHandItem.rotation.z=0,this.meshHandItem.rotation.y=.6,this.meshHandItem.position.set(.55,-.45,-.5),this.scene.add(this.meshHandItem),this.camera.add(this.meshHandItem),this.handMesh.visible=!1}else this.meshHandItem&&(this.meshHandItem.visible=!1),this.handMesh.visible=!0}get worldVelocity(){return ft(this,De).copy(this.velocity),ft(this,De).applyEuler(new Z(0,this.camera.rotation.y,0)),ft(this,De)}applyWorldDeltaVelocity(i){i.applyEuler(new Z(0,-this.camera.rotation.y,0)),this.velocity.add(i)}applyInputs(i){var e;if(this.controls.isLocked){this.velocity.x=this.input.x,this.velocity.z=this.input.z,this.controls.moveRight(this.velocity.x*i),this.controls.moveForward(this.velocity.z*i),this.position.y+=this.velocity.y*i;let n=this.world.getPlayerBiome(Math.floor(this.position.x),Math.floor(this.position.z));document.getElementById("player-position").innerHTML=this.toString()+" - "+n;const s=new S;this.camera.getWorldDirection(s),(e=this.socket.getSocket())==null||e.emit("playerState",{id:this.socket.id,position:{x:this.position.x,y:this.position.y,z:this.position.z},direction:{x:s.x,y:s.y,z:s.z}})}}updateBoundsHelper(){this.boundsHelper.position.copy(this.position),this.boundsHelper.position.y-=this.height/2}onKeyDown(i){i.code==="ShiftLeft"&&(keys.speed=!0),i.code==="KeyW"&&(this.input.z=this.maxSpeed),i.code==="KeyS"&&(this.input.z=-this.maxSpeed),i.code==="KeyA"&&(this.input.x=-this.maxSpeed),i.code==="KeyD"&&(this.input.x=this.maxSpeed),i.code==="Space"&&this.onGround&&(this.velocity.y+=this.jumpSpeed),i.code==="F5"&&this.camera.position.set(this.camera.position.x,this.camera.position.y+1,this.camera.position.z)}onKeyUp(i){i.code==="KeyW"&&(this.input.z=0),i.code==="KeyS"&&(this.input.z=0),i.code==="KeyA"&&(this.input.x=0),i.code==="KeyD"&&(this.input.x=0)}get position(){return this.camera.position}toString(){let i="";return i+=`X: ${this.position.x.toFixed(3)} `,i+=`Y: ${this.position.y.toFixed(3)} `,i+=`Z: ${this.position.z.toFixed(3)}`,i}save(){(async()=>{new Blob([JSON.stringify(this.position)]).size;const i=this.position;await po(i)})()}load(){(async()=>{const i=await _o();this.position.set(i.x,i.y,i.z)})()}setInventory(i){this.inventory=i}setUI(i){this.ui=i}}De=new WeakMap;const uo="minecraftDB",Ge="minecraftData";function On(){return new Promise((t,i)=>{const e=indexedDB.open(uo,1);e.onupgradeneeded=function(n){n.target.result.createObjectStore(Ge,{keyPath:"id"})},e.onsuccess=function(n){t(n.target.result)},e.onerror=function(n){i(n.target.error)}})}async function po(t){const e=(await On()).transaction([Ge],"readwrite");return e.objectStore(Ge).put({id:"minecraft_player_position",data:t}),e.complete}async function _o(){const t=await On();return new Promise((i,e)=>{const o=t.transaction([Ge],"readonly").objectStore(Ge).get("minecraft_player_position");o.onsuccess=function(){var r;i(((r=o.result)==null?void 0:r.data)||null)},o.onerror=function(r){e(r.target.error)}})}class mo{constructor(i){y(this,"m_w",123456789);y(this,"m_z",987654321);y(this,"mask",4294967295);this.m_w=123456789+i&this.mask,this.m_z=987654321-i&this.mask}random(){this.m_z=36969*(this.m_z&65535)+(this.m_z>>16)&this.mask,this.m_w=18e3*(this.m_w&65535)+(this.m_w>>16)&this.mask;let i=(this.m_z<<16)+(this.m_w&65535)>>>0;return i/=4294967296,i}}class Li extends at{constructor(e,n,s){super();y(this,"chunks");y(this,"chunkSize");y(this,"height");y(this,"meshs");y(this,"data",[]);this.chunks=new Map,this.chunkSize=e.width,this.height=e.height,this.params=n,this.dataStore=s,this.biomes=[],this.rng=new mo(this.params.seed)}generate(){if(this.dataStore.contains(this.position.x,this.position.z))this.data=this.dataStore.get(this.position.x,this.position.z),this.generateMesh();else{const e=new Worker(new URL("/minecraft-threejs/assets/chunkWorker-C-rA2S55.js",import.meta.url),{type:"module"});e.onmessage=n=>{const{data:s,biomes:o}=n.data;this.biomes=o,this.data=s,this.dataStore.set(this.position.x,this.position.z,this.data),this.generateMesh(),e.terminate()},e.onerror=n=>{console.error(n),e.terminate()},e.onmessageerror=n=>{console.error("Message error in Worker:",n)},e.postMessage({chunkSize:this.chunkSize,chunkHeight:this.height,params:this.params,position:this.position,rng:this.rng})}}generateMesh(){const e=this.chunkSize*this.chunkSize*40,n={};Object.values(E).filter(o=>o.id!==E.empty.id&&o.type==="block").forEach(o=>{const r=new Zs(o.geometry,o.material,e);r.name=o.id,r.count=0,r.castShadow=!0,r.receiveShadow=!0,n[o.id]=r});const s=new kt;for(let o=0;o<this.chunkSize;o++)for(let r=0;r<this.chunkSize;r++)for(let a=0;a<this.height;a++){const h=this.getBlock(o,a,r);if(!this.isBlockObscured(o,a,r)&&h!=null&&h.id!=E.empty.id){let c=H(h.id).geometry;c.computeBoundingBox();let l=new S;if(c.boundingBox.getSize(l),h.direction){const p=new ni,v=new S(h.direction.x,h.direction.y,h.direction.z);v.equals(new S(1,0,0))?p.setFromEuler(new Z(0,Math.PI/2,0)):v.equals(new S(-1,0,0))?p.setFromEuler(new Z(0,-Math.PI/2,0)):v.equals(new S(0,0,1))?p.setFromEuler(new Z(0,0,0)):v.equals(new S(0,0,-1))?p.setFromEuler(new Z(0,Math.PI,0)):v.equals(new S(0,1,0))?p.setFromEuler(new Z(-Math.PI/2,0,0)):v.equals(new S(0,-1,0))&&p.setFromEuler(new Z(Math.PI/2,0,0)),s.compose(new S(o,a,r),p,new S(1,1,1))}const u=(1-l.y)/2;s.setPosition(o,a-u,r),n[h.id].setMatrixAt(n[h.id].count,s);const d=n[h.id].count;this.setBlockInstanceId(o,a,r,d),n[h.id].count++}}this.meshs=n,this.add(...Object.values(n))}setBlockId(e,n,s,o){this.data[e][n][s].id=o}getBlock(e,n,s){return this.inBounds(e,n,s)&&typeof this.data[e]<"u"?this.data[e][n][s]:null}inBounds(e,n,s){return e>=0&&e<this.chunkSize&&s>=0&&s<this.chunkSize&&n>=0&&n<this.height}setBlockInstanceId(e,n,s,o){this.inBounds(e,n,s)&&(this.data[e][n][s].instanceId=o)}revealBlock(e,n,s){const o=this.worldToChunkCoords(e,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.addBlockInstance(o.block.x,o.block.y,o.block.z)}isBlockObscured(e,n,s){var u,f,d,p,v,m;const o=((u=this.getBlock(e,n+1,s))==null?void 0:u.id)??E.empty.id,r=((f=this.getBlock(e,n-1,s))==null?void 0:f.id)??E.empty.id,a=((d=this.getBlock(e+1,n,s))==null?void 0:d.id)??E.empty.id,h=((p=this.getBlock(e-1,n,s))==null?void 0:p.id)??E.empty.id,c=((v=this.getBlock(e,n,s+1))==null?void 0:v.id)??E.empty.id,l=((m=this.getBlock(e,n,s-1))==null?void 0:m.id)??E.empty.id;return!(o===E.empty.id||r===E.empty.id||a===E.empty.id||h===E.empty.id||c===E.empty.id||l===E.empty.id)}disposeInstances(){this.traverse(e=>{e.dipose&&e.dispose()}),this.clear}addBlock(e,n,s,o,r){this.getBlock(e,n,s).id===E.empty.id&&(this.setBlockId(e,n,s,o),this.setBlockDirection(e,n,s,r),this.addBlockInstance(e,n,s),this.dataStore.set(this.position.x,this.position.z,this.data))}setBlockDirection(e,n,s,o){this.inBounds(e,n,s)&&(this.data[e][n][s].direction=o)}setBlockInventory(e,n,s,o){this.inBounds(e,n,s)&&(this.data[e][n][s].inventory=o)}addBlockInstance(e,n,s){const o=this.getBlock(e,n,s);if(o&&o.id!==E.empty.id&&o.instanceId===null){const r=this.children.find(p=>p.name===o.id),a=r.count++;this.setBlockInstanceId(e,n,s,a);const h=new kt,c=new ni,l=new S(o.direction.x,o.direction.y,o.direction.z);l.equals(new S(1,0,0))?c.setFromEuler(new Z(0,Math.PI/2,0)):l.equals(new S(-1,0,0))?c.setFromEuler(new Z(0,-Math.PI/2,0)):l.equals(new S(0,0,1))?c.setFromEuler(new Z(0,0,0)):l.equals(new S(0,0,-1))?c.setFromEuler(new Z(0,Math.PI,0)):l.equals(new S(0,1,0))?c.setFromEuler(new Z(-Math.PI/2,0,0)):l.equals(new S(0,-1,0))&&c.setFromEuler(new Z(Math.PI/2,0,0)),h.compose(new S(e,n,s),c,new S(1,1,1));let u=H(o.id).geometry;u.computeBoundingBox();let f=new S;u.boundingBox.getSize(f);const d=(1-f.y)/2;if(h.setPosition(e,n-d,s),r.setMatrixAt(a,h),r.instanceMatrix.needsUpdate=!0,r.computeBoundingSphere(),o.id==E.torch.id){const p=new $s(16776928,2,14,.1);p.position.set(e,n+.1,s),p.castShadow=!1,this.add(p)}}}removeBlock(e,n,s){const o=this.getBlock(e,n,s);o&&o.id!==E.empty.id&&(this.deleteBlockInstance(e,n,s),this.setBlockId(e,n,s,E.empty.id),this.dataStore.set(this.position.x,this.position.z,this.data))}deleteBlockInstance(e,n,s){const o=this.getBlock(e,n,s);if(o.id===E.empty.id||o.instanceId===null)return;const r=this.children.find(l=>l.name===o.id),a=o.instanceId,h=new kt;r.getMatrixAt(r.count-1,h);const c=new S;c.applyMatrix4(h),this.setBlockInstanceId(c.x,Math.round(c.y),c.z,a),r.setMatrixAt(a,h),r.count--,r.instanceMatrix.needsUpdate=!0,r.computeBoundingSphere(),this.setBlockInstanceId(e,n,s,null)}getBiome(e,n){return this.inBounds(e,0,n)&&typeof this.data[e]<"u"&&typeof this.biomes[e]<"u"?this.biomes[e][n]:(console.log(this.biomes),null)}}class go{constructor(){this.data={}}clear(){this.data={}}contains(i,e){const n=this.getKey(i,e);return this.data[n]!==void 0}get(i,e){const n=this.getKey(i,e);return this.data[n]}set(i,e,n){const s=this.getKey(i,e);this.data[s]=n}getKey(i,e){return`${i},${e}`}getData(){return this.data}setData(i){this.data=i}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const yo=4,Mi=0,Ni=1,wo=2;function Le(t){let i=t.length;for(;--i>=0;)t[i]=0}const bo=0,Ln=1,ko=2,vo=3,xo=258,wi=29,ct=256,Ye=ct+1+wi,Re=30,bi=19,Mn=2*Ye+1,we=15,Nt=16,Eo=7,ki=256,Nn=16,Pn=17,Hn=18,si=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vt=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),So=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Un=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Io=512,le=new Array((Ye+2)*2);Le(le);const $e=new Array(Re*2);Le($e);const Xe=new Array(Io);Le(Xe);const We=new Array(xo-vo+1);Le(We);const vi=new Array(wi);Le(vi);const Ct=new Array(Re);Le(Ct);function Pt(t,i,e,n,s){this.static_tree=t,this.extra_bits=i,this.extra_base=e,this.elems=n,this.max_length=s,this.has_stree=t&&t.length}let Fn,qn,Zn;function Ht(t,i){this.dyn_tree=t,this.max_code=0,this.stat_desc=i}const $n=t=>t<256?Xe[t]:Xe[256+(t>>>7)],Je=(t,i)=>{t.pending_buf[t.pending++]=i&255,t.pending_buf[t.pending++]=i>>>8&255},j=(t,i,e)=>{t.bi_valid>Nt-e?(t.bi_buf|=i<<t.bi_valid&65535,Je(t,t.bi_buf),t.bi_buf=i>>Nt-t.bi_valid,t.bi_valid+=e-Nt):(t.bi_buf|=i<<t.bi_valid&65535,t.bi_valid+=e)},ne=(t,i,e)=>{j(t,e[i*2],e[i*2+1])},Kn=(t,i)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--i>0);return e>>>1},Ao=t=>{t.bi_valid===16?(Je(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Co=(t,i)=>{const e=i.dyn_tree,n=i.max_code,s=i.stat_desc.static_tree,o=i.stat_desc.has_stree,r=i.stat_desc.extra_bits,a=i.stat_desc.extra_base,h=i.stat_desc.max_length;let c,l,u,f,d,p,v=0;for(f=0;f<=we;f++)t.bl_count[f]=0;for(e[t.heap[t.heap_max]*2+1]=0,c=t.heap_max+1;c<Mn;c++)l=t.heap[c],f=e[e[l*2+1]*2+1]+1,f>h&&(f=h,v++),e[l*2+1]=f,!(l>n)&&(t.bl_count[f]++,d=0,l>=a&&(d=r[l-a]),p=e[l*2],t.opt_len+=p*(f+d),o&&(t.static_len+=p*(s[l*2+1]+d)));if(v!==0){do{for(f=h-1;t.bl_count[f]===0;)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[h]--,v-=2}while(v>0);for(f=h;f!==0;f--)for(l=t.bl_count[f];l!==0;)u=t.heap[--c],!(u>n)&&(e[u*2+1]!==f&&(t.opt_len+=(f-e[u*2+1])*e[u*2],e[u*2+1]=f),l--)}},jn=(t,i,e)=>{const n=new Array(we+1);let s=0,o,r;for(o=1;o<=we;o++)s=s+e[o-1]<<1,n[o]=s;for(r=0;r<=i;r++){let a=t[r*2+1];a!==0&&(t[r*2]=Kn(n[a]++,a))}},Bo=()=>{let t,i,e,n,s;const o=new Array(we+1);for(e=0,n=0;n<wi-1;n++)for(vi[n]=e,t=0;t<1<<si[n];t++)We[e++]=n;for(We[e-1]=n,s=0,n=0;n<16;n++)for(Ct[n]=s,t=0;t<1<<vt[n];t++)Xe[s++]=n;for(s>>=7;n<Re;n++)for(Ct[n]=s<<7,t=0;t<1<<vt[n]-7;t++)Xe[256+s++]=n;for(i=0;i<=we;i++)o[i]=0;for(t=0;t<=143;)le[t*2+1]=8,t++,o[8]++;for(;t<=255;)le[t*2+1]=9,t++,o[9]++;for(;t<=279;)le[t*2+1]=7,t++,o[7]++;for(;t<=287;)le[t*2+1]=8,t++,o[8]++;for(jn(le,Ye+1,o),t=0;t<Re;t++)$e[t*2+1]=5,$e[t*2]=Kn(t,5);Fn=new Pt(le,si,ct+1,Ye,we),qn=new Pt($e,vt,0,Re,we),Zn=new Pt(new Array(0),So,0,bi,Eo)},Vn=t=>{let i;for(i=0;i<Ye;i++)t.dyn_ltree[i*2]=0;for(i=0;i<Re;i++)t.dyn_dtree[i*2]=0;for(i=0;i<bi;i++)t.bl_tree[i*2]=0;t.dyn_ltree[ki*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Gn=t=>{t.bi_valid>8?Je(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Pi=(t,i,e,n)=>{const s=i*2,o=e*2;return t[s]<t[o]||t[s]===t[o]&&n[i]<=n[e]},Ut=(t,i,e)=>{const n=t.heap[e];let s=e<<1;for(;s<=t.heap_len&&(s<t.heap_len&&Pi(i,t.heap[s+1],t.heap[s],t.depth)&&s++,!Pi(i,n,t.heap[s],t.depth));)t.heap[e]=t.heap[s],e=s,s<<=1;t.heap[e]=n},Hi=(t,i,e)=>{let n,s,o=0,r,a;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+o++]&255,n+=(t.pending_buf[t.sym_buf+o++]&255)<<8,s=t.pending_buf[t.sym_buf+o++],n===0?ne(t,s,i):(r=We[s],ne(t,r+ct+1,i),a=si[r],a!==0&&(s-=vi[r],j(t,s,a)),n--,r=$n(n),ne(t,r,e),a=vt[r],a!==0&&(n-=Ct[r],j(t,n,a)));while(o<t.sym_next);ne(t,ki,i)},oi=(t,i)=>{const e=i.dyn_tree,n=i.stat_desc.static_tree,s=i.stat_desc.has_stree,o=i.stat_desc.elems;let r,a,h=-1,c;for(t.heap_len=0,t.heap_max=Mn,r=0;r<o;r++)e[r*2]!==0?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):e[r*2+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=h<2?++h:0,e[c*2]=1,t.depth[c]=0,t.opt_len--,s&&(t.static_len-=n[c*2+1]);for(i.max_code=h,r=t.heap_len>>1;r>=1;r--)Ut(t,e,r);c=o;do r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Ut(t,e,1),a=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=a,e[c*2]=e[r*2]+e[a*2],t.depth[c]=(t.depth[r]>=t.depth[a]?t.depth[r]:t.depth[a])+1,e[r*2+1]=e[a*2+1]=c,t.heap[1]=c++,Ut(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Co(t,i),jn(e,h,t.bl_count)},Ui=(t,i,e)=>{let n,s=-1,o,r=i[0*2+1],a=0,h=7,c=4;for(r===0&&(h=138,c=3),i[(e+1)*2+1]=65535,n=0;n<=e;n++)o=r,r=i[(n+1)*2+1],!(++a<h&&o===r)&&(a<c?t.bl_tree[o*2]+=a:o!==0?(o!==s&&t.bl_tree[o*2]++,t.bl_tree[Nn*2]++):a<=10?t.bl_tree[Pn*2]++:t.bl_tree[Hn*2]++,a=0,s=o,r===0?(h=138,c=3):o===r?(h=6,c=3):(h=7,c=4))},Fi=(t,i,e)=>{let n,s=-1,o,r=i[0*2+1],a=0,h=7,c=4;for(r===0&&(h=138,c=3),n=0;n<=e;n++)if(o=r,r=i[(n+1)*2+1],!(++a<h&&o===r)){if(a<c)do ne(t,o,t.bl_tree);while(--a!==0);else o!==0?(o!==s&&(ne(t,o,t.bl_tree),a--),ne(t,Nn,t.bl_tree),j(t,a-3,2)):a<=10?(ne(t,Pn,t.bl_tree),j(t,a-3,3)):(ne(t,Hn,t.bl_tree),j(t,a-11,7));a=0,s=o,r===0?(h=138,c=3):o===r?(h=6,c=3):(h=7,c=4)}},To=t=>{let i;for(Ui(t,t.dyn_ltree,t.l_desc.max_code),Ui(t,t.dyn_dtree,t.d_desc.max_code),oi(t,t.bl_desc),i=bi-1;i>=3&&t.bl_tree[Un[i]*2+1]===0;i--);return t.opt_len+=3*(i+1)+5+5+4,i},Ro=(t,i,e,n)=>{let s;for(j(t,i-257,5),j(t,e-1,5),j(t,n-4,4),s=0;s<n;s++)j(t,t.bl_tree[Un[s]*2+1],3);Fi(t,t.dyn_ltree,i-1),Fi(t,t.dyn_dtree,e-1)},Do=t=>{let i=4093624447,e;for(e=0;e<=31;e++,i>>>=1)if(i&1&&t.dyn_ltree[e*2]!==0)return Mi;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Ni;for(e=32;e<ct;e++)if(t.dyn_ltree[e*2]!==0)return Ni;return Mi};let qi=!1;const zo=t=>{qi||(Bo(),qi=!0),t.l_desc=new Ht(t.dyn_ltree,Fn),t.d_desc=new Ht(t.dyn_dtree,qn),t.bl_desc=new Ht(t.bl_tree,Zn),t.bi_buf=0,t.bi_valid=0,Vn(t)},Yn=(t,i,e,n)=>{j(t,(bo<<1)+(n?1:0),3),Gn(t),Je(t,e),Je(t,~e),e&&t.pending_buf.set(t.window.subarray(i,i+e),t.pending),t.pending+=e},Oo=t=>{j(t,Ln<<1,3),ne(t,ki,le),Ao(t)},Lo=(t,i,e,n)=>{let s,o,r=0;t.level>0?(t.strm.data_type===wo&&(t.strm.data_type=Do(t)),oi(t,t.l_desc),oi(t,t.d_desc),r=To(t),s=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=s&&(s=o)):s=o=e+5,e+4<=s&&i!==-1?Yn(t,i,e,n):t.strategy===yo||o===s?(j(t,(Ln<<1)+(n?1:0),3),Hi(t,le,$e)):(j(t,(ko<<1)+(n?1:0),3),Ro(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),Hi(t,t.dyn_ltree,t.dyn_dtree)),Vn(t),n&&Gn(t)},Mo=(t,i,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=i,t.pending_buf[t.sym_buf+t.sym_next++]=i>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,i===0?t.dyn_ltree[e*2]++:(t.matches++,i--,t.dyn_ltree[(We[e]+ct+1)*2]++,t.dyn_dtree[$n(i)*2]++),t.sym_next===t.sym_end);var No=zo,Po=Yn,Ho=Lo,Uo=Mo,Fo=Oo,qo={_tr_init:No,_tr_stored_block:Po,_tr_flush_block:Ho,_tr_tally:Uo,_tr_align:Fo};const Zo=(t,i,e,n)=>{let s=t&65535|0,o=t>>>16&65535|0,r=0;for(;e!==0;){r=e>2e3?2e3:e,e-=r;do s=s+i[n++]|0,o=o+s|0;while(--r);s%=65521,o%=65521}return s|o<<16|0};var Qe=Zo;const $o=()=>{let t,i=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;i[e]=t}return i},Ko=new Uint32Array($o()),jo=(t,i,e,n)=>{const s=Ko,o=n+e;t^=-1;for(let r=n;r<o;r++)t=t>>>8^s[(t^i[r])&255];return t^-1};var U=jo,et={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Rt={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Vo,_tr_stored_block:ri,_tr_flush_block:Go,_tr_tally:pe,_tr_align:Yo}=qo,{Z_NO_FLUSH:_e,Z_PARTIAL_FLUSH:Xo,Z_FULL_FLUSH:Wo,Z_FINISH:J,Z_BLOCK:Zi,Z_OK:q,Z_STREAM_END:$i,Z_STREAM_ERROR:se,Z_DATA_ERROR:Jo,Z_BUF_ERROR:Ft,Z_DEFAULT_COMPRESSION:Qo,Z_FILTERED:er,Z_HUFFMAN_ONLY:ut,Z_RLE:tr,Z_FIXED:ir,Z_DEFAULT_STRATEGY:nr,Z_UNKNOWN:sr,Z_DEFLATED:Dt}=Rt,or=9,rr=15,ar=8,cr=29,lr=256,ai=lr+1+cr,hr=30,dr=19,fr=2*ai+1,ur=15,B=3,ue=258,oe=ue+B+1,pr=32,ze=42,xi=57,ci=69,li=73,hi=91,di=103,be=113,Fe=666,K=1,Me=2,ve=3,Ne=4,_r=3,ke=(t,i)=>(t.msg=et[i],i),Ki=t=>t*2-(t>4?9:0),fe=t=>{let i=t.length;for(;--i>=0;)t[i]=0},mr=t=>{let i,e,n,s=t.w_size;i=t.hash_size,n=i;do e=t.head[--n],t.head[n]=e>=s?e-s:0;while(--i);i=s,n=i;do e=t.prev[--n],t.prev[n]=e>=s?e-s:0;while(--i)};let gr=(t,i,e)=>(i<<t.hash_shift^e)&t.hash_mask,me=gr;const G=t=>{const i=t.state;let e=i.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+e),t.next_out),t.next_out+=e,i.pending_out+=e,t.total_out+=e,t.avail_out-=e,i.pending-=e,i.pending===0&&(i.pending_out=0))},Y=(t,i)=>{Go(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,i),t.block_start=t.strstart,G(t.strm)},z=(t,i)=>{t.pending_buf[t.pending++]=i},He=(t,i)=>{t.pending_buf[t.pending++]=i>>>8&255,t.pending_buf[t.pending++]=i&255},fi=(t,i,e,n)=>{let s=t.avail_in;return s>n&&(s=n),s===0?0:(t.avail_in-=s,i.set(t.input.subarray(t.next_in,t.next_in+s),e),t.state.wrap===1?t.adler=Qe(t.adler,i,s,e):t.state.wrap===2&&(t.adler=U(t.adler,i,s,e)),t.next_in+=s,t.total_in+=s,s)},Xn=(t,i)=>{let e=t.max_chain_length,n=t.strstart,s,o,r=t.prev_length,a=t.nice_match;const h=t.strstart>t.w_size-oe?t.strstart-(t.w_size-oe):0,c=t.window,l=t.w_mask,u=t.prev,f=t.strstart+ue;let d=c[n+r-1],p=c[n+r];t.prev_length>=t.good_match&&(e>>=2),a>t.lookahead&&(a=t.lookahead);do if(s=i,!(c[s+r]!==p||c[s+r-1]!==d||c[s]!==c[n]||c[++s]!==c[n+1])){n+=2,s++;do;while(c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&n<f);if(o=ue-(f-n),n=f-ue,o>r){if(t.match_start=i,r=o,o>=a)break;d=c[n+r-1],p=c[n+r]}}while((i=u[i&l])>h&&--e!==0);return r<=t.lookahead?r:t.lookahead},Oe=t=>{const i=t.w_size;let e,n,s;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=i+(i-oe)&&(t.window.set(t.window.subarray(i,i+i-n),0),t.match_start-=i,t.strstart-=i,t.block_start-=i,t.insert>t.strstart&&(t.insert=t.strstart),mr(t),n+=i),t.strm.avail_in===0)break;if(e=fi(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=B)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=me(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=me(t,t.ins_h,t.window[s+B-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<B)););}while(t.lookahead<oe&&t.strm.avail_in!==0)},Wn=(t,i)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,s,o,r=0,a=t.strm.avail_in;do{if(n=65535,o=t.bi_valid+42>>3,t.strm.avail_out<o||(o=t.strm.avail_out-o,s=t.strstart-t.block_start,n>s+t.strm.avail_in&&(n=s+t.strm.avail_in),n>o&&(n=o),n<e&&(n===0&&i!==J||i===_e||n!==s+t.strm.avail_in)))break;r=i===J&&n===s+t.strm.avail_in?1:0,ri(t,0,0,r),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,G(t.strm),s&&(s>n&&(s=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,n-=s),n&&(fi(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(r===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?Ne:i!==_e&&i!==J&&t.strm.avail_in===0&&t.strstart===t.block_start?Me:(o=t.window_size-t.strstart,t.strm.avail_in>o&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,o+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),o>t.strm.avail_in&&(o=t.strm.avail_in),o&&(fi(t.strm,t.window,t.strstart,o),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.high_water<t.strstart&&(t.high_water=t.strstart),o=t.bi_valid+42>>3,o=t.pending_buf_size-o>65535?65535:t.pending_buf_size-o,e=o>t.w_size?t.w_size:o,s=t.strstart-t.block_start,(s>=e||(s||i===J)&&i!==_e&&t.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,r=i===J&&t.strm.avail_in===0&&n===s?1:0,ri(t,t.block_start,n,r),t.block_start+=n,G(t.strm)),r?ve:K)},qt=(t,i)=>{let e,n;for(;;){if(t.lookahead<oe){if(Oe(t),t.lookahead<oe&&i===_e)return K;if(t.lookahead===0)break}if(e=0,t.lookahead>=B&&(t.ins_h=me(t,t.ins_h,t.window[t.strstart+B-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-oe&&(t.match_length=Xn(t,e)),t.match_length>=B)if(n=pe(t,t.strstart-t.match_start,t.match_length-B),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=B){t.match_length--;do t.strstart++,t.ins_h=me(t,t.ins_h,t.window[t.strstart+B-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=me(t,t.ins_h,t.window[t.strstart+1]);else n=pe(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Y(t,!1),t.strm.avail_out===0))return K}return t.insert=t.strstart<B-1?t.strstart:B-1,i===J?(Y(t,!0),t.strm.avail_out===0?ve:Ne):t.sym_next&&(Y(t,!1),t.strm.avail_out===0)?K:Me},Ce=(t,i)=>{let e,n,s;for(;;){if(t.lookahead<oe){if(Oe(t),t.lookahead<oe&&i===_e)return K;if(t.lookahead===0)break}if(e=0,t.lookahead>=B&&(t.ins_h=me(t,t.ins_h,t.window[t.strstart+B-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=B-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-oe&&(t.match_length=Xn(t,e),t.match_length<=5&&(t.strategy===er||t.match_length===B&&t.strstart-t.match_start>4096)&&(t.match_length=B-1)),t.prev_length>=B&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-B,n=pe(t,t.strstart-1-t.prev_match,t.prev_length-B),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=me(t,t.ins_h,t.window[t.strstart+B-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=B-1,t.strstart++,n&&(Y(t,!1),t.strm.avail_out===0))return K}else if(t.match_available){if(n=pe(t,0,t.window[t.strstart-1]),n&&Y(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return K}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=pe(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<B-1?t.strstart:B-1,i===J?(Y(t,!0),t.strm.avail_out===0?ve:Ne):t.sym_next&&(Y(t,!1),t.strm.avail_out===0)?K:Me},yr=(t,i)=>{let e,n,s,o;const r=t.window;for(;;){if(t.lookahead<=ue){if(Oe(t),t.lookahead<=ue&&i===_e)return K;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=B&&t.strstart>0&&(s=t.strstart-1,n=r[s],n===r[++s]&&n===r[++s]&&n===r[++s])){o=t.strstart+ue;do;while(n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&s<o);t.match_length=ue-(o-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=B?(e=pe(t,1,t.match_length-B),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=pe(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(Y(t,!1),t.strm.avail_out===0))return K}return t.insert=0,i===J?(Y(t,!0),t.strm.avail_out===0?ve:Ne):t.sym_next&&(Y(t,!1),t.strm.avail_out===0)?K:Me},wr=(t,i)=>{let e;for(;;){if(t.lookahead===0&&(Oe(t),t.lookahead===0)){if(i===_e)return K;break}if(t.match_length=0,e=pe(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(Y(t,!1),t.strm.avail_out===0))return K}return t.insert=0,i===J?(Y(t,!0),t.strm.avail_out===0?ve:Ne):t.sym_next&&(Y(t,!1),t.strm.avail_out===0)?K:Me};function te(t,i,e,n,s){this.good_length=t,this.max_lazy=i,this.nice_length=e,this.max_chain=n,this.func=s}const qe=[new te(0,0,0,0,Wn),new te(4,4,8,4,qt),new te(4,5,16,8,qt),new te(4,6,32,32,qt),new te(4,4,16,16,Ce),new te(8,16,32,32,Ce),new te(8,16,128,128,Ce),new te(8,32,128,256,Ce),new te(32,128,258,1024,Ce),new te(32,258,258,4096,Ce)],br=t=>{t.window_size=2*t.w_size,fe(t.head),t.max_lazy_match=qe[t.level].max_lazy,t.good_match=qe[t.level].good_length,t.nice_match=qe[t.level].nice_length,t.max_chain_length=qe[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=B-1,t.match_available=0,t.ins_h=0};function kr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Dt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(fr*2),this.dyn_dtree=new Uint16Array((2*hr+1)*2),this.bl_tree=new Uint16Array((2*dr+1)*2),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ur+1),this.heap=new Uint16Array(2*ai+1),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ai+1),fe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const lt=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.status!==ze&&i.status!==xi&&i.status!==ci&&i.status!==li&&i.status!==hi&&i.status!==di&&i.status!==be&&i.status!==Fe?1:0},Jn=t=>{if(lt(t))return ke(t,se);t.total_in=t.total_out=0,t.data_type=sr;const i=t.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?xi:i.wrap?ze:be,t.adler=i.wrap===2?0:1,i.last_flush=-2,Vo(i),q},Qn=t=>{const i=Jn(t);return i===q&&br(t.state),i},vr=(t,i)=>lt(t)||t.state.wrap!==2?se:(t.state.gzhead=i,q),es=(t,i,e,n,s,o)=>{if(!t)return se;let r=1;if(i===Qo&&(i=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),s<1||s>or||e!==Dt||n<8||n>15||i<0||i>9||o<0||o>ir||n===8&&r!==1)return ke(t,se);n===8&&(n=9);const a=new kr;return t.state=a,a.strm=t,a.status=ze,a.wrap=r,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+B-1)/B),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=i,a.strategy=o,a.method=e,Qn(t)},xr=(t,i)=>es(t,i,Dt,rr,ar,nr),Er=(t,i)=>{if(lt(t)||i>Zi||i<0)return t?ke(t,se):se;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Fe&&i!==J)return ke(t,t.avail_out===0?Ft:se);const n=e.last_flush;if(e.last_flush=i,e.pending!==0){if(G(t),t.avail_out===0)return e.last_flush=-1,q}else if(t.avail_in===0&&Ki(i)<=Ki(n)&&i!==J)return ke(t,Ft);if(e.status===Fe&&t.avail_in!==0)return ke(t,Ft);if(e.status===ze&&e.wrap===0&&(e.status=be),e.status===ze){let s=Dt+(e.w_bits-8<<4)<<8,o=-1;if(e.strategy>=ut||e.level<2?o=0:e.level<6?o=1:e.level===6?o=2:o=3,s|=o<<6,e.strstart!==0&&(s|=pr),s+=31-s%31,He(e,s),e.strstart!==0&&(He(e,t.adler>>>16),He(e,t.adler&65535)),t.adler=1,e.status=be,G(t),e.pending!==0)return e.last_flush=-1,q}if(e.status===xi){if(t.adler=0,z(e,31),z(e,139),z(e,8),e.gzhead)z(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),z(e,e.gzhead.time&255),z(e,e.gzhead.time>>8&255),z(e,e.gzhead.time>>16&255),z(e,e.gzhead.time>>24&255),z(e,e.level===9?2:e.strategy>=ut||e.level<2?4:0),z(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(z(e,e.gzhead.extra.length&255),z(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=U(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=ci;else if(z(e,0),z(e,0),z(e,0),z(e,0),z(e,0),z(e,e.level===9?2:e.strategy>=ut||e.level<2?4:0),z(e,_r),e.status=be,G(t),e.pending!==0)return e.last_flush=-1,q}if(e.status===ci){if(e.gzhead.extra){let s=e.pending,o=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+o>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(t.adler=U(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=a,G(t),e.pending!==0)return e.last_flush=-1,q;s=0,o-=a}let r=new Uint8Array(e.gzhead.extra);e.pending_buf.set(r.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending+=o,e.gzhead.hcrc&&e.pending>s&&(t.adler=U(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=li}if(e.status===li){if(e.gzhead.name){let s=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=U(t.adler,e.pending_buf,e.pending-s,s)),G(t),e.pending!==0)return e.last_flush=-1,q;s=0}e.gzindex<e.gzhead.name.length?o=e.gzhead.name.charCodeAt(e.gzindex++)&255:o=0,z(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=U(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=hi}if(e.status===hi){if(e.gzhead.comment){let s=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=U(t.adler,e.pending_buf,e.pending-s,s)),G(t),e.pending!==0)return e.last_flush=-1,q;s=0}e.gzindex<e.gzhead.comment.length?o=e.gzhead.comment.charCodeAt(e.gzindex++)&255:o=0,z(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=U(t.adler,e.pending_buf,e.pending-s,s))}e.status=di}if(e.status===di){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(G(t),e.pending!==0))return e.last_flush=-1,q;z(e,t.adler&255),z(e,t.adler>>8&255),t.adler=0}if(e.status=be,G(t),e.pending!==0)return e.last_flush=-1,q}if(t.avail_in!==0||e.lookahead!==0||i!==_e&&e.status!==Fe){let s=e.level===0?Wn(e,i):e.strategy===ut?wr(e,i):e.strategy===tr?yr(e,i):qe[e.level].func(e,i);if((s===ve||s===Ne)&&(e.status=Fe),s===K||s===ve)return t.avail_out===0&&(e.last_flush=-1),q;if(s===Me&&(i===Xo?Yo(e):i!==Zi&&(ri(e,0,0,!1),i===Wo&&(fe(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),G(t),t.avail_out===0))return e.last_flush=-1,q}return i!==J?q:e.wrap<=0?$i:(e.wrap===2?(z(e,t.adler&255),z(e,t.adler>>8&255),z(e,t.adler>>16&255),z(e,t.adler>>24&255),z(e,t.total_in&255),z(e,t.total_in>>8&255),z(e,t.total_in>>16&255),z(e,t.total_in>>24&255)):(He(e,t.adler>>>16),He(e,t.adler&65535)),G(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?q:$i)},Sr=t=>{if(lt(t))return se;const i=t.state.status;return t.state=null,i===be?ke(t,Jo):q},Ir=(t,i)=>{let e=i.length;if(lt(t))return se;const n=t.state,s=n.wrap;if(s===2||s===1&&n.status!==ze||n.lookahead)return se;if(s===1&&(t.adler=Qe(t.adler,i,e,0)),n.wrap=0,e>=n.w_size){s===0&&(fe(n.head),n.strstart=0,n.block_start=0,n.insert=0);let h=new Uint8Array(n.w_size);h.set(i.subarray(e-n.w_size,e),0),i=h,e=n.w_size}const o=t.avail_in,r=t.next_in,a=t.input;for(t.avail_in=e,t.next_in=0,t.input=i,Oe(n);n.lookahead>=B;){let h=n.strstart,c=n.lookahead-(B-1);do n.ins_h=me(n,n.ins_h,n.window[h+B-1]),n.prev[h&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=h,h++;while(--c);n.strstart=h,n.lookahead=B-1,Oe(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=B-1,n.match_available=0,t.next_in=r,t.input=a,t.avail_in=o,n.wrap=s,q};var Ar=xr,Cr=es,Br=Qn,Tr=Jn,Rr=vr,Dr=Er,zr=Sr,Or=Ir,Lr="pako deflate (from Nodeca project)",Ke={deflateInit:Ar,deflateInit2:Cr,deflateReset:Br,deflateResetKeep:Tr,deflateSetHeader:Rr,deflate:Dr,deflateEnd:zr,deflateSetDictionary:Or,deflateInfo:Lr};const Mr=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);var Nr=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const e=i.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)Mr(e,n)&&(t[n]=e[n])}}return t},Pr=t=>{let i=0;for(let n=0,s=t.length;n<s;n++)i+=t[n].length;const e=new Uint8Array(i);for(let n=0,s=0,o=t.length;n<o;n++){let r=t[n];e.set(r,s),s+=r.length}return e},zt={assign:Nr,flattenChunks:Pr};let ts=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ts=!1}const tt=new Uint8Array(256);for(let t=0;t<256;t++)tt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;tt[254]=tt[254]=1;var Hr=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let i,e,n,s,o,r=t.length,a=0;for(s=0;s<r;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(a),o=0,s=0;o<a;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),e<128?i[o++]=e:e<2048?(i[o++]=192|e>>>6,i[o++]=128|e&63):e<65536?(i[o++]=224|e>>>12,i[o++]=128|e>>>6&63,i[o++]=128|e&63):(i[o++]=240|e>>>18,i[o++]=128|e>>>12&63,i[o++]=128|e>>>6&63,i[o++]=128|e&63);return i};const Ur=(t,i)=>{if(i<65534&&t.subarray&&ts)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e};var Fr=(t,i)=>{const e=i||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,i));let n,s;const o=new Array(e*2);for(s=0,n=0;n<e;){let r=t[n++];if(r<128){o[s++]=r;continue}let a=tt[r];if(a>4){o[s++]=65533,n+=a-1;continue}for(r&=a===2?31:a===3?15:7;a>1&&n<e;)r=r<<6|t[n++]&63,a--;if(a>1){o[s++]=65533;continue}r<65536?o[s++]=r:(r-=65536,o[s++]=55296|r>>10&1023,o[s++]=56320|r&1023)}return Ur(o,s)},qr=(t,i)=>{i=i||t.length,i>t.length&&(i=t.length);let e=i-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?i:e+tt[t[e]]>i?e:i},it={string2buf:Hr,buf2string:Fr,utf8border:qr};function Zr(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var is=Zr;const ns=Object.prototype.toString,{Z_NO_FLUSH:$r,Z_SYNC_FLUSH:Kr,Z_FULL_FLUSH:jr,Z_FINISH:Vr,Z_OK:Bt,Z_STREAM_END:Gr,Z_DEFAULT_COMPRESSION:Yr,Z_DEFAULT_STRATEGY:Xr,Z_DEFLATED:Wr}=Rt;function Ei(t){this.options=zt.assign({level:Yr,method:Wr,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xr},t||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new is,this.strm.avail_out=0;let e=Ke.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(e!==Bt)throw new Error(et[e]);if(i.header&&Ke.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=it.string2buf(i.dictionary):ns.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,e=Ke.deflateSetDictionary(this.strm,n),e!==Bt)throw new Error(et[e]);this._dict_set=!0}}Ei.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize;let s,o;if(this.ended)return!1;for(i===~~i?o=i:o=i===!0?Vr:$r,typeof t=="string"?e.input=it.string2buf(t):ns.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(o===Kr||o===jr)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=Ke.deflate(e,o),s===Gr)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Ke.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Bt;if(e.avail_out===0){this.onData(e.output);continue}if(o>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Ei.prototype.onData=function(t){this.chunks.push(t)};Ei.prototype.onEnd=function(t){t===Bt&&(this.result=zt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const pt=16209,Jr=16191;var Qr=function(i,e){let n,s,o,r,a,h,c,l,u,f,d,p,v,m,k,R,I,_,D,P,g,L,T,x;const A=i.state;n=i.next_in,T=i.input,s=n+(i.avail_in-5),o=i.next_out,x=i.output,r=o-(e-i.avail_out),a=o+(i.avail_out-257),h=A.dmax,c=A.wsize,l=A.whave,u=A.wnext,f=A.window,d=A.hold,p=A.bits,v=A.lencode,m=A.distcode,k=(1<<A.lenbits)-1,R=(1<<A.distbits)-1;e:do{p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),I=v[d&k];t:for(;;){if(_=I>>>24,d>>>=_,p-=_,_=I>>>16&255,_===0)x[o++]=I&65535;else if(_&16){D=I&65535,_&=15,_&&(p<_&&(d+=T[n++]<<p,p+=8),D+=d&(1<<_)-1,d>>>=_,p-=_),p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),I=m[d&R];i:for(;;){if(_=I>>>24,d>>>=_,p-=_,_=I>>>16&255,_&16){if(P=I&65535,_&=15,p<_&&(d+=T[n++]<<p,p+=8,p<_&&(d+=T[n++]<<p,p+=8)),P+=d&(1<<_)-1,P>h){i.msg="invalid distance too far back",A.mode=pt;break e}if(d>>>=_,p-=_,_=o-r,P>_){if(_=P-_,_>l&&A.sane){i.msg="invalid distance too far back",A.mode=pt;break e}if(g=0,L=f,u===0){if(g+=c-_,_<D){D-=_;do x[o++]=f[g++];while(--_);g=o-P,L=x}}else if(u<_){if(g+=c+u-_,_-=u,_<D){D-=_;do x[o++]=f[g++];while(--_);if(g=0,u<D){_=u,D-=_;do x[o++]=f[g++];while(--_);g=o-P,L=x}}}else if(g+=u-_,_<D){D-=_;do x[o++]=f[g++];while(--_);g=o-P,L=x}for(;D>2;)x[o++]=L[g++],x[o++]=L[g++],x[o++]=L[g++],D-=3;D&&(x[o++]=L[g++],D>1&&(x[o++]=L[g++]))}else{g=o-P;do x[o++]=x[g++],x[o++]=x[g++],x[o++]=x[g++],D-=3;while(D>2);D&&(x[o++]=x[g++],D>1&&(x[o++]=x[g++]))}}else if(_&64){i.msg="invalid distance code",A.mode=pt;break e}else{I=m[(I&65535)+(d&(1<<_)-1)];continue i}break}}else if(_&64)if(_&32){A.mode=Jr;break e}else{i.msg="invalid literal/length code",A.mode=pt;break e}else{I=v[(I&65535)+(d&(1<<_)-1)];continue t}break}}while(n<s&&o<a);D=p>>3,n-=D,p-=D<<3,d&=(1<<p)-1,i.next_in=n,i.next_out=o,i.avail_in=n<s?5+(s-n):5-(n-s),i.avail_out=o<a?257+(a-o):257-(o-a),A.hold=d,A.bits=p};const Be=15,ji=852,Vi=592,Gi=0,Zt=1,Yi=2,ea=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ta=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ia=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),na=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),sa=(t,i,e,n,s,o,r,a)=>{const h=a.bits;let c=0,l=0,u=0,f=0,d=0,p=0,v=0,m=0,k=0,R=0,I,_,D,P,g,L=null,T;const x=new Uint16Array(Be+1),A=new Uint16Array(Be+1);let ye=null,Ri,ht,dt;for(c=0;c<=Be;c++)x[c]=0;for(l=0;l<n;l++)x[i[e+l]]++;for(d=h,f=Be;f>=1&&x[f]===0;f--);if(d>f&&(d=f),f===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<f&&x[u]===0;u++);for(d<u&&(d=u),m=1,c=1;c<=Be;c++)if(m<<=1,m-=x[c],m<0)return-1;if(m>0&&(t===Gi||f!==1))return-1;for(A[1]=0,c=1;c<Be;c++)A[c+1]=A[c]+x[c];for(l=0;l<n;l++)i[e+l]!==0&&(r[A[i[e+l]]++]=l);if(t===Gi?(L=ye=r,T=20):t===Zt?(L=ea,ye=ta,T=257):(L=ia,ye=na,T=0),R=0,l=0,c=u,g=o,p=d,v=0,D=-1,k=1<<d,P=k-1,t===Zt&&k>ji||t===Yi&&k>Vi)return 1;for(;;){Ri=c-v,r[l]+1<T?(ht=0,dt=r[l]):r[l]>=T?(ht=ye[r[l]-T],dt=L[r[l]-T]):(ht=96,dt=0),I=1<<c-v,_=1<<p,u=_;do _-=I,s[g+(R>>v)+_]=Ri<<24|ht<<16|dt|0;while(_!==0);for(I=1<<c-1;R&I;)I>>=1;if(I!==0?(R&=I-1,R+=I):R=0,l++,--x[c]===0){if(c===f)break;c=i[e+r[l]]}if(c>d&&(R&P)!==D){for(v===0&&(v=d),g+=u,p=c-v,m=1<<p;p+v<f&&(m-=x[p+v],!(m<=0));)p++,m<<=1;if(k+=1<<p,t===Zt&&k>ji||t===Yi&&k>Vi)return 1;D=R&P,s[D]=d<<24|p<<16|g-o|0}}return R!==0&&(s[g+R]=c-v<<24|64<<16|0),a.bits=d,0};var je=sa;const oa=0,ss=1,os=2,{Z_FINISH:Xi,Z_BLOCK:ra,Z_TREES:_t,Z_OK:xe,Z_STREAM_END:aa,Z_NEED_DICT:ca,Z_STREAM_ERROR:Q,Z_DATA_ERROR:rs,Z_MEM_ERROR:as,Z_BUF_ERROR:la,Z_DEFLATED:Wi}=Rt,Ot=16180,Ji=16181,Qi=16182,en=16183,tn=16184,nn=16185,sn=16186,on=16187,rn=16188,an=16189,Tt=16190,ce=16191,$t=16192,cn=16193,Kt=16194,ln=16195,hn=16196,dn=16197,fn=16198,mt=16199,gt=16200,un=16201,pn=16202,_n=16203,mn=16204,gn=16205,jt=16206,yn=16207,wn=16208,M=16209,cs=16210,ls=16211,ha=852,da=592,fa=15,ua=fa,bn=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function pa(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ee=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.mode<Ot||i.mode>ls?1:0},hs=t=>{if(Ee(t))return Q;const i=t.state;return t.total_in=t.total_out=i.total=0,t.msg="",i.wrap&&(t.adler=i.wrap&1),i.mode=Ot,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(ha),i.distcode=i.distdyn=new Int32Array(da),i.sane=1,i.back=-1,xe},ds=t=>{if(Ee(t))return Q;const i=t.state;return i.wsize=0,i.whave=0,i.wnext=0,hs(t)},fs=(t,i)=>{let e;if(Ee(t))return Q;const n=t.state;return i<0?(e=0,i=-i):(e=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?Q:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=e,n.wbits=i,ds(t))},us=(t,i)=>{if(!t)return Q;const e=new pa;t.state=e,e.strm=t,e.window=null,e.mode=Ot;const n=fs(t,i);return n!==xe&&(t.state=null),n},_a=t=>us(t,ua);let kn=!0,Vt,Gt;const ma=t=>{if(kn){Vt=new Int32Array(512),Gt=new Int32Array(32);let i=0;for(;i<144;)t.lens[i++]=8;for(;i<256;)t.lens[i++]=9;for(;i<280;)t.lens[i++]=7;for(;i<288;)t.lens[i++]=8;for(je(ss,t.lens,0,288,Vt,0,t.work,{bits:9}),i=0;i<32;)t.lens[i++]=5;je(os,t.lens,0,32,Gt,0,t.work,{bits:5}),kn=!1}t.lencode=Vt,t.lenbits=9,t.distcode=Gt,t.distbits=5},ps=(t,i,e,n)=>{let s;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(i.subarray(e-o.wsize,e),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>n&&(s=n),o.window.set(i.subarray(e-n,e-n+s),o.wnext),n-=s,n?(o.window.set(i.subarray(e-n,e),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0},ga=(t,i)=>{let e,n,s,o,r,a,h,c,l,u,f,d,p,v,m=0,k,R,I,_,D,P,g,L;const T=new Uint8Array(4);let x,A;const ye=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ee(t)||!t.output||!t.input&&t.avail_in!==0)return Q;e=t.state,e.mode===ce&&(e.mode=$t),r=t.next_out,s=t.output,h=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=e.hold,l=e.bits,u=a,f=h,L=xe;e:for(;;)switch(e.mode){case Ot:if(e.wrap===0){e.mode=$t;break}for(;l<16;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(e.wrap&2&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,T[0]=c&255,T[1]=c>>>8&255,e.check=U(e.check,T,2,0),c=0,l=0,e.mode=Ji;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((c&255)<<8)+(c>>8))%31){t.msg="incorrect header check",e.mode=M;break}if((c&15)!==Wi){t.msg="unknown compression method",e.mode=M;break}if(c>>>=4,l-=4,g=(c&15)+8,e.wbits===0&&(e.wbits=g),g>15||g>e.wbits){t.msg="invalid window size",e.mode=M;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=c&512?an:ce,c=0,l=0;break;case Ji:for(;l<16;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(e.flags=c,(e.flags&255)!==Wi){t.msg="unknown compression method",e.mode=M;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=M;break}e.head&&(e.head.text=c>>8&1),e.flags&512&&e.wrap&4&&(T[0]=c&255,T[1]=c>>>8&255,e.check=U(e.check,T,2,0)),c=0,l=0,e.mode=Qi;case Qi:for(;l<32;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}e.head&&(e.head.time=c),e.flags&512&&e.wrap&4&&(T[0]=c&255,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,e.check=U(e.check,T,4,0)),c=0,l=0,e.mode=en;case en:for(;l<16;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}e.head&&(e.head.xflags=c&255,e.head.os=c>>8),e.flags&512&&e.wrap&4&&(T[0]=c&255,T[1]=c>>>8&255,e.check=U(e.check,T,2,0)),c=0,l=0,e.mode=tn;case tn:if(e.flags&1024){for(;l<16;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}e.length=c,e.head&&(e.head.extra_len=c),e.flags&512&&e.wrap&4&&(T[0]=c&255,T[1]=c>>>8&255,e.check=U(e.check,T,2,0)),c=0,l=0}else e.head&&(e.head.extra=null);e.mode=nn;case nn:if(e.flags&1024&&(d=e.length,d>a&&(d=a),d&&(e.head&&(g=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(o,o+d),g)),e.flags&512&&e.wrap&4&&(e.check=U(e.check,n,d,o)),a-=d,o+=d,e.length-=d),e.length))break e;e.length=0,e.mode=sn;case sn:if(e.flags&2048){if(a===0)break e;d=0;do g=n[o+d++],e.head&&g&&e.length<65536&&(e.head.name+=String.fromCharCode(g));while(g&&d<a);if(e.flags&512&&e.wrap&4&&(e.check=U(e.check,n,d,o)),a-=d,o+=d,g)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=on;case on:if(e.flags&4096){if(a===0)break e;d=0;do g=n[o+d++],e.head&&g&&e.length<65536&&(e.head.comment+=String.fromCharCode(g));while(g&&d<a);if(e.flags&512&&e.wrap&4&&(e.check=U(e.check,n,d,o)),a-=d,o+=d,g)break e}else e.head&&(e.head.comment=null);e.mode=rn;case rn:if(e.flags&512){for(;l<16;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(e.wrap&4&&c!==(e.check&65535)){t.msg="header crc mismatch",e.mode=M;break}c=0,l=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=ce;break;case an:for(;l<32;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}t.adler=e.check=bn(c),c=0,l=0,e.mode=Tt;case Tt:if(e.havedict===0)return t.next_out=r,t.avail_out=h,t.next_in=o,t.avail_in=a,e.hold=c,e.bits=l,ca;t.adler=e.check=1,e.mode=ce;case ce:if(i===ra||i===_t)break e;case $t:if(e.last){c>>>=l&7,l-=l&7,e.mode=jt;break}for(;l<3;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}switch(e.last=c&1,c>>>=1,l-=1,c&3){case 0:e.mode=cn;break;case 1:if(ma(e),e.mode=mt,i===_t){c>>>=2,l-=2;break e}break;case 2:e.mode=hn;break;case 3:t.msg="invalid block type",e.mode=M}c>>>=2,l-=2;break;case cn:for(c>>>=l&7,l-=l&7;l<32;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if((c&65535)!==(c>>>16^65535)){t.msg="invalid stored block lengths",e.mode=M;break}if(e.length=c&65535,c=0,l=0,e.mode=Kt,i===_t)break e;case Kt:e.mode=ln;case ln:if(d=e.length,d){if(d>a&&(d=a),d>h&&(d=h),d===0)break e;s.set(n.subarray(o,o+d),r),a-=d,o+=d,h-=d,r+=d,e.length-=d;break}e.mode=ce;break;case hn:for(;l<14;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(e.nlen=(c&31)+257,c>>>=5,l-=5,e.ndist=(c&31)+1,c>>>=5,l-=5,e.ncode=(c&15)+4,c>>>=4,l-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=M;break}e.have=0,e.mode=dn;case dn:for(;e.have<e.ncode;){for(;l<3;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}e.lens[ye[e.have++]]=c&7,c>>>=3,l-=3}for(;e.have<19;)e.lens[ye[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,x={bits:e.lenbits},L=je(oa,e.lens,0,19,e.lencode,0,e.work,x),e.lenbits=x.bits,L){t.msg="invalid code lengths set",e.mode=M;break}e.have=0,e.mode=fn;case fn:for(;e.have<e.nlen+e.ndist;){for(;m=e.lencode[c&(1<<e.lenbits)-1],k=m>>>24,R=m>>>16&255,I=m&65535,!(k<=l);){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(I<16)c>>>=k,l-=k,e.lens[e.have++]=I;else{if(I===16){for(A=k+2;l<A;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(c>>>=k,l-=k,e.have===0){t.msg="invalid bit length repeat",e.mode=M;break}g=e.lens[e.have-1],d=3+(c&3),c>>>=2,l-=2}else if(I===17){for(A=k+3;l<A;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}c>>>=k,l-=k,g=0,d=3+(c&7),c>>>=3,l-=3}else{for(A=k+7;l<A;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}c>>>=k,l-=k,g=0,d=11+(c&127),c>>>=7,l-=7}if(e.have+d>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=M;break}for(;d--;)e.lens[e.have++]=g}}if(e.mode===M)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=M;break}if(e.lenbits=9,x={bits:e.lenbits},L=je(ss,e.lens,0,e.nlen,e.lencode,0,e.work,x),e.lenbits=x.bits,L){t.msg="invalid literal/lengths set",e.mode=M;break}if(e.distbits=6,e.distcode=e.distdyn,x={bits:e.distbits},L=je(os,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,x),e.distbits=x.bits,L){t.msg="invalid distances set",e.mode=M;break}if(e.mode=mt,i===_t)break e;case mt:e.mode=gt;case gt:if(a>=6&&h>=258){t.next_out=r,t.avail_out=h,t.next_in=o,t.avail_in=a,e.hold=c,e.bits=l,Qr(t,f),r=t.next_out,s=t.output,h=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=e.hold,l=e.bits,e.mode===ce&&(e.back=-1);break}for(e.back=0;m=e.lencode[c&(1<<e.lenbits)-1],k=m>>>24,R=m>>>16&255,I=m&65535,!(k<=l);){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(R&&!(R&240)){for(_=k,D=R,P=I;m=e.lencode[P+((c&(1<<_+D)-1)>>_)],k=m>>>24,R=m>>>16&255,I=m&65535,!(_+k<=l);){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}c>>>=_,l-=_,e.back+=_}if(c>>>=k,l-=k,e.back+=k,e.length=I,R===0){e.mode=gn;break}if(R&32){e.back=-1,e.mode=ce;break}if(R&64){t.msg="invalid literal/length code",e.mode=M;break}e.extra=R&15,e.mode=un;case un:if(e.extra){for(A=e.extra;l<A;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=pn;case pn:for(;m=e.distcode[c&(1<<e.distbits)-1],k=m>>>24,R=m>>>16&255,I=m&65535,!(k<=l);){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(!(R&240)){for(_=k,D=R,P=I;m=e.distcode[P+((c&(1<<_+D)-1)>>_)],k=m>>>24,R=m>>>16&255,I=m&65535,!(_+k<=l);){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}c>>>=_,l-=_,e.back+=_}if(c>>>=k,l-=k,e.back+=k,R&64){t.msg="invalid distance code",e.mode=M;break}e.offset=I,e.extra=R&15,e.mode=_n;case _n:if(e.extra){for(A=e.extra;l<A;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=M;break}e.mode=mn;case mn:if(h===0)break e;if(d=f-h,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=M;break}d>e.wnext?(d-=e.wnext,p=e.wsize-d):p=e.wnext-d,d>e.length&&(d=e.length),v=e.window}else v=s,p=r-e.offset,d=e.length;d>h&&(d=h),h-=d,e.length-=d;do s[r++]=v[p++];while(--d);e.length===0&&(e.mode=gt);break;case gn:if(h===0)break e;s[r++]=e.length,h--,e.mode=gt;break;case jt:if(e.wrap){for(;l<32;){if(a===0)break e;a--,c|=n[o++]<<l,l+=8}if(f-=h,t.total_out+=f,e.total+=f,e.wrap&4&&f&&(t.adler=e.check=e.flags?U(e.check,s,f,r-f):Qe(e.check,s,f,r-f)),f=h,e.wrap&4&&(e.flags?c:bn(c))!==e.check){t.msg="incorrect data check",e.mode=M;break}c=0,l=0}e.mode=yn;case yn:if(e.wrap&&e.flags){for(;l<32;){if(a===0)break e;a--,c+=n[o++]<<l,l+=8}if(e.wrap&4&&c!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=M;break}c=0,l=0}e.mode=wn;case wn:L=aa;break e;case M:L=rs;break e;case cs:return as;case ls:default:return Q}return t.next_out=r,t.avail_out=h,t.next_in=o,t.avail_in=a,e.hold=c,e.bits=l,(e.wsize||f!==t.avail_out&&e.mode<M&&(e.mode<jt||i!==Xi))&&ps(t,t.output,t.next_out,f-t.avail_out),u-=t.avail_in,f-=t.avail_out,t.total_in+=u,t.total_out+=f,e.total+=f,e.wrap&4&&f&&(t.adler=e.check=e.flags?U(e.check,s,f,t.next_out-f):Qe(e.check,s,f,t.next_out-f)),t.data_type=e.bits+(e.last?64:0)+(e.mode===ce?128:0)+(e.mode===mt||e.mode===Kt?256:0),(u===0&&f===0||i===Xi)&&L===xe&&(L=la),L},ya=t=>{if(Ee(t))return Q;let i=t.state;return i.window&&(i.window=null),t.state=null,xe},wa=(t,i)=>{if(Ee(t))return Q;const e=t.state;return e.wrap&2?(e.head=i,i.done=!1,xe):Q},ba=(t,i)=>{const e=i.length;let n,s,o;return Ee(t)||(n=t.state,n.wrap!==0&&n.mode!==Tt)?Q:n.mode===Tt&&(s=1,s=Qe(s,i,e,0),s!==n.check)?rs:(o=ps(t,i,e,e),o?(n.mode=cs,as):(n.havedict=1,xe))};var ka=ds,va=fs,xa=hs,Ea=_a,Sa=us,Ia=ga,Aa=ya,Ca=wa,Ba=ba,Ta="pako inflate (from Nodeca project)",he={inflateReset:ka,inflateReset2:va,inflateResetKeep:xa,inflateInit:Ea,inflateInit2:Sa,inflate:Ia,inflateEnd:Aa,inflateGetHeader:Ca,inflateSetDictionary:Ba,inflateInfo:Ta};function Ra(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Da=Ra;const _s=Object.prototype.toString,{Z_NO_FLUSH:za,Z_FINISH:Oa,Z_OK:nt,Z_STREAM_END:Yt,Z_NEED_DICT:Xt,Z_STREAM_ERROR:La,Z_DATA_ERROR:vn,Z_MEM_ERROR:Ma}=Rt;function Si(t){this.options=zt.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(t&&t.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15||(i.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new is,this.strm.avail_out=0;let e=he.inflateInit2(this.strm,i.windowBits);if(e!==nt)throw new Error(et[e]);if(this.header=new Da,he.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=it.string2buf(i.dictionary):_s.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=he.inflateSetDictionary(this.strm,i.dictionary),e!==nt)))throw new Error(et[e])}Si.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?Oa:za,_s.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),o=he.inflate(e,r),o===Xt&&s&&(o=he.inflateSetDictionary(e,s),o===nt?o=he.inflate(e,r):o===vn&&(o=Xt));e.avail_in>0&&o===Yt&&e.state.wrap>0&&t[e.next_in]!==0;)he.inflateReset(e),o=he.inflate(e,r);switch(o){case La:case vn:case Xt:case Ma:return this.onEnd(o),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||o===Yt))if(this.options.to==="string"){let h=it.utf8border(e.output,e.next_out),c=e.next_out-h,l=it.buf2string(e.output,h);e.next_out=c,e.avail_out=n-c,c&&e.output.set(e.output.subarray(h,h+c),0),this.onData(l)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(o===nt&&a===0)){if(o===Yt)return o=he.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Si.prototype.onData=function(t){this.chunks.push(t)};Si.prototype.onEnd=function(t){t===nt&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=zt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};class Na extends at{constructor(){super();y(this,"asyncLoading",!0);y(this,"drawDistance",2);y(this,"chunkSize",{width:16,height:80});y(this,"params",{seed:45678,terrain:{scale:40,magnitude:.1,offset:.5},biomes:{mountains:{scale:40,magnitude:.2,offset:.5},plains:{scale:80,magnitude:.1,offset:.5},forest:{scale:40,magnitude:.1,offset:.5},desert:{scale:120,magnitude:.1,offset:.5}},trees:{trunk:{minHeight:4,maxHeight:7},canopy:{minRadius:3,maxRadius:3,density:.7},frequency:.005}});y(this,"dataStore",new go)}worldToUint8Array(e){let n=[];for(const s in e)if(Object.hasOwn(e,s)){const o=e[s];for(const r of o)n.push(...r)}return console.log(n),new Uint8Array(n)}save(){(async()=>{const e=new Blob([JSON.stringify(this.dataStore.getData())]).size;console.log(`Taille des données : ${e/1e6} Mo`);const n=this.dataStore.getData();console.log(n),await Ha(n)})()}load(){(async()=>{const e=await Ua();this.dataStore.setData(e),this.generate()})()}generate(){this.disposeChunks();for(let e=-this.drawDistance;e<=this.drawDistance;e++)for(let n=-this.drawDistance;n<=this.drawDistance;n++){const s=new Li(this.chunkSize,this.params,this.dataStore);s.position.set(e*this.chunkSize.width,0,n*this.chunkSize.width),s.generate(),s.userData={x:e,z:n},this.add(s)}}update(e){const n=this.getVisibleChunks(e),s=this.getChunksToAdd(n);this.removeUnusedChunks(n);for(const o of s)this.generateChunk(o.x,o.z)}getVisibleChunks(e){const n=[],s=this.worldToChunkCoords(e.position.x,e.position.y,e.position.z),o=s.chunk.x,r=s.chunk.z;for(let a=o-this.drawDistance;a<=o+this.drawDistance;a++)for(let h=r-this.drawDistance;h<=r+this.drawDistance;h++)n.push({x:a,z:h});return n}getChunksToAdd(e){return e.filter(n=>!this.children.map(o=>o.userData).find(({x:o,z:r})=>n.x===o&&n.z===r))}removeUnusedChunks(e){const n=this.children.filter(s=>{const{x:o,z:r}=s.userData;return!e.find(h=>h.x===o&&h.z===r)});for(const s of n)s.disposeInstances(),this.remove(s)}generateChunk(e,n){const s=new Li(this.chunkSize,this.params,this.dataStore);s.position.set(e*this.chunkSize.width,0,n*this.chunkSize.width),s.userData={x:e,z:n},this.asyncLoading?requestIdleCallback(s.generate.bind(s),{timeout:2e3}):s.generate(),this.add(s)}getBlock(e,n,s){const o=this.worldToChunkCoords(e,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);return r?r.getBlock(o.block.x,o.block.y,o.block.z):null}getPlayerBiome(e,n){const s=this.worldToChunkCoords(e,0,n),o=this.getChunk(s.chunk.x,s.chunk.z);return o?o.getBiome(s.block.x,s.block.z):null}worldToChunkCoords(e,n,s){const o={x:Math.floor(e/this.chunkSize.width),z:Math.floor(s/this.chunkSize.width)},r={x:e-this.chunkSize.width*o.x,y:n,z:s-this.chunkSize.width*o.z};return{chunk:o,block:r}}getChunk(e,n){return this.children.find(s=>s.userData.x===e&&s.userData.z===n)}disposeChunks(){this.traverse(e=>{e.disposeInstances&&e.disposeInstances()}),this.clear()}addBlock(e,n,s,o,r){const a=this.worldToChunkCoords(e,n,s),h=this.getChunk(a.chunk.x,a.chunk.z);h&&(h.addBlock(a.block.x,a.block.y,a.block.z,o,r),H(o).transparent!==!0&&(this.hideBlock(e-1,n,s),this.hideBlock(e+1,n,s),this.hideBlock(e,n-1,s),this.hideBlock(e,n+1,s),this.hideBlock(e,n,s-1),this.hideBlock(e,n,s+1)))}removeBlock(e,n,s){const o=this.worldToChunkCoords(e,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);o.block.y!==0&&r&&(this.checkRemoveTree(e,n,s),r.removeBlock(o.block.x,o.block.y,o.block.z),this.revealBlock(e-1,n,s),this.revealBlock(e+1,n,s),this.revealBlock(e,n-1,s),this.revealBlock(e,n+1,s),this.revealBlock(e,n,s-1),this.revealBlock(e,n,s+1))}setBlockInventory(e,n,s,o){const r=this.worldToChunkCoords(e,n,s),a=this.getChunk(r.chunk.x,r.chunk.z);a&&a.setBlockInventory(r.block.x,r.block.y,r.block.z,o)}checkRemoveTree(e,n,s){var r;if(this.getBlock(e,n,s).id==E.log.id)for(let a=-6;a<=6;a++)for(let h=-6;h<=6;h++)for(let c=-6;c<=6;c++){let l=e+a,u=n+h,f=s+c;a===0&&h===0&&c===0||((r=this.getBlock(l,u,f))==null?void 0:r.id)==E.leaves.id&&this.removeBlock(l,u,f)}}revealBlock(e,n,s){const o=this.worldToChunkCoords(e,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.addBlockInstance(o.block.x,o.block.y,o.block.z)}hideBlock(e,n,s){const o=this.worldToChunkCoords(e,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.isBlockObscured(o.block.x,o.block.y,o.block.z)&&r.deleteBlockInstance(o.block.x,o.block.y,o.block.z)}}const Pa="minecraftDB",st="minecraftData";function ms(){return new Promise((t,i)=>{const e=indexedDB.open(Pa,1);e.onupgradeneeded=function(n){n.target.result.createObjectStore(st,{keyPath:"id"})},e.onsuccess=function(n){t(n.target.result)},e.onerror=function(n){i(n.target.error)}})}async function Ha(t){const e=(await ms()).transaction([st],"readwrite");return e.objectStore(st).put({id:"minecraft_data",data:t}),e.oncomplete}async function Ua(){const t=await ms();return new Promise((i,e)=>{const o=t.transaction([st],"readonly").objectStore(st).get("minecraft_data");o.onsuccess=function(){var r;i(((r=o.result)==null?void 0:r.data)||null)},o.onerror=function(r){e(r.target.error)}})}const Fa=new ii;function O(t){const i=Fa.load(t);return i.colorSpace=Dn,i.magFilter=At,i.minFilter=At,i}const b={pig_head_front:O("images/mob/pig/pig_head_front.png"),pig_head_right:O("images/mob/pig/pig_head_right.png"),pig_head_left:O("images/mob/pig/pig_head_left.png"),pig_head_top:O("images/mob/pig/pig_head_top.png"),pig_feet:O("images/mob/pig/pig_feet_side.png"),pig_body_back:O("images/mob/pig/pig_body_back.png"),pig_body_side:O("images/mob/pig/pig_body_side.png"),pig_body_right:O("images/mob/pig/pig_body_right.png"),pig_noise_front:O("images/mob/pig/pig_noise_front.png"),steve_head_front:O("images/player/steve_head_front.png"),steve_head_back:O("images/player/steve_head_back.png"),steve_head_right:O("images/player/steve_head_right.png"),steve_head_left:O("images/player/steve_head_left.png"),steve_head_top:O("images/player/steve_head_top.png"),steve_head_bottom:O("images/player/steve_head_bottom.png"),steve_body_top:O("images/player/steve_body_top.png"),steve_body_front:O("images/player/steve_body_front.png"),steve_body_back:O("images/player/steve_body_back.png"),steve_body_right:O("images/player/steve_body_right.png"),steve_body_left:O("images/player/steve_body_left.png"),steve_arm_top:O("images/player/steve_arm_top.png"),steve_arm_bottom:O("images/player/steve_arm_bottom.png"),steve_arm_front:O("images/player/steve_arm_front.png"),steve_arm_right:O("images/player/steve_arm_right.png"),steve_arm_left:O("images/player/steve_arm_left.png"),steve_arm_back:O("images/player/steve_arm_back.png"),steve_leg_front:O("images/player/steve_leg_front.png"),steve_leg_back:O("images/player/steve_leg_back.png"),steve_leg_right:O("images/player/steve_leg_right.png"),steve_leg_left:O("images/player/steve_leg_left.png")},ie={pig:{id:1,name:"pig",head:{material:[new w({map:b.pig_head_left}),new w({map:b.pig_head_right}),new w({map:b.pig_head_top}),new w({map:b.pig_body_side}),new w({map:b.pig_head_front}),new w({map:b.pig_body_side})]},body:{material:[new w({map:b.pig_body_side}),new w({map:b.pig_body_side}),new w({map:b.pig_body_right}),new w({map:b.pig_body_side}),new w({map:b.pig_body_side}),new w({map:b.pig_body_back})]},feet:{material:[new w({map:b.pig_feet}),new w({map:b.pig_feet}),new w({map:b.pig_feet}),new w({map:b.pig_feet}),new w({map:b.pig_feet}),new w({map:b.pig_feet})]},noise:{material:[new w({map:b.pig_body_side}),new w({map:b.pig_body_side}),new w({map:b.pig_body_side}),new w({map:b.pig_body_side}),new w({map:b.pig_noise_front}),new w({map:b.pig_body_side})]}},steve:{id:1,name:"pig",head:{material:[new w({map:b.steve_head_left}),new w({map:b.steve_head_right}),new w({map:b.steve_head_top}),new w({map:b.steve_head_bottom}),new w({map:b.steve_head_front}),new w({map:b.steve_head_back})]},body:{material:[new w({map:b.steve_body_right}),new w({map:b.steve_body_left}),new w({map:b.steve_body_top}),new w({map:b.pig_body_side}),new w({map:b.steve_body_front}),new w({map:b.steve_body_back})]},leg:{material:[new w({map:b.steve_leg_right}),new w({map:b.steve_leg_left}),new w({map:b.pig_feet}),new w({map:b.pig_feet}),new w({map:b.steve_leg_front}),new w({map:b.steve_leg_back})]},arm:{material:[new w({map:b.steve_arm_right}),new w({map:b.steve_arm_left}),new w({map:b.steve_arm_top}),new w({map:b.steve_arm_bottom}),new w({map:b.steve_arm_front}),new w({map:b.steve_arm_back})]}}};class qa extends at{constructor(){super();const i=new $(.9,.7,1.6),e=new $(.7,.7,.7),n=new $(.32,.25,.1),s=new $(.4,.5,.4),o=new F(i,ie.pig.body.material);o.position.set(0,.6,0),this.add(o);const r=new F(e,ie.pig.head.material);r.position.set(0,.8,1),this.add(r);const a=new F(n,ie.pig.noise.material);a.position.set(0,.7,1.4),this.add(a);for(let h=0;h<4;h++){const c=new F(s,ie.pig.feet.material);c.position.set(h<2?-.25:.25,0,h%2===0?-.7:.6),c.isLeg=!0,this.add(c)}this.position.set(6,69,10),this.BOUNDARY={minX:-50,maxX:50,minZ:-50,maxZ:50},this.target=this.getRandomTarget(),this.pigVelocity=new S(0,0,0)}getRandomTarget(){const i=Math.random()*(this.BOUNDARY.maxX-this.BOUNDARY.minX)+this.BOUNDARY.minX,e=Math.random()*(this.BOUNDARY.maxZ-this.BOUNDARY.minZ)+this.BOUNDARY.minZ;return new S(i,75,e)}movePig(i,e){var o,r;this.world=e,((o=this.world.getBlock(Math.floor(this.position.x),Math.floor(this.position.y),Math.floor(this.position.z)))==null?void 0:o.id)==0?this.pigVelocity.y-=.01:((r=this.world.getBlock(Math.floor(this.position.x),Math.ceil(this.position.y),Math.floor(this.position.z)))==null?void 0:r.id)>0?this.pigVelocity.y+=.05:this.pigVelocity.y=0,this.position.add(this.pigVelocity);const n=2,s=this.target.clone().sub(this.position).normalize();s.y=0,this.position.add(s.multiplyScalar(n*i)),this.position.distanceTo(this.target)<2&&(this.target=this.getRandomTarget()),this.target.y=this.position.y,this.lookAt(this.target),this.animatePigLegs(i)}animatePigLegs(){const e=Math.sin(Date.now()*.005*2);this.children.forEach(n=>{n.isLeg&&(n.rotation.x=e*.2)})}}const Za=new Te({color:16711680,transparent:!0,opacity:.2}),$a=new $(1.001,1.001,1.001),Ka=new Te({wireframe:!0,color:65280}),ja=new Ks(.05,6,6);class Va{constructor(i){y(this,"simulationRate",250);y(this,"timestep",1/this.simulationRate);y(this,"accumulator",0);y(this,"gravity",32);this.helpers=new at,i.add(this.helpers)}update(i,e,n){for(this.accumulator+=i;this.accumulator>=this.timestep;)e.controls.isLocked&&(e.velocity.y-=this.gravity*this.timestep),e.applyInputs(this.timestep),e.updateBoundsHelper(),this.detectCollisions(e,n),this.accumulator-=this.timestep}detectCollisions(i,e){i.onGround=!1,this.helpers.clear();const n=this.broadPhase(i,e),s=this.narrowPhase(n,i);s.length>0&&this.resolveCollisions(s,i)}broadPhase(i,e){var l;const n=[],s=Math.floor(i.position.x-i.radius),o=Math.ceil(i.position.x+i.radius),r=Math.floor(i.position.y-i.height),a=Math.ceil(i.position.y),h=Math.floor(i.position.z-i.radius),c=Math.ceil(i.position.z+i.radius);for(let u=s;u<=o;u++)for(let f=r;f<=a;f++)for(let d=h;d<=c;d++){const p=(l=e.getBlock(u,f,d))==null?void 0:l.id;if(p&&p!==E.empty.id){let v={},m=!1;p==53?(v={x:1,y:1,z:1},m=!0):p==50?v={x:.1,y:.1}:v={x:1,y:1,z:1};const k={x:u,y:f,z:d,size:v,hasStep:m};n.push(k)}}return n}narrowPhase(i,e){const n=[];for(const s of i){const o={x:s.size.x/2,y:s.size.y/2,z:s.size.z/2},r={x:Math.max(s.x-o.x,Math.min(e.position.x,s.x+o.x)),y:Math.max(s.y-o.y,Math.min(e.position.y-e.height/2,s.y+o.y)),z:Math.max(s.z-o.z,Math.min(e.position.z,s.z+o.z))},a=r.x-e.position.x,h=r.y-(e.position.y-e.height/2),c=r.z-e.position.z;if(this.pointInPlayerBoundingCylinder(r,e)){const l=e.height/2-Math.abs(h),u=e.radius-Math.sqrt(a*a+c*c);let f,d;if(l<u?(f=new S(0,-Math.sign(h),0),d=l,e.onGround=!0):(f=new S(-a,0,-c).normalize(),d=u),s.hasStep&&h>-.6&&h<1.2){e.position.y+=Math.min(s.size.y,.1),e.onGround=!0;continue}n.push({block:s,contactPoint:r,normal:f,overlap:d}),this.addContactPointerHelper(r)}}return n}resolveCollisions(i,e){i.sort((n,s)=>n.overlap<s.overlap);for(const n of i){if(!this.pointInPlayerBoundingCylinder(n.contactPoint,e))continue;let s=n.normal.clone();s.multiplyScalar(n.overlap),e.position.add(s);let o=e.worldVelocity.dot(n.normal),r=n.normal.clone().multiplyScalar(o);e.applyWorldDeltaVelocity(r.negate())}}pointInPlayerBoundingCylinder(i,e){const n=i.x-e.position.x,s=i.y-(e.position.y-e.height/2),o=i.z-e.position.z,r=n*n+o*o;return Math.abs(s)<e.height/2&&r<e.radius*e.radius}addCollisionHelper(i){const e=new F($a,Za);e.position.copy(i),this.helpers.add(e)}addContactPointerHelper(i){const e=new F(ja,Ka);e.position.copy(i),this.helpers.add(e)}}class Ga{constructor(){y(this,"fuelList",[E.coal.id]);y(this,"output",2);y(this,"fuel",1);y(this,"input",0);this.smelting=new js}handle(i){this.inventory=i;const e=this.smelting.checkSmelting(i);e&&this.checkFuel(i)?(i[this.output]={block:e.id,quantity:e.quantity},this.decreaseQuantity(this.fuel),this.decreaseQuantity(this.input)):i[this.output]=null}decreaseQuantity(i){this.inventory[i].quantity>1?this.inventory[i].quantity-=1:this.inventory[i]=null}checkFuel(i){var e;return!!this.fuelList.includes((e=i[this.fuel])==null?void 0:e.block)}}const Ya=t=>{let i={};for(let e=0;e<t;e++)i[e]={type:"input"};return i},yt={0:{slot:{0:{type:"input"},1:{type:"input"},2:{type:"input"},3:{type:"input"},4:{type:"ouput"}},grid:2,id:0,name:"empty",visible:!1},61:{slot:{0:{type:"input"},1:{type:"input"},2:{type:"ouput"}},grid:1,id:0,name:"empty",visible:!1},58:{slot:{0:{type:"input"},1:{type:"input"},2:{type:"input"},3:{type:"input"},4:{type:"input"},5:{type:"input"},6:{type:"input"},7:{type:"input"},8:{type:"input"},9:{type:"ouput"}},grid:3,id:0,name:"empty",visible:!1},54:{slot:Ya(27),grid:9,id:0,name:"empty",visible:!1}};class Xa{constructor(i,e){this.player=i,this.inventory=e}open(i){this.player.controls.unlock(),this.inventory.show(i)}}class Wa{constructor(i,e){y(this,"inventoryContainer",document.getElementById("inventory"));y(this,"inventoryStockage",document.getElementById("stockage"));y(this,"inventoryCrafter",document.getElementById("crafter"));y(this,"inventoryOutput",document.getElementById("output"));y(this,"bar",document.getElementById("bar"));y(this,"selectedItemId",27);y(this,"UIID",0);y(this,"output",0);y(this,"items",[{block:E.grass.id,quantity:20},{block:E.stone.id,quantity:20},{block:E.craftingTable.id,quantity:20},{block:E.planks.id,quantity:10},{block:E.log.id,quantity:10},{block:E.furnace.id,quantity:10},{block:E.chest.id,quantity:4},{block:E.glass.id,quantity:40},{block:E.stick.id,quantity:40}]);y(this,"inventory",Array(41).fill(null));y(this,"blockInventory",Array(41).fill(null));y(this,"player",null);y(this,"heldItem",null);y(this,"heldItemElement",document.getElementById("held-item"));this.player=i,this.world=e,this.isShow=!1,this.inventory[0]=this.items[2],this.inventory[1]=this.items[1],this.inventory[3]=this.items[8],this.inventory[27]=this.items[0],this.inventory[28]=this.items[3],this.inventory[29]=this.items[4],this.inventory[30]=this.items[5],this.inventory[31]=this.items[6],this.inventory[32]=this.items[7],this.inventory[33]=this.items[8],this.renderInventory(),this.renderBar(),document.addEventListener("mousemove",n=>{this.heldItem&&(this.heldItemElement.style.left=`${n.pageX-20}px`,this.heldItemElement.style.top=`${n.pageY-20}px`)}),this.recipes=new Vs,this.furnace=new Ga,document.addEventListener("keydown",this.onKeyDown.bind(this))}show(i=0){if(this.isShow=!0,this.inventoryContainer.style.display="block",this.bar.style.display="none",this.UIID=i,console.log(this.player.selectedCoords),this.blockInventory=Array(41).fill(null),this.UIID){let e=this.world.getBlock(this.player.selectedCoords.x,this.player.selectedCoords.y,this.player.selectedCoords.z).inventory;e&&(this.blockInventory=e)}this.renderInventory()}hide(){this.inventoryContainer.style.display="none",this.bar.style.display="grid",this.renderBar(),this.UIID&&this.world.setBlockInventory(this.player.selectedCoords.x,this.player.selectedCoords.y,this.player.selectedCoords.z,this.blockInventory),this.isShow=!1}getBlock(i){return this.inventory[i]}getSelectedItem(){return this.inventory[this.selectedItemId]}selectItem(i){var e;if(i){document.querySelectorAll(".slot").forEach(o=>{o.classList.remove("selected")});const s=document.querySelector('.slot[data-index_bar="'+i+'"]');s&&(s.classList.add("selected"),this.selectedItemId=i),this.player.setBlockInHand((e=this.getBlock(i))==null?void 0:e.block)}}renderInventory(){var n;this.inventoryStockage.innerHTML="",this.inventoryCrafter.innerHTML="",this.inventoryOutput.innerHTML="",this.inventory.forEach((s,o)=>{const r=document.createElement("div");if(r.classList.add("slot"),r.dataset.index=o,s){const a=document.createElement("img"),h=document.createElement("div"),c=Object.values(E).find(l=>l.id===s.block);a.src=c.icon,a.alt=s.block,a.width=200,h.innerHTML=s.quantity,h.classList.add("slot-quantity"),r.appendChild(a),c.stackable&&r.appendChild(h)}r.addEventListener("mousedown",a=>this.handleSlotClick(o,a)),o<36&&this.inventoryStockage.appendChild(r)});const i=(n=yt[this.UIID])==null?void 0:n.slot,e=yt[this.UIID].grid;this.inventoryCrafter.style.gridTemplateColumns="repeat("+e+", 50px)";for(const s in i)if(i.hasOwnProperty(s)){const o=i[s],r=document.createElement("div");if(r.classList.add("slot"),r.dataset.index=o.name,this.blockInventory[s]!==null){const a=document.createElement("img"),h=document.createElement("div"),c=Object.values(E).find(l=>l.id===this.blockInventory[s].block);a.src=c.icon,a.alt=this.blockInventory[s].block,a.width=200,h.innerHTML=this.blockInventory[s].quantity,h.classList.add("slot-quantity"),r.appendChild(a),c.stackable&&r.appendChild(h)}r.addEventListener("mousedown",a=>this.handleSlotBlockClick(s,a)),i[s].type=="input"?this.inventoryCrafter.appendChild(r):(this.output=s,this.inventoryOutput.appendChild(r))}}renderBar(){this.bar.innerHTML="",this.inventory.forEach((i,e)=>{if(e>=27&&e<36){const n=document.createElement("div");if(n.classList.add("slot"),n.dataset.index_bar=e,e==this.selectedItemId&&n.classList.add("selected"),i){const s=document.createElement("img"),o=document.createElement("div"),r=Object.values(E).find(a=>a.id===i.block);s.src=r.icon,s.alt=i.block,s.width=200,o.innerHTML=i.quantity,o.classList.add("slot-quantity"),n.appendChild(s),r.stackable&&n.appendChild(o)}this.bar.appendChild(n)}})}inventoryToGrid(){var r,a,h;const i=yt[this.UIID].grid;let e=[];for(let c=0;c<i;c++){const l=[];for(let u=0;u<i;u++)l.push(null);e.push(l)}const n=(r=yt[this.UIID])==null?void 0:r.slot;let s=0,o=0;for(const c in n){if(o>=i&&(o=0,s++,s>=i))break;(a=this.blockInventory[c])!=null&&a.block?e[s][o]=(h=this.blockInventory[c])==null?void 0:h.block:e[s][o]=null,o++}return e}handleSlotClick(i,e){const n=this.inventory[i];if(this.heldItem)if(!n)e.button==0?(this.inventory[i]=this.heldItem,this.clearHeldItem()):(this.inventory[i]={...this.heldItem},this.inventory[i].quantity=1,this.setHeldItem(this.heldItem.block,this.heldItem.quantity-=1));else if(this.inventory[i].block==this.heldItem.block&&H(this.inventory[i].block).stackable)this.inventory[i].quantity+=this.heldItem.quantity,this.clearHeldItem();else{[this.inventory[i],this.heldItem]=[this.heldItem,this.inventory[i]];const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon}else if(n)if(e.button==0){this.heldItem=this.inventory[i],this.inventory[i]=null;const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon,this.heldItemElement.style.display="block"}else{this.heldItem={...this.inventory[i]},this.heldItem.quantity=Math.round(this.heldItem.quantity/2),this.inventory[i].quantity=Math.floor(this.inventory[i].quantity/2);const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon,this.heldItemElement.style.display="block"}this.renderInventory()}handleSlotBlockClick(i,e){const n=this.blockInventory[i];if(this.heldItem){if(!n)e.button==0?i!=this.output&&(this.blockInventory[i]=this.heldItem,this.clearHeldItem()):(this.blockInventory[i]={...this.heldItem},this.blockInventory[i].quantity=1,this.setHeldItem(this.heldItem.block,this.heldItem.quantity-=1));else if(this.blockInventory[i].block==this.heldItem.block&&H(this.blockInventory[i].block).stackable)i==this.output?this.setHeldItem(this.heldItem.block,this.heldItem.quantity+=this.blockInventory[i].quantity):(this.blockInventory[i].quantity+=this.heldItem.quantity,this.clearHeldItem());else if(i!=this.output){[this.blockInventory[i],this.heldItem]=[this.heldItem,this.blockInventory[i]];const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon}}else n&&(e.button==0?(this.setHeldItem(this.blockInventory[i].block,this.blockInventory[i].quantity),this.blockInventory[i]=null):(this.setHeldItem(this.blockInventory[i].block,Math.round(this.blockInventory[i].quantity/2)),this.blockInventory[i].quantity=Math.floor(this.blockInventory[i].quantity/2)));if(this.UIID==0||this.UIID==58){const s=this.recipes.checkRecipe(this.inventoryToGrid());s?this.blockInventory[this.output]={block:s.id,quantity:s.quantity}:this.blockInventory[this.output]=null}else this.UIID==E.furnace.id&&this.furnace.handle(this.blockInventory);this.renderInventory()}clearHeldItem(){this.heldItem=null,this.heldItemElement.style.display="none"}setHeldItem(i,e){this.heldItem={block:i,quantity:e};const n=H(i);this.heldItemElement.src=n.icon,this.heldItemElement.style.display="block",e<1&&this.clearHeldItem()}addBlock(i){let e=!1;this.inventory.forEach((n,s)=>{s<36&&(n==null?void 0:n.block)==i&&(n.quantity+=1,e=!0)}),e||this.inventory.forEach((n,s)=>{s<36&&!e&&n==null&&(console.log(i),this.inventory[s]={quantity:1,block:i},e=!0)}),this.renderBar()}removeBlock(i){this.inventory.forEach((e,n)=>{n<36&&(e==null?void 0:e.block)==i&&(e.quantity-=1,e.quantity<=0&&(this.inventory[n]=null))}),this.renderBar()}save(){(async()=>{new Blob([JSON.stringify(this.inventory)]).size;const i=this.inventory;await Qa(i)})()}load(){(async()=>{const i=await ec();this.inventory=i,this.renderBar()})()}onKeyDown(i){document.querySelectorAll(".item").forEach(n=>n.classList.remove("selected"));let e=null;i.code==="Digit1"&&(e=27),i.code==="Digit2"&&(e=28),i.code==="Digit3"&&(e=29),i.code==="Digit4"&&(e=30),i.code==="Digit5"&&(e=31),i.code==="Digit6"&&(e=32),i.code==="Digit7"&&(e=33),i.code==="Digit8"&&(e=34),i.code==="Digit9"&&(e=35),e&&this.selectItem(e),i.key==="Escape"&&this.isShow&&(this.hide(),this.player.controls.lock())}}const Ja="minecraftDB",ot="minecraftData";function gs(){return new Promise((t,i)=>{const e=indexedDB.open(Ja,1);e.onupgradeneeded=function(n){n.target.result.createObjectStore(ot,{keyPath:"id"})},e.onsuccess=function(n){t(n.target.result)},e.onerror=function(n){i(n.target.error)}})}async function Qa(t){const e=(await gs()).transaction([ot],"readwrite");return e.objectStore(ot).put({id:"minecraft_inventory",data:t}),e.complete}async function ec(){const t=await gs();return new Promise((i,e)=>{const o=t.transaction([ot],"readonly").objectStore(ot).get("minecraft_inventory");o.onsuccess=function(){var r;i(((r=o.result)==null?void 0:r.data)||null)},o.onerror=function(r){e(r.target.error)}})}class tc{constructor(i,e,n,s,o){this.world=i,this.player=e,this.inventory=n,this.client=s,this.chat=o,document.getElementById("backToGame").addEventListener("click",()=>this.backToGame()),document.getElementById("save").addEventListener("click",()=>this.save()),document.getElementById("load").addEventListener("click",()=>this.load()),document.getElementById("connect").addEventListener("click",()=>this.connect()),window.addEventListener("keydown",l=>{l.key==="Escape"&&this.inventory.isShow===!1&&this.openMenu()})}backToGame(){document.getElementById("menu").style.display="none",this.player.controls.lock(),this.inventory.hide()}openMenu(){document.getElementById("menu").style.display="block",this.inventory.hide()}save(){this.world.save(),this.inventory.save(),this.player.save(),this.chat.add("Saved game")}load(){this.world.load(),this.inventory.load(),this.player.load(),this.chat.add("Load saved")}connect(){this.client.getSocket()||this.client.init()}}class ic{constructor(i,e,n){this.scene=i,this.sun=new Gs,this.time=n,this.setupLights(),this.player=e,this.dayDuration=1200*1e3;const s=new $(5,5,5),o=new Te({color:16777215});this.sunMesh=new F(s,o),this.sunMesh.position.set(50,100,50),i.add(this.sunMesh)}setupLights(){this.sun.intensity=1.5,this.sun.position.set(50,120,-10),this.sun.castShadow=!0,this.sun.shadow.camera.left=-40,this.sun.shadow.camera.right=40,this.sun.shadow.camera.top=40,this.sun.shadow.camera.bottom=-40,this.sun.shadow.camera.near=.1,this.sun.shadow.camera.far=200,this.sun.shadow.bias=-1e-4,this.sun.shadow.mapSize=new zn(2048,2048),this.scene.add(this.sun),this.scene.add(this.sun.target),new Ys(this.sun.shadow.camera);const i=new Xs;i.intensity=.2,this.scene.add(i)}update(i){this.updateDayNightCycle(i)}updateDayNightCycle(i){this.time+=i/this.dayDuration,this.time>1&&(this.time=0);const e=this.time*Math.PI*2;this.sun.position.copy(this.player.camera.position),this.sun.position.sub(new S(-Math.cos(e)*50,-(Math.sin(e)*50),-10)),this.sunMesh.position.copy(this.player.camera.position),this.sunMesh.position.sub(new S(-Math.cos(e)*50,-(Math.sin(e)*50),-10)),this.sun.target.position.copy(this.player.camera.position)}getTime(){let i=this.time*24*60,e=parseInt(i/60),n=parseInt(i%60);return e+"H"+n}}const ae=Object.create(null);ae.open="0";ae.close="1";ae.ping="2";ae.pong="3";ae.message="4";ae.upgrade="5";ae.noop="6";const xt=Object.create(null);Object.keys(ae).forEach(t=>{xt[ae[t]]=t});const ui={type:"error",data:"parser error"},ys=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ws=typeof ArrayBuffer=="function",bs=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ii=({type:t,data:i},e,n)=>ys&&i instanceof Blob?e?n(i):xn(i,n):ws&&(i instanceof ArrayBuffer||bs(i))?e?n(i):xn(new Blob([i]),n):n(ae[t]+(i||"")),xn=(t,i)=>{const e=new FileReader;return e.onload=function(){const n=e.result.split(",")[1];i("b"+(n||""))},e.readAsDataURL(t)};function En(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Wt;function nc(t,i){if(ys&&t.data instanceof Blob)return t.data.arrayBuffer().then(En).then(i);if(ws&&(t.data instanceof ArrayBuffer||bs(t.data)))return i(En(t.data));Ii(t,!1,e=>{Wt||(Wt=new TextEncoder),i(Wt.encode(e))})}const Sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ze=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Sn.length;t++)Ze[Sn.charCodeAt(t)]=t;const sc=t=>{let i=t.length*.75,e=t.length,n,s=0,o,r,a,h;t[t.length-1]==="="&&(i--,t[t.length-2]==="="&&i--);const c=new ArrayBuffer(i),l=new Uint8Array(c);for(n=0;n<e;n+=4)o=Ze[t.charCodeAt(n)],r=Ze[t.charCodeAt(n+1)],a=Ze[t.charCodeAt(n+2)],h=Ze[t.charCodeAt(n+3)],l[s++]=o<<2|r>>4,l[s++]=(r&15)<<4|a>>2,l[s++]=(a&3)<<6|h&63;return c},oc=typeof ArrayBuffer=="function",Ai=(t,i)=>{if(typeof t!="string")return{type:"message",data:ks(t,i)};const e=t.charAt(0);return e==="b"?{type:"message",data:rc(t.substring(1),i)}:xt[e]?t.length>1?{type:xt[e],data:t.substring(1)}:{type:xt[e]}:ui},rc=(t,i)=>{if(oc){const e=sc(t);return ks(e,i)}else return{base64:!0,data:t}},ks=(t,i)=>{switch(i){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},vs="",ac=(t,i)=>{const e=t.length,n=new Array(e);let s=0;t.forEach((o,r)=>{Ii(o,!1,a=>{n[r]=a,++s===e&&i(n.join(vs))})})},cc=(t,i)=>{const e=t.split(vs),n=[];for(let s=0;s<e.length;s++){const o=Ai(e[s],i);if(n.push(o),o.type==="error")break}return n};function lc(){return new TransformStream({transform(t,i){nc(t,e=>{const n=e.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const o=new DataView(s.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{s=new Uint8Array(9);const o=new DataView(s.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(s[0]|=128),i.enqueue(s),i.enqueue(e)})}})}let Jt;function wt(t){return t.reduce((i,e)=>i+e.length,0)}function bt(t,i){if(t[0].length===i)return t.shift();const e=new Uint8Array(i);let n=0;for(let s=0;s<i;s++)e[s]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),e}function hc(t,i){Jt||(Jt=new TextDecoder);const e=[];let n=0,s=-1,o=!1;return new TransformStream({transform(r,a){for(e.push(r);;){if(n===0){if(wt(e)<1)break;const h=bt(e,1);o=(h[0]&128)===128,s=h[0]&127,s<126?n=3:s===126?n=1:n=2}else if(n===1){if(wt(e)<2)break;const h=bt(e,2);s=new DataView(h.buffer,h.byteOffset,h.length).getUint16(0),n=3}else if(n===2){if(wt(e)<8)break;const h=bt(e,8),c=new DataView(h.buffer,h.byteOffset,h.length),l=c.getUint32(0);if(l>Math.pow(2,21)-1){a.enqueue(ui);break}s=l*Math.pow(2,32)+c.getUint32(4),n=3}else{if(wt(e)<s)break;const h=bt(e,s);a.enqueue(Ai(o?h:Jt.decode(h),i)),n=0}if(s===0||s>t){a.enqueue(ui);break}}}})}const xs=4;function N(t){if(t)return dc(t)}function dc(t){for(var i in N.prototype)t[i]=N.prototype[i];return t}N.prototype.on=N.prototype.addEventListener=function(t,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(i),this};N.prototype.once=function(t,i){function e(){this.off(t,e),i.apply(this,arguments)}return e.fn=i,this.on(t,e),this};N.prototype.off=N.prototype.removeListener=N.prototype.removeAllListeners=N.prototype.removeEventListener=function(t,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+t];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,s=0;s<e.length;s++)if(n=e[s],n===i||n.fn===i){e.splice(s,1);break}return e.length===0&&delete this._callbacks["$"+t],this};N.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),e=this._callbacks["$"+t],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(e){e=e.slice(0);for(var n=0,s=e.length;n<s;++n)e[n].apply(this,i)}return this};N.prototype.emitReserved=N.prototype.emit;N.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};N.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Lt=typeof Promise=="function"&&typeof Promise.resolve=="function"?i=>Promise.resolve().then(i):(i,e)=>e(i,0),W=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),fc="arraybuffer";function Es(t,...i){return i.reduce((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e),{})}const uc=W.setTimeout,pc=W.clearTimeout;function Mt(t,i){i.useNativeTimers?(t.setTimeoutFn=uc.bind(W),t.clearTimeoutFn=pc.bind(W)):(t.setTimeoutFn=W.setTimeout.bind(W),t.clearTimeoutFn=W.clearTimeout.bind(W))}const _c=1.33;function mc(t){return typeof t=="string"?gc(t):Math.ceil((t.byteLength||t.size)*_c)}function gc(t){let i=0,e=0;for(let n=0,s=t.length;n<s;n++)i=t.charCodeAt(n),i<128?e+=1:i<2048?e+=2:i<55296||i>=57344?e+=3:(n++,e+=4);return e}function Ss(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function yc(t){let i="";for(let e in t)t.hasOwnProperty(e)&&(i.length&&(i+="&"),i+=encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return i}function wc(t){let i={},e=t.split("&");for(let n=0,s=e.length;n<s;n++){let o=e[n].split("=");i[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return i}class bc extends Error{constructor(i,e,n){super(i),this.description=e,this.context=n,this.type="TransportError"}}class Ci extends N{constructor(i){super(),this.writable=!1,Mt(this,i),this.opts=i,this.query=i.query,this.socket=i.socket,this.supportsBinary=!i.forceBase64}onError(i,e,n){return super.emitReserved("error",new bc(i,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(i){this.readyState==="open"&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const e=Ai(i,this.socket.binaryType);this.onPacket(e)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,e={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const i=this.opts.hostname;return i.indexOf(":")===-1?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(i){const e=yc(i);return e.length?"?"+e:""}}class kc extends Ci{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(i){this.readyState="pausing";const e=()=>{this.readyState="paused",i()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||e()})),this.writable||(n++,this.once("drain",function(){--n||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){const e=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};cc(i,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const i=()=>{this.write([{type:"close"}])};this.readyState==="open"?i():this.once("open",i)}write(i){this.writable=!1,ac(i,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Ss()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(i,e)}}let Is=!1;try{Is=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const vc=Is;function xc(){}class Ec extends kc{constructor(i){if(super(i),typeof location<"u"){const e=location.protocol==="https:";let n=location.port;n||(n=e?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||n!==i.port}}doWrite(i,e){const n=this.request({method:"POST",data:i});n.on("success",e),n.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(e,n)=>{this.onError("xhr poll error",e,n)}),this.pollXhr=i}}class re extends N{constructor(i,e,n){super(),this.createRequest=i,Mt(this,n),this._opts=n,this._method=n.method||"GET",this._uri=e,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var i;const e=Es(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(e);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let s in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this._opts.extraHeaders[s])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(i=this._opts.cookieJar)===null||i===void 0||i.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var s;n.readyState===3&&((s=this._opts.cookieJar)===null||s===void 0||s.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(s){this.setTimeoutFn(()=>{this._onError(s)},0);return}typeof document<"u"&&(this._index=re.requestsCount++,re.requests[this._index]=this)}_onError(i){this.emitReserved("error",i,this._xhr),this._cleanup(!0)}_cleanup(i){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=xc,i)try{this._xhr.abort()}catch{}typeof document<"u"&&delete re.requests[this._index],this._xhr=null}}_onLoad(){const i=this._xhr.responseText;i!==null&&(this.emitReserved("data",i),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}re.requestsCount=0;re.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",In);else if(typeof addEventListener=="function"){const t="onpagehide"in W?"pagehide":"unload";addEventListener(t,In,!1)}}function In(){for(let t in re.requests)re.requests.hasOwnProperty(t)&&re.requests[t].abort()}const Sc=function(){const t=As({xdomain:!1});return t&&t.responseType!==null}();class Ic extends Ec{constructor(i){super(i);const e=i&&i.forceBase64;this.supportsBinary=Sc&&!e}request(i={}){return Object.assign(i,{xd:this.xd},this.opts),new re(As,this.uri(),i)}}function As(t){const i=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||vc))return new XMLHttpRequest}catch{}if(!i)try{return new W[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Cs=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ac extends Ci{get name(){return"websocket"}doOpen(){const i=this.uri(),e=this.opts.protocols,n=Cs?{}:Es(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(i,e,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let e=0;e<i.length;e++){const n=i[e],s=e===i.length-1;Ii(n,this.supportsBinary,o=>{try{this.doWrite(n,o)}catch{}s&&Lt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Ss()),this.supportsBinary||(e.b64=1),this.createUri(i,e)}}const Qt=W.WebSocket||W.MozWebSocket;class Cc extends Ac{createSocket(i,e,n){return Cs?new Qt(i,e,n):e?new Qt(i,e):new Qt(i)}doWrite(i,e){this.ws.send(e)}}class Bc extends Ci{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(i){return this.emitReserved("error",i)}this._transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(i=>{const e=hc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=i.readable.pipeThrough(e).getReader(),s=lc();s.readable.pipeTo(i.writable),this._writer=s.writable.getWriter();const o=()=>{n.read().then(({done:a,value:h})=>{a||(this.onPacket(h),o())}).catch(a=>{})};o();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then(()=>this.onOpen())})})}write(i){this.writable=!1;for(let e=0;e<i.length;e++){const n=i[e],s=e===i.length-1;this._writer.write(n).then(()=>{s&&Lt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var i;(i=this._transport)===null||i===void 0||i.close()}}const Tc={websocket:Cc,webtransport:Bc,polling:Ic},Rc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Dc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function pi(t){if(t.length>8e3)throw"URI too long";const i=t,e=t.indexOf("["),n=t.indexOf("]");e!=-1&&n!=-1&&(t=t.substring(0,e)+t.substring(e,n).replace(/:/g,";")+t.substring(n,t.length));let s=Rc.exec(t||""),o={},r=14;for(;r--;)o[Dc[r]]=s[r]||"";return e!=-1&&n!=-1&&(o.source=i,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=zc(o,o.path),o.queryKey=Oc(o,o.query),o}function zc(t,i){const e=/\/{2,9}/g,n=i.replace(e,"/").split("/");return(i.slice(0,1)=="/"||i.length===0)&&n.splice(0,1),i.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Oc(t,i){const e={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,o){s&&(e[s]=o)}),e}const _i=typeof addEventListener=="function"&&typeof removeEventListener=="function",Et=[];_i&&addEventListener("offline",()=>{Et.forEach(t=>t())},!1);class ge extends N{constructor(i,e){if(super(),this.binaryType=fc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,i&&typeof i=="object"&&(e=i,i=null),i){const n=pi(i);e.hostname=n.host,e.secure=n.protocol==="https"||n.protocol==="wss",e.port=n.port,n.query&&(e.query=n.query)}else e.host&&(e.hostname=pi(e.host).host);Mt(this,e),this.secure=e.secure!=null?e.secure:typeof location<"u"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=e.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach(n=>{const s=n.prototype.name;this.transports.push(s),this._transportsByName[s]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=wc(this.opts.query)),_i&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Et.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(i){const e=Object.assign({},this.opts.query);e.EIO=xs,e.transport=i,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[i]);return new this._transportsByName[i](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const i=this.opts.rememberUpgrade&&ge.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(i);e.open(),this.setTransport(e)}setTransport(i){this.transport&&this.transport.removeAllListeners(),this.transport=i,i.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",ge.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",i),this.emitReserved("heartbeat"),i.type){case"open":this.onHandshake(JSON.parse(i.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=i.data,this._onError(e);break;case"message":this.emitReserved("data",i.data),this.emitReserved("message",i.data);break}}onHandshake(i){this.emitReserved("handshake",i),this.id=i.sid,this.transport.query.sid=i.sid,this._pingInterval=i.pingInterval,this._pingTimeout=i.pingTimeout,this._maxPayload=i.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const i=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+i,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},i),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const i=this._getWritablePackets();this.transport.send(i),this._prevBufferLen=i.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(e+=mc(s)),n>0&&e>this._maxPayload)return this.writeBuffer.slice(0,n);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const i=Date.now()>this._pingTimeoutTime;return i&&(this._pingTimeoutTime=0,Lt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),i}write(i,e,n){return this._sendPacket("message",i,e,n),this}send(i,e,n){return this._sendPacket("message",i,e,n),this}_sendPacket(i,e,n,s){if(typeof e=="function"&&(s=e,e=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:i,data:e,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){const i=()=>{this._onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),i()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():i()}):this.upgrading?n():i()),this}_onError(i){if(ge.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",i),this._onClose("transport error",i)}_onClose(i,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),_i&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=Et.indexOf(this._offlineEventListener);n!==-1&&Et.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",i,e),this.writeBuffer=[],this._prevBufferLen=0}}}ge.protocol=xs;class Lc extends ge{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(i){let e=this.createTransport(i),n=!1;ge.priorWebsocketSuccess=!1;const s=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;ge.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=e.name,this.emitReserved("upgradeError",f)}}))};function o(){n||(n=!0,l(),e.close(),e=null)}const r=u=>{const f=new Error("probe error: "+u);f.transport=e.name,o(),this.emitReserved("upgradeError",f)};function a(){r("transport closed")}function h(){r("socket closed")}function c(u){e&&u.name!==e.name&&o()}const l=()=>{e.removeListener("open",s),e.removeListener("error",r),e.removeListener("close",a),this.off("close",h),this.off("upgrading",c)};e.once("open",s),e.once("error",r),e.once("close",a),this.once("close",h),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&i!=="webtransport"?this.setTimeoutFn(()=>{n||e.open()},200):e.open()}onHandshake(i){this._upgrades=this._filterUpgrades(i.upgrades),super.onHandshake(i)}_filterUpgrades(i){const e=[];for(let n=0;n<i.length;n++)~this.transports.indexOf(i[n])&&e.push(i[n]);return e}}let Mc=class extends Lc{constructor(i,e={}){const n=typeof i=="object"?i:e;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(s=>Tc[s]).filter(s=>!!s)),super(i,n)}};function Nc(t,i="",e){let n=t;e=e||typeof location<"u"&&location,t==null&&(t=e.protocol+"//"+e.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=e.protocol+t:t=e.host+t),/^(https?|wss?):\/\//.test(t)||(typeof e<"u"?t=e.protocol+"//"+t:t="https://"+t),n=pi(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+i,n.href=n.protocol+"://"+o+(e&&e.port===n.port?"":":"+n.port),n}const Pc=typeof ArrayBuffer=="function",Hc=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Bs=Object.prototype.toString,Uc=typeof Blob=="function"||typeof Blob<"u"&&Bs.call(Blob)==="[object BlobConstructor]",Fc=typeof File=="function"||typeof File<"u"&&Bs.call(File)==="[object FileConstructor]";function Bi(t){return Pc&&(t instanceof ArrayBuffer||Hc(t))||Uc&&t instanceof Blob||Fc&&t instanceof File}function St(t,i){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(St(t[e]))return!0;return!1}if(Bi(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return St(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&St(t[e]))return!0;return!1}function qc(t){const i=[],e=t.data,n=t;return n.data=mi(e,i),n.attachments=i.length,{packet:n,buffers:i}}function mi(t,i){if(!t)return t;if(Bi(t)){const e={_placeholder:!0,num:i.length};return i.push(t),e}else if(Array.isArray(t)){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=mi(t[n],i);return e}else if(typeof t=="object"&&!(t instanceof Date)){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=mi(t[n],i));return e}return t}function Zc(t,i){return t.data=gi(t.data,i),delete t.attachments,t}function gi(t,i){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<i.length)return i[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]=gi(t[e],i);else if(typeof t=="object")for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=gi(t[e],i));return t}const $c=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Kc=5;var C;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(C||(C={}));class jc{constructor(i){this.replacer=i}encode(i){return(i.type===C.EVENT||i.type===C.ACK)&&St(i)?this.encodeAsBinary({type:i.type===C.EVENT?C.BINARY_EVENT:C.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id}):[this.encodeAsString(i)]}encodeAsString(i){let e=""+i.type;return(i.type===C.BINARY_EVENT||i.type===C.BINARY_ACK)&&(e+=i.attachments+"-"),i.nsp&&i.nsp!=="/"&&(e+=i.nsp+","),i.id!=null&&(e+=i.id),i.data!=null&&(e+=JSON.stringify(i.data,this.replacer)),e}encodeAsBinary(i){const e=qc(i),n=this.encodeAsString(e.packet),s=e.buffers;return s.unshift(n),s}}function An(t){return Object.prototype.toString.call(t)==="[object Object]"}class Ti extends N{constructor(i){super(),this.reviver=i}add(i){let e;if(typeof i=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(i);const n=e.type===C.BINARY_EVENT;n||e.type===C.BINARY_ACK?(e.type=n?C.EVENT:C.ACK,this.reconstructor=new Vc(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(Bi(i)||i.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(i),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+i)}decodeString(i){let e=0;const n={type:Number(i.charAt(0))};if(C[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===C.BINARY_EVENT||n.type===C.BINARY_ACK){const o=e+1;for(;i.charAt(++e)!=="-"&&e!=i.length;);const r=i.substring(o,e);if(r!=Number(r)||i.charAt(e)!=="-")throw new Error("Illegal attachments");n.attachments=Number(r)}if(i.charAt(e+1)==="/"){const o=e+1;for(;++e&&!(i.charAt(e)===","||e===i.length););n.nsp=i.substring(o,e)}else n.nsp="/";const s=i.charAt(e+1);if(s!==""&&Number(s)==s){const o=e+1;for(;++e;){const r=i.charAt(e);if(r==null||Number(r)!=r){--e;break}if(e===i.length)break}n.id=Number(i.substring(o,e+1))}if(i.charAt(++e)){const o=this.tryParse(i.substr(e));if(Ti.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,e){switch(i){case C.CONNECT:return An(e);case C.DISCONNECT:return e===void 0;case C.CONNECT_ERROR:return typeof e=="string"||An(e);case C.EVENT:case C.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&$c.indexOf(e[0])===-1);case C.ACK:case C.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Vc{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const e=Zc(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Gc=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ti,Encoder:jc,get PacketType(){return C},protocol:Kc},Symbol.toStringTag,{value:"Module"}));function ee(t,i,e){return t.on(i,e),function(){t.off(i,e)}}const Yc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ts extends N{constructor(i,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[ee(i,"open",this.onopen.bind(this)),ee(i,"packet",this.onpacket.bind(this)),ee(i,"error",this.onerror.bind(this)),ee(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...e){var n,s,o;if(Yc.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(e.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const r={type:C.EVENT,data:e};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){const l=this.ids++,u=e.pop();this._registerAckCallback(l,u),r.id=l}const a=(s=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||s===void 0?void 0:s.writable,h=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!a||(h?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(i,e){var n;const s=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(s===void 0){this.acks[i]=e;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===i&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},s),r=(...a)=>{this.io.clearTimeoutFn(o),e.apply(this,a)};r.withError=!0,this.acks[i]=r}emitWithAck(i,...e){return new Promise((n,s)=>{const o=(r,a)=>r?s(r):n(a);o.withError=!0,e.push(o),this.emit(i,...e)})}_addToQueue(i){let e;typeof i[i.length-1]=="function"&&(e=i.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((s,...o)=>n!==this._queue[0]?void 0:(s!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(s)):(this._queue.shift(),e&&e(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||this._queue.length===0)return;const e=this._queue[0];e.pending&&!i||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){typeof this.auth=="function"?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:C.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(i=>{if(!this.sendBuffer.some(n=>String(n.id)===i)){const n=this.acks[i];delete this.acks[i],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case C.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case C.EVENT:case C.BINARY_EVENT:this.onevent(i);break;case C.ACK:case C.BINARY_ACK:this.onack(i);break;case C.DISCONNECT:this.ondisconnect();break;case C.CONNECT_ERROR:this.destroy();const n=new Error(i.data.message);n.data=i.data.data,this.emitReserved("connect_error",n);break}}onevent(i){const e=i.data||[];i.id!=null&&e.push(this.ack(i.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&typeof i[i.length-1]=="string"&&(this._lastOffset=i[i.length-1])}ack(i){const e=this;let n=!1;return function(...s){n||(n=!0,e.packet({type:C.ACK,id:i,data:s}))}}onack(i){const e=this.acks[i.id];typeof e=="function"&&(delete this.acks[i.id],e.withError&&i.data.unshift(null),e.apply(this,i.data))}onconnect(i,e){this.id=i,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:C.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(i===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(i===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,i.data)}}}function Pe(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Pe.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),e=Math.floor(i*this.jitter*t);t=Math.floor(i*10)&1?t+e:t-e}return Math.min(t,this.max)|0};Pe.prototype.reset=function(){this.attempts=0};Pe.prototype.setMin=function(t){this.ms=t};Pe.prototype.setMax=function(t){this.max=t};Pe.prototype.setJitter=function(t){this.jitter=t};class yi extends N{constructor(i,e){var n;super(),this.nsps={},this.subs=[],i&&typeof i=="object"&&(e=i,i=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,Mt(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((n=e.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Pe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=i;const s=e.parser||Gc;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,i||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var e;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(e=this.backoff)===null||e===void 0||e.setMin(i),this)}randomizationFactor(i){var e;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(e=this.backoff)===null||e===void 0||e.setJitter(i),this)}reconnectionDelayMax(i){var e;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(e=this.backoff)===null||e===void 0||e.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new Mc(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=ee(e,"open",function(){n.onopen(),i&&i()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),i?i(a):this.maybeReconnectOnOpen()},r=ee(e,"error",o);if(this._timeout!==!1){const a=this._timeout,h=this.setTimeoutFn(()=>{s(),o(new Error("timeout")),e.close()},a);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}return this.subs.push(s),this.subs.push(r),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(ee(i,"ping",this.onping.bind(this)),ee(i,"data",this.ondata.bind(this)),ee(i,"error",this.onerror.bind(this)),ee(i,"close",this.onclose.bind(this)),ee(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(e){this.onclose("parse error",e)}}ondecoded(i){Lt(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,e){let n=this.nsps[i];return n?this._autoConnect&&!n.active&&n.connect():(n=new Ts(this,i,e),this.nsps[i]=n),n}_destroy(i){const e=Object.keys(this.nsps);for(const n of e)if(this.nsps[n].active)return;this._close()}_packet(i){const e=this.encoder.encode(i);for(let n=0;n<e.length;n++)this.engine.write(e[n],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(i,e){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(s=>{s?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",s)):i.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const Ue={};function It(t,i){typeof t=="object"&&(i=t,t=void 0),i=i||{};const e=Nc(t,i.path||"/socket.io"),n=e.source,s=e.id,o=e.path,r=Ue[s]&&o in Ue[s].nsps,a=i.forceNew||i["force new connection"]||i.multiplex===!1||r;let h;return a?h=new yi(n,i):(Ue[s]||(Ue[s]=new yi(n,i)),h=Ue[s]),e.query&&!i.query&&(i.query=e.queryKey),h.socket(e.path,i)}Object.assign(It,{Manager:yi,Socket:Ts,io:It,connect:It});class Xc{constructor(i,e,n){this.players={},this.playersMesh={},this.world=i,this.scene=e,this.socket=null,this.chat=n,window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this))}getSocket(){return this.socket}init(){this.socket=It("https://baptiste-texier.ddns.net:3000"),this.socket.on("connect",i=>{this.chat.add("Connected to server","#FFFF55"),this.socket.emit("join",{username:"Joueur1",position:{x:0,y:71,z:10},direction:{x:0,y:0,z:0}})}),this.socket.on("connect_error",i=>{this.chat.add("Unable to connect to server")}),this.socket.on("player-connect",i=>{console.log("Joueurs connectés:",i),this.chat.add(i.id+" joined the game","#FFFF55"),this.updatePlayers({[i.id]:i})}),this.socket.on("player-disconnect",i=>{console.log("Joueurs déconnecté:",i),this.chat.add(i+" left the game"),this.scene.remove(this.playersMesh[i])}),this.socket.on("addBlock",i=>{this.world.addBlock(i.x,i.y,i.z,i.blockId)}),this.socket.on("removeBlock",i=>{this.world.removeBlock(i.x,i.y,i.z)}),this.socket.on("playerState",i=>{this.updatePlayers(i)})}updatePlayers(i){for(let e in i)if(e!=this.socket.id){if(!this.players[e]){const l=this.createPlayerMesh();this.scene.add(l),this.players[e]=l,this.playersMesh[e]=l}this.players[e].position.set(i[e].position.x,i[e].position.y,i[e].position.z);const n=this.players[e],s=i[e].position.x+i[e].direction.x,o=i[e].position.y+i[e].direction.y,r=i[e].position.z+i[e].direction.z,a=new S(s,n.position.y,r),h=Math.atan2(a.z-n.position.z,a.x-n.position.x);this.players[e].rotation.y=h,this.players[e].lookAt(new S(s,n.position.y,r)),this.players[e].getObjectByName("head").lookAt(new S(s,o,r))}}createPlayerMesh(){const i=new at;new Ws({color:65280});const e=new F(new $(.25,.72,.25),ie.steve.leg.material);e.position.set(-.12,-1.45,0),i.add(e);const n=new F(new $(.25,.72,.25),ie.steve.leg.material);n.position.set(.12,-1.45,0),i.add(n);const s=new F(new $(.5,.71,.25),ie.steve.body.material);s.position.set(0,-.75,0),i.add(s);const o=new F(new $(.5,.5,.5),ie.steve.head.material);o.position.set(0,-.15,0),o.name="head",i.add(o);const r=new F(new $(.25,.71,.25),ie.steve.arm.material);r.position.set(-.38,-.75,0),i.add(r);const a=new F(new $(.25,.71,.25),ie.steve.arm.material);return a.position.set(.38,-.75,0),i.add(a),i}displayPlayersList(){let i=document.getElementById("playerList");if(this.socket){let e="";e+="<span>"+this.socket.id+"</span><br>";for(const n in this.players)this.players.hasOwnProperty(n)&&(console.log(`Clé: ${n}, UUID: ${this.players[n].uuid}, Type: ${this.players[n].type}`),e+="<span>"+n+"</span><br>");i.innerHTML=e,i.style.display="block"}}hidePlayersList(){let i=document.getElementById("playerList");i.style.display="none"}onKeyDown(i){i.code==="KeyL"&&this.displayPlayersList()}onKeyUp(i){console.log("uyo"),i.code==="KeyL"&&this.hidePlayersList()}}class Wc{constructor(){y(this,"content",[]);y(this,"element");this.element=document.getElementById("chat"),window.addEventListener("keydown",this.onKeyDown.bind(this))}add(i,e="#AAAAAA"){this.content.push({msg:i,color:e}),this.display()}display(){let i="";this.content.forEach(e=>{i+='<span style="color: '+e.color+';">'+e.msg+"</span><br>"}),this.element.innerHTML=i,this.element.style.display="block",setTimeout(()=>{this.element.style.display="none"},1e4)}onKeyDown(i){i.code==="KeyT"&&this.display()}}var Ve=function(){var t=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(l){l.preventDefault(),n(++t%i.children.length)},!1);function e(l){return i.appendChild(l.dom),l}function n(l){for(var u=0;u<i.children.length;u++)i.children[u].style.display=u===l?"block":"none";t=l}var s=(performance||Date).now(),o=s,r=0,a=e(new Ve.Panel("FPS","#0ff","#002")),h=e(new Ve.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new Ve.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:e,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){r++;var l=(performance||Date).now();if(h.update(l-s,200),l>=o+1e3&&(a.update(r*1e3/(l-o),100),o=l,r=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return l},update:function(){s=this.end()},domElement:i,setMode:n}};Ve.Panel=function(t,i,e){var n=1/0,s=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,h=48*r,c=3*r,l=2*r,u=3*r,f=15*r,d=74*r,p=30*r,v=document.createElement("canvas");v.width=a,v.height=h,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*r+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=e,m.fillRect(0,0,a,h),m.fillStyle=i,m.fillText(t,c,l),m.fillRect(u,f,d,p),m.fillStyle=e,m.globalAlpha=.9,m.fillRect(u,f,d,p),{dom:v,update:function(k,R){n=Math.min(n,k),s=Math.max(s,k),m.fillStyle=e,m.globalAlpha=1,m.fillRect(0,0,a,f),m.fillStyle=i,m.fillText(o(k)+" "+t+" ("+o(n)+"-"+o(s)+")",c,l),m.drawImage(v,u+r,f,d-r,p,u,f,d-r,p),m.fillRect(u+d-r,f,r,p),m.fillStyle=e,m.globalAlpha=.9,m.fillRect(u+d-r,f,r,o((1-k/R)*p))}}};const de=new Js,V=new Na;V.generate();de.add(V);de.fog=new Qs(8429792,V.chunkSize.width*V.drawDistance*.9,V.chunkSize.width*V.drawDistance);const Se=new eo;Se.setPixelRatio(window.devicePixelRatio);Se.setSize(window.innerWidth,window.innerHeight);Se.setClearColor(8429792);Se.shadowMap.enabled=!0;Se.shadowMap.type=to;document.body.appendChild(Se.domElement);const Jc=document.getElementById("fps"),Qc=document.getElementById("time"),Rs=new Wc,Ds=new Xc(V,de,Rs),X=new fo(de,V,Ds),el=new Va(de),rt=new Wa(X,V);new tc(V,X,rt,Ds,Rs);const tl=new Xa(X,rt),Cn=new ic(de,X,.2);X.setInventory(rt);X.setUI(tl);const zs=new qa;de.add(zs);window.addEventListener("keydown",t=>{t.code==="KeyE"&&(X.controls.isLocked?(X.controls.unlock(),rt.show()):(X.controls.lock(),rt.hide()))});de.background=new io(7254527);var ei=performance.now(),Bn=0,ti=0,Tn=0;const il=new no,Os=new Ve;document.body.appendChild(Os.dom);let Rn=performance.now();function Ls(){const t=performance.now(),i=il.getDelta();let e=(t-Tn)/1e3;el.update(e,X,V),V.update(X),X.update(V),Tn=t,ti++,t-ei>1e3&&(Bn=Math.round(ti*1e3/(t-ei)),Jc.textContent=`FPS: ${Bn}`,ei=t,ti=0,Qc.textContent=Cn.getTime());const n=performance.now(),s=n-Rn;Rn=n,Cn.update(s),zs.movePig(i,V),Se.render(de,X.camera),requestAnimationFrame(Ls),Os.update()}Ls();document.addEventListener("contextmenu",function(t){t.preventDefault()},!1);
