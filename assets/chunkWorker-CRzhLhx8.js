var $t=Object.defineProperty;var Jt=(N,R,P)=>R in N?$t(N,R,{enumerable:!0,configurable:!0,writable:!0,value:P}):N[R]=P;var _t=(N,R,P)=>Jt(N,typeof R!="symbol"?R+"":R,P);(function(){"use strict";class N{constructor(t=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let s=0;s<256;s++)this.p[s]=Math.floor(t.random()*256);this.perm=[];for(let s=0;s<512;s++)this.perm[s]=this.p[s&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(t,s,i){return t[0]*s+t[1]*i}dot3(t,s,i,h){return t[0]*s+t[1]*i+t[2]*h}dot4(t,s,i,h,n){return t[0]*s+t[1]*i+t[2]*h+t[3]*n}noise(t,s){let i,h,n;const c=.5*(Math.sqrt(3)-1),r=(t+s)*c,l=Math.floor(t+r),e=Math.floor(s+r),o=(3-Math.sqrt(3))/6,u=(l+e)*o,_=l-u,a=e-u,y=t-_,p=s-a;let b,E;y>p?(b=1,E=0):(b=0,E=1);const M=y-b+o,g=p-E+o,d=y-1+2*o,m=p-1+2*o,x=l&255,S=e&255,T=this.perm[x+this.perm[S]]%12,w=this.perm[x+b+this.perm[S+E]]%12,f=this.perm[x+1+this.perm[S+1]]%12;let C=.5-y*y-p*p;C<0?i=0:(C*=C,i=C*C*this.dot(this.grad3[T],y,p));let k=.5-M*M-g*g;k<0?h=0:(k*=k,h=k*k*this.dot(this.grad3[w],M,g));let A=.5-d*d-m*m;return A<0?n=0:(A*=A,n=A*A*this.dot(this.grad3[f],d,m)),70*(i+h+n)}noise3d(t,s,i){let h,n,c,r;const e=(t+s+i)*.3333333333333333,o=Math.floor(t+e),u=Math.floor(s+e),_=Math.floor(i+e),a=1/6,y=(o+u+_)*a,p=o-y,b=u-y,E=_-y,M=t-p,g=s-b,d=i-E;let m,x,S,T,w,f;M>=g?g>=d?(m=1,x=0,S=0,T=1,w=1,f=0):M>=d?(m=1,x=0,S=0,T=1,w=0,f=1):(m=0,x=0,S=1,T=1,w=0,f=1):g<d?(m=0,x=0,S=1,T=0,w=1,f=1):M<d?(m=0,x=1,S=0,T=0,w=1,f=1):(m=0,x=1,S=0,T=1,w=1,f=0);const C=M-m+a,k=g-x+a,A=d-S+a,L=M-T+2*a,G=g-w+2*a,W=d-f+2*a,$=M-1+3*a,J=g-1+3*a,j=d-1+3*a,X=o&255,Z=u&255,B=_&255,at=this.perm[X+this.perm[Z+this.perm[B]]]%12,ct=this.perm[X+m+this.perm[Z+x+this.perm[B+S]]]%12,lt=this.perm[X+T+this.perm[Z+w+this.perm[B+f]]]%12,ut=this.perm[X+1+this.perm[Z+1+this.perm[B+1]]]%12;let V=.6-M*M-g*g-d*d;V<0?h=0:(V*=V,h=V*V*this.dot3(this.grad3[at],M,g,d));let H=.6-C*C-k*k-A*A;H<0?n=0:(H*=H,n=H*H*this.dot3(this.grad3[ct],C,k,A));let Q=.6-L*L-G*G-W*W;Q<0?c=0:(Q*=Q,c=Q*Q*this.dot3(this.grad3[lt],L,G,W));let Y=.6-$*$-J*J-j*j;return Y<0?r=0:(Y*=Y,r=Y*Y*this.dot3(this.grad3[ut],$,J,j)),32*(h+n+c+r)}noise4d(t,s,i,h){const n=this.grad4,c=this.simplex,r=this.perm,l=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20;let o,u,_,a,y;const p=(t+s+i+h)*l,b=Math.floor(t+p),E=Math.floor(s+p),M=Math.floor(i+p),g=Math.floor(h+p),d=(b+E+M+g)*e,m=b-d,x=E-d,S=M-d,T=g-d,w=t-m,f=s-x,C=i-S,k=h-T,A=w>f?32:0,L=w>C?16:0,G=f>C?8:0,W=w>k?4:0,$=f>k?2:0,J=C>k?1:0,j=A+L+G+W+$+J,X=c[j][0]>=3?1:0,Z=c[j][1]>=3?1:0,B=c[j][2]>=3?1:0,at=c[j][3]>=3?1:0,ct=c[j][0]>=2?1:0,lt=c[j][1]>=2?1:0,ut=c[j][2]>=2?1:0,V=c[j][3]>=2?1:0,H=c[j][0]>=1?1:0,Q=c[j][1]>=1?1:0,Y=c[j][2]>=1?1:0,At=c[j][3]>=1?1:0,xt=w-X+e,zt=f-Z+e,mt=C-B+e,dt=k-at+e,Mt=w-ct+2*e,gt=f-lt+2*e,pt=C-ut+2*e,wt=k-V+2*e,ft=w-H+3*e,bt=f-Q+3*e,Ct=C-Y+3*e,kt=k-At+3*e,St=w-1+4*e,Et=f-1+4*e,jt=C-1+4*e,qt=k-1+4*e,U=b&255,K=E&255,O=M&255,v=g&255,Bt=r[U+r[K+r[O+r[v]]]]%32,Dt=r[U+X+r[K+Z+r[O+B+r[v+at]]]]%32,Lt=r[U+ct+r[K+lt+r[O+ut+r[v+V]]]]%32,Gt=r[U+H+r[K+Q+r[O+Y+r[v+At]]]]%32,Wt=r[U+1+r[K+1+r[O+1+r[v+1]]]]%32;let tt=.6-w*w-f*f-C*C-k*k;tt<0?o=0:(tt*=tt,o=tt*tt*this.dot4(n[Bt],w,f,C,k));let st=.6-xt*xt-zt*zt-mt*mt-dt*dt;st<0?u=0:(st*=st,u=st*st*this.dot4(n[Dt],xt,zt,mt,dt));let it=.6-Mt*Mt-gt*gt-pt*pt-wt*wt;it<0?_=0:(it*=it,_=it*it*this.dot4(n[Lt],Mt,gt,pt,wt));let ht=.6-ft*ft-bt*bt-Ct*Ct-kt*kt;ht<0?a=0:(ht*=ht,a=ht*ht*this.dot4(n[Gt],ft,bt,Ct,kt));let et=.6-St*St-Et*Et-jt*jt-qt*qt;return et<0?y=0:(et*=et,y=et*et*this.dot4(n[Wt],St,Et,jt,qt)),27*(o+u+_+a+y)}}class R{constructor(t){_t(this,"m_w",123456789);_t(this,"m_z",987654321);_t(this,"mask",4294967295);this.m_w=123456789+t&this.mask,this.m_z=987654321-t&this.mask}random(){this.m_z=36969*(this.m_z&65535)+(this.m_z>>16)&this.mask,this.m_w=18e3*(this.m_w&65535)+(this.m_w>>16)&this.mask;let t=(this.m_z<<16)+(this.m_w&65535)>>>0;return t/=4294967296,t}}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const P="172";function I(z,t,s){return Math.max(t,Math.min(s,z))}class Ft{constructor(t=0,s=0,i=0,h=1){this.isQuaternion=!0,this._x=t,this._y=s,this._z=i,this._w=h}static slerpFlat(t,s,i,h,n,c,r){let l=i[h+0],e=i[h+1],o=i[h+2],u=i[h+3];const _=n[c+0],a=n[c+1],y=n[c+2],p=n[c+3];if(r===0){t[s+0]=l,t[s+1]=e,t[s+2]=o,t[s+3]=u;return}if(r===1){t[s+0]=_,t[s+1]=a,t[s+2]=y,t[s+3]=p;return}if(u!==p||l!==_||e!==a||o!==y){let b=1-r;const E=l*_+e*a+o*y+u*p,M=E>=0?1:-1,g=1-E*E;if(g>Number.EPSILON){const m=Math.sqrt(g),x=Math.atan2(m,E*M);b=Math.sin(b*x)/m,r=Math.sin(r*x)/m}const d=r*M;if(l=l*b+_*d,e=e*b+a*d,o=o*b+y*d,u=u*b+p*d,b===1-r){const m=1/Math.sqrt(l*l+e*e+o*o+u*u);l*=m,e*=m,o*=m,u*=m}}t[s]=l,t[s+1]=e,t[s+2]=o,t[s+3]=u}static multiplyQuaternionsFlat(t,s,i,h,n,c){const r=i[h],l=i[h+1],e=i[h+2],o=i[h+3],u=n[c],_=n[c+1],a=n[c+2],y=n[c+3];return t[s]=r*y+o*u+l*a-e*_,t[s+1]=l*y+o*_+e*u-r*a,t[s+2]=e*y+o*a+r*_-l*u,t[s+3]=o*y-r*u-l*_-e*a,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,i,h){return this._x=t,this._y=s,this._z=i,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s=!0){const i=t._x,h=t._y,n=t._z,c=t._order,r=Math.cos,l=Math.sin,e=r(i/2),o=r(h/2),u=r(n/2),_=l(i/2),a=l(h/2),y=l(n/2);switch(c){case"XYZ":this._x=_*o*u+e*a*y,this._y=e*a*u-_*o*y,this._z=e*o*y+_*a*u,this._w=e*o*u-_*a*y;break;case"YXZ":this._x=_*o*u+e*a*y,this._y=e*a*u-_*o*y,this._z=e*o*y-_*a*u,this._w=e*o*u+_*a*y;break;case"ZXY":this._x=_*o*u-e*a*y,this._y=e*a*u+_*o*y,this._z=e*o*y+_*a*u,this._w=e*o*u-_*a*y;break;case"ZYX":this._x=_*o*u-e*a*y,this._y=e*a*u+_*o*y,this._z=e*o*y-_*a*u,this._w=e*o*u+_*a*y;break;case"YZX":this._x=_*o*u+e*a*y,this._y=e*a*u+_*o*y,this._z=e*o*y-_*a*u,this._w=e*o*u-_*a*y;break;case"XZY":this._x=_*o*u-e*a*y,this._y=e*a*u-_*o*y,this._z=e*o*y+_*a*u,this._w=e*o*u+_*a*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return s===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,s){const i=s/2,h=Math.sin(i);return this._x=t.x*h,this._y=t.y*h,this._z=t.z*h,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const s=t.elements,i=s[0],h=s[4],n=s[8],c=s[1],r=s[5],l=s[9],e=s[2],o=s[6],u=s[10],_=i+r+u;if(_>0){const a=.5/Math.sqrt(_+1);this._w=.25/a,this._x=(o-l)*a,this._y=(n-e)*a,this._z=(c-h)*a}else if(i>r&&i>u){const a=2*Math.sqrt(1+i-r-u);this._w=(o-l)/a,this._x=.25*a,this._y=(h+c)/a,this._z=(n+e)/a}else if(r>u){const a=2*Math.sqrt(1+r-i-u);this._w=(n-e)/a,this._x=(h+c)/a,this._y=.25*a,this._z=(l+o)/a}else{const a=2*Math.sqrt(1+u-i-r);this._w=(c-h)/a,this._x=(n+e)/a,this._y=(l+o)/a,this._z=.25*a}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let i=t.dot(s)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(I(this.dot(t),-1,1)))}rotateTowards(t,s){const i=this.angleTo(t);if(i===0)return this;const h=Math.min(1,s/i);return this.slerp(t,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){const i=t._x,h=t._y,n=t._z,c=t._w,r=s._x,l=s._y,e=s._z,o=s._w;return this._x=i*o+c*r+h*e-n*l,this._y=h*o+c*l+n*r-i*e,this._z=n*o+c*e+i*l-h*r,this._w=c*o-i*r-h*l-n*e,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);const i=this._x,h=this._y,n=this._z,c=this._w;let r=c*t._w+i*t._x+h*t._y+n*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=c,this._x=i,this._y=h,this._z=n,this;const l=1-r*r;if(l<=Number.EPSILON){const a=1-s;return this._w=a*c+s*this._w,this._x=a*i+s*this._x,this._y=a*h+s*this._y,this._z=a*n+s*this._z,this.normalize(),this}const e=Math.sqrt(l),o=Math.atan2(e,r),u=Math.sin((1-s)*o)/e,_=Math.sin(s*o)/e;return this._w=c*u+this._w*_,this._x=i*u+this._x*_,this._y=h*u+this._y*_,this._z=n*u+this._z*_,this._onChangeCallback(),this}slerpQuaternions(t,s,i){return this.copy(t).slerp(s,i)}random(){const t=2*Math.PI*Math.random(),s=2*Math.PI*Math.random(),i=Math.random(),h=Math.sqrt(1-i),n=Math.sqrt(i);return this.set(h*Math.sin(t),h*Math.cos(t),n*Math.sin(s),n*Math.cos(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class nt{constructor(t=0,s=0,i=0){nt.prototype.isVector3=!0,this.x=t,this.y=s,this.z=i}set(t,s,i){return i===void 0&&(i=this.z),this.x=t,this.y=s,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return this.applyQuaternion(Tt.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(Tt.setFromAxisAngle(t,s))}applyMatrix3(t){const s=this.x,i=this.y,h=this.z,n=t.elements;return this.x=n[0]*s+n[3]*i+n[6]*h,this.y=n[1]*s+n[4]*i+n[7]*h,this.z=n[2]*s+n[5]*i+n[8]*h,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const s=this.x,i=this.y,h=this.z,n=t.elements,c=1/(n[3]*s+n[7]*i+n[11]*h+n[15]);return this.x=(n[0]*s+n[4]*i+n[8]*h+n[12])*c,this.y=(n[1]*s+n[5]*i+n[9]*h+n[13])*c,this.z=(n[2]*s+n[6]*i+n[10]*h+n[14])*c,this}applyQuaternion(t){const s=this.x,i=this.y,h=this.z,n=t.x,c=t.y,r=t.z,l=t.w,e=2*(c*h-r*i),o=2*(r*s-n*h),u=2*(n*i-c*s);return this.x=s+l*e+c*u-r*o,this.y=i+l*o+r*e-n*u,this.z=h+l*u+n*o-c*e,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const s=this.x,i=this.y,h=this.z,n=t.elements;return this.x=n[0]*s+n[4]*i+n[8]*h,this.y=n[1]*s+n[5]*i+n[9]*h,this.z=n[2]*s+n[6]*i+n[10]*h,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=I(this.x,t.x,s.x),this.y=I(this.y,t.y,s.y),this.z=I(this.z,t.z,s.z),this}clampScalar(t,s){return this.x=I(this.x,t,s),this.y=I(this.y,t,s),this.z=I(this.z,t,s),this}clampLength(t,s){const i=this.length();return this.divideScalar(i||1).multiplyScalar(I(i,t,s))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,i){return this.x=t.x+(s.x-t.x)*i,this.y=t.y+(s.y-t.y)*i,this.z=t.z+(s.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,s){const i=t.x,h=t.y,n=t.z,c=s.x,r=s.y,l=s.z;return this.x=h*l-n*r,this.y=n*c-i*l,this.z=i*r-h*c,this}projectOnVector(t){const s=t.lengthSq();if(s===0)return this.set(0,0,0);const i=t.dot(this)/s;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return yt.copy(this).projectOnVector(t),this.sub(yt)}reflect(t){return this.sub(yt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;const i=this.dot(t)/s;return Math.acos(I(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const s=this.x-t.x,i=this.y-t.y,h=this.z-t.z;return s*s+i*i+h*h}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,i){const h=Math.sin(s)*t;return this.x=h*Math.sin(i),this.y=Math.cos(s)*t,this.z=h*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,i){return this.x=t*Math.sin(s),this.y=i,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){const s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){const s=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),h=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=i,this.z=h,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s){return this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,s=Math.random()*2-1,i=Math.sqrt(1-s*s);return this.x=i*Math.cos(t),this.y=s,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const yt=new nt,Tt=new Ft;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:P}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=P);const q={empty:{id:0,name:"empty",visible:!1},grass:{id:1,name:"grass"},dirt:{id:2,name:"dirt"},bedrock:{id:7,name:"bedrock"},sand:{id:12,name:"sand"},gravel:{id:13,name:"gravel"},stone:{id:3,name:"stone",scale:{x:30,y:30,z:30},scarcity:.8},coalOre:{id:16,name:"coal_ore",scale:{x:20,y:20,z:20},scarcity:.8},ironOre:{id:15,name:"iron_ore",scale:{x:40,y:40,z:40},scarcity:.9},diamondOre:{id:56,name:"diamond_ore",scale:{x:40,y:40,z:40},scarcity:.99},log:{id:17,name:"log"},leaves:{id:18,name:"leaves"},craftingTable:{id:58,name:"Crafting Table"}},Rt=[q.coalOre,q.ironOre,q.diamondOre];let D=[],rt=[];self.onmessage=function(z){const{chunkData:t,chunkSize:s,chunkHeight:i,params:h,position:n}=z.data,c=new R(h.seed);It(s,i),Nt(s),Vt(s,i,h,c,n),self.postMessage({data:D,biomes:rt})};function It(z,t){for(let s=0;s<z;s++){const i=[];for(let h=0;h<t;h++){const n=[];for(let c=0;c<z;c++)n.push({id:0,instanceId:null,inventory:null,direction:new nt(0,0,0)});i.push(n)}D.push(i)}}function Nt(z){for(let t=0;t<z;t++){let s=[];for(let i=0;i<z;i++)s.push({});rt.push(s)}}function Vt(z,t,s,i,h){var c,r;const n=new N(i);for(let l=0;l<z;l++)for(let e=0;e<z;e++){let o=Zt(n,l,e,h),u=o.biome1,_=u,a=o.biome2,y=o.blend;const p=s.biomes[u].scale,b=n.noise((h.x+l)/p,(h.z+e)/p);let E=s.biomes[u].offset+s.biomes[u].magnitude*b;const M=s.biomes[a].scale,g=n.noise((h.x+l)/M,(h.z+e)/M);let d=s.biomes[a].offset+s.biomes[a].magnitude*g,m=Math.floor(Xt(E,d,y)*t);m=Math.max(1,Math.min(m,t-1)),typeof rt[l][e]<"u"&&(rt[l][e]=u);for(let x=0;x<t;x++)if(x<m&&x>m-3&&((c=ot(l,x,e))==null?void 0:c.id)===q.empty.id&&F(l,x,e,q.dirt.id),x==0)F(l,x,e,q.bedrock.id);else if(x<m&&((r=ot(l,x,e))==null?void 0:r.id)===q.empty.id)F(l,x,e,q.stone.id),Pt(i,l,x,e,h);else if(x==m){_=="plains"||_=="forest"||_=="mountains"?F(l,x,e,q.grass.id):F(l,x,e,q.sand.id);let S=1;_=="forest"&&(S=6),_=="mountains"&&(S=.5),_!="desert"&&Math.random()<s.trees.frequency*S&&Qt(s.seed,1,l,m+1,e,s)}}}function F(z,t,s,i){D[z][t][s].id=i}function ot(z,t,s){return Ht(z,t,s)&&typeof D[z]<"u"?D[z][t][s]:null}function Ht(z,t,s){return z>=0&&z<16&&s>=0&&s<16&&t>=0&&t<80}function Qt(z,t,s,i,h,n){const c=n.trees.trunk.minHeight,r=n.trees.trunk.maxHeight,l=Math.round(c+(r-c)*Math.random()+1);for(let e=i;e<i+l;e++)F(s,e,h,q.log.id);Yt(t,s,i+l,h,n)}function Yt(z,t,s,i,h){const n=h.trees.canopy.minRadius,c=h.trees.canopy.maxRadius,r=Math.round(n+(c-n)*Math.random());for(let l=-r;l<=r;l++)for(let e=-r;e<=r;e++)for(let o=-r;o<=r;o++){const u=Math.random();if(l*l+e*e+o*o>r*r)continue;const _=ot(t+l,s+e,i+o);_&&_.id!==q.empty.id||u<h.trees.canopy.density&&ot(t+l,s+e,i+o)!==null&&F(t+l,s+e,i+o,q.leaves.id)}}function Pt(z,t,s,i,h){const n=new N(z);Rt.forEach(c=>{n.noise((h.x+t)/c.scale.x,(h.y+s)/c.scale.y,(h.z+i)/c.scale.z)>c.scarcity&&F(t,s,i,c.id)})}function Xt(z,t,s){return z+s*(t-z)}function Zt(z,t,s,i){let h=z.noise((i.x+t)/500,(i.z+s)/500);return h+=.2*z.noise((i.x+t)/250,(i.z+s)/250),h=(h+1)/2,h<.2?{biome1:"desert",biome2:"plains",blend:(h-.1)/.1}:h<.4?{biome1:"plains",biome2:"forest",blend:(h-.2)/.2}:h<.6?{biome1:"forest",biome2:"mountains",blend:(h-.4)/.2}:{biome1:"mountains",biome2:"mountains",blend:(h-.6)/.4}}})();
