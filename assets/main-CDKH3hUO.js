var Js=Object.defineProperty;var qi=e=>{throw TypeError(e)};var to=(e,i,t)=>i in e?Js(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var m=(e,i,t)=>to(e,typeof i!="symbol"?i+"":i,t),eo=(e,i,t)=>i.has(e)||qi("Cannot "+t);var be=(e,i,t)=>(eo(e,i,"read from private field"),t?t.call(e):i.get(e)),Zi=(e,i,t)=>i.has(e)?qi("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,t);import{V as I,C as io,E as dt,B as no,G as st,a as H,M as te,b as N,g as O,P as so,c as oo,d as Vt,T as Re,S as $n,N as ee,e as y,R as ro,f as Gn,F as Kn,h as E,i as ci,Q as Yn,j as ao,I as ho,k as co,l as lo,m as fo,D as uo,n as jn,o as Vn,p as po,A as _o,q as mo,r as go,W as yo,s as wo,t as bo,u as ko}from"./recipes-o3nKY8Wf.js";const Ct=new dt(0,0,0,"YXZ"),At=new I,vo={type:"change"},xo={type:"lock"},Eo={type:"unlock"},$i=Math.PI/2;class So extends io{constructor(i,t=null){super(i,t),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=Io.bind(this),this._onPointerlockChange=To.bind(this),this._onPointerlockError=Bo.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(i){return i.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(i){if(this.enabled===!1)return;const t=this.object;At.setFromMatrixColumn(t.matrix,0),At.crossVectors(t.up,At),t.position.addScaledVector(At,i)}moveRight(i){if(this.enabled===!1)return;const t=this.object;At.setFromMatrixColumn(t.matrix,0),t.position.addScaledVector(At,i)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function Io(e){if(this.enabled===!1||this.isLocked===!1)return;const i=this.object;Ct.setFromQuaternion(i.quaternion),Ct.y-=e.movementX*.002*this.pointerSpeed,Ct.x-=e.movementY*.002*this.pointerSpeed,Ct.x=Math.max($i-this.maxPolarAngle,Math.min($i-this.minPolarAngle,Ct.x)),i.quaternion.setFromEuler(Ct),this.dispatchEvent(vo)}function To(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(xo),this.isLocked=!0):(this.dispatchEvent(Eo),this.isLocked=!1)}function Bo(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}class zo{constructor(i,t){this.camera=i,this.domElement=t,this.camera.rotation.order="YXZ",this.enabled=!0,this.rotationSpeed=.005,this.lookTouchId=null,this.lastTouch={x:0,y:0},this.yaw=0,this.pitch=0,this.init()}init(){this.domElement.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),this.domElement.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.domElement.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!1}),this.domElement.addEventListener("touchcancel",this.onTouchEnd.bind(this),{passive:!1})}onTouchStart(i){if(this.enabled&&(i.preventDefault(),this.lookTouchId===null&&i.changedTouches.length>0)){const t=i.changedTouches[0];this.lookTouchId=t.identifier,this.lastTouch.x=t.clientX,this.lastTouch.y=t.clientY}}onTouchMove(i){if(!this.enabled||this.lookTouchId===null)return;i.preventDefault();let t=null;for(let o=0;o<i.touches.length;o++){const r=i.touches[o];if(r.identifier===this.lookTouchId){t=r;break}}if(!t)return;const n=t.clientX-this.lastTouch.x,s=t.clientY-this.lastTouch.y;this.lastTouch.x=t.clientX,this.lastTouch.y=t.clientY,this.yaw-=n*this.rotationSpeed,this.pitch-=s*this.rotationSpeed,this.pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.pitch)),this.updateCameraRotation()}onTouchEnd(i){if(this.lookTouchId!==null){for(let t=0;t<i.changedTouches.length;t++)if(i.changedTouches[t].identifier===this.lookTouchId){this.lookTouchId=null;break}}}updateCameraRotation(){this.camera.rotation.x=this.pitch,this.camera.rotation.y=this.yaw,this.camera.rotation.z=0}moveForward(i){const t=new I;this.camera.getWorldDirection(t),t.y=0,t.normalize(),this.camera.position.addScaledVector(t,i)}moveRight(i){const t=new I;this.camera.getWorldDirection(t),t.y=0,t.normalize(),t.cross(this.camera.up),this.camera.position.addScaledVector(t,i)}}const Co={stone:{break:["stone_1","stone_2","stone_3","stone_4"],place:["stone_1","stone_2","stone_3","stone_4"],step:"stone_step",hit:"stone_hit",fall:"stone_fall"},grass:{break:["grass_1","grass_2","grass_3","grass_4"],place:["grass_1","grass_2","grass_3","grass_4"],step:"grass_step",hit:"grass_hit",fall:"grass_fall"},wood:{break:["wood_1","wood_2","wood_3","wood_4"],place:["wood_1","wood_2","wood_3","wood_4"],step:"wood_step",hit:"wood_hit",fall:"wood_fall",open:"chest_open",close:"chest_close",open_door:"door_open",close_door:"door_close"},gravel:{break:"gravel_break",place:"gravel_place",step:"gravel_step",hit:"gravel_hit",fall:"gravel_fall"},sand:{break:["sand_1","sand_2","sand_3","sand_4"],place:["sand_1","sand_2","sand_3","sand_4"],step:"sand_step",hit:"sand_hit",fall:"sand_fall"},snow:{break:"snow_break",place:"snow_place",step:"snow_step",hit:"snow_hit",fall:"snow_fall"},nether_bricks:{break:"nether_bricks_break",place:"nether_bricks_place",step:"nether_bricks_step",hit:"nether_bricks_hit",fall:"nether_bricks_fall"},glass:{break:"glass_break",place:"glass_place",step:"glass_step",hit:"glass_hit",fall:"glass_fall"},slime:{break:"slime_break",place:"slime_place",step:"slime_step",hit:"slime_hit",fall:"slime_fall"},pig:{hurt:"pig_hurt"},cow:{hurt:["cow_hurt_1","cow_hurt_2","cow_hurt_3"]},player:{hurt:["classic_hurt","classic_hurt2"],fall:["fall_big","fall_small"],hit:["hit1","hit2","hit3"]}},Ao={grass_1:"audio/grass1.ogg",grass_2:"audio/grass2.ogg",grass_3:"audio/grass3.ogg",grass_4:"audio/grass4.ogg",wood_1:"audio/wood1.ogg",wood_2:"audio/wood2.ogg",wood_3:"audio/wood3.ogg",wood_4:"audio/wood4.ogg",stone_1:"audio/stone1.ogg",stone_2:"audio/stone2.ogg",stone_3:"audio/stone3.ogg",stone_4:"audio/stone4.ogg",sand_1:"audio/sand1.ogg",sand_2:"audio/sand2.ogg",sand_3:"audio/sand3.ogg",sand_4:"audio/sand4.ogg",gravel_place:"audio/gravel1.ogg",gravel_break:"audio/gravel1.ogg",glass_place:"audio/glass1.ogg",glass_break:"audio/glass1.ogg",pig_hurt:"audio/pig/pighurt1.ogg",cow_hurt_1:"audio/cow/cowhurt1.ogg",cow_hurt_2:"audio/cow/cowhurt2.ogg",cow_hurt_3:"audio/cow/cowhurt3.ogg",chest_open:"audio/chestopen.ogg",chest_close:"audio/chestclose.ogg",door_close:"audio/door_close.ogg",door_open:"audio/door_open.ogg",classic_hurt:"audio/damage/classic_hurt.ogg",classic_hurt2:"audio/damage/classic_hurt2.ogg",fall_big:"audio/damage/fallbig.ogg",fall_small:"audio/damage/fallsmall.ogg",hit1:"audio/damage/hit1.ogg",hit2:"audio/damage/hit2.ogg",hit3:"audio/damage/hit3.ogg"};class Ti{constructor(){this.sounds={}}load(i){const t=Ao[i];if(!t){console.warn(`No source registered for sound: ${i}`);return}const n=new Audio(t);n.preload="auto",this.sounds[i]=n}play(i,t=!0){let n=this.sounds[i];if(!n&&(this.load(i),n=this.sounds[i],!n))return;const s=t?n.cloneNode():n;s.volume=.8,s.play()}playBlockSound(i,t){var s;let n=(s=Co[i])==null?void 0:s[t];if(Array.isArray(n)&&n.length){const o=Math.floor(Math.random()*n.length);n=n[o]}n&&this.play(n)}}class fe{constructor(i,t){this.world=i,console.log(t),this.position=t.clone(),this.velocity=new I(0,0,0),this.mesh=null,this.boundingBox=new no,this.audioManager=new Ti}update(i){this.position.addScaledVector(this.velocity,i),this.mesh&&this.mesh.position.copy(this.position)}addToScene(i){this.mesh&&i.add(this.mesh)}removeToScene(i){this.mesh&&i.remove(this.mesh)}removeFromScene(i){this.mesh&&i.remove(this.mesh)}action(){console.log("Default action")}hit(){console.log("Default hit")}}class Mo extends fe{constructor(i,t){super(i,t),this.mesh=new st;const n=new H(1.5,.2,2.5),s=new te({color:9127187}),o=new N(n,s);o.position.y=-.4,o.castShadow=!0,o.receiveShadow=!0,o.userData.entity=this,this.mesh.add(o);const r=new H(.1,.3,2.5),a=new N(r,s);a.position.set(-.8,-.15,0),a.castShadow=!0,a.receiveShadow=!0;const l=a.clone();a.userData.entity=this,l.position.x=.8,l.userData.entity=this,this.mesh.add(a),this.mesh.add(l);const h=new H(1.5,.3,.1),c=new N(h,s);c.position.set(0,-.15,-1.25),c.castShadow=!0,c.receiveShadow=!0;const u=c.clone();c.userData.entity=this,this.mesh.add(c),u.position.z=1.25,this.mesh.add(u),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.position.copy(this.position),this.speed=0,this.rotation=0,this.shakeTime=0,this.shakeIntensity=0}setInput(i){this.input=i.clone()}update(i){this.driver?this.input&&(this.input.z>0?this.speed+=.08:this.input.z<0?this.speed-=.08:this.speed*=.99,this.input.x>0&&(this.rotation-=1.5*i),this.input.x<0&&(this.rotation+=1.5*i)):this.speed*=.99;const t=new I(-Math.sin(this.rotation),0,-Math.cos(this.rotation));this.velocity.copy(t.multiplyScalar(this.speed));const n=this.world.getBlock(Math.floor(this.mesh.position.x),Math.floor(this.mesh.position.y-.5),Math.floor(this.mesh.position.z));let s=2;if((n==null?void 0:n.id)===9&&(s=10),this.speed=Math.max(-s,Math.min(s,this.speed)),Math.abs(this.speed)<.001&&(this.speed=0),!n||n.id===0?this.velocity.y-=3:(this.velocity.y=0,this.position.y=Math.floor(this.mesh.position.y)),this.position.addScaledVector(this.velocity,i),this.mesh.position.copy(this.position),this.shakeTime>0){this.shakeTime-=i;const o=Math.sin(Date.now()*.05)*this.shakeIntensity;this.mesh.rotation.z=o}else this.mesh.rotation.z=0;this.mesh.rotation.y=this.rotation}action(i){this.driver===null?(i.riding=this,this.driver=i):(i.riding=null,this.driver=null)}hit(){this.shakeTime=.3,this.shakeIntensity=.05}}const Gi=Math.PI/2;function Do(e){switch(e){case 0:return 0;case 1:return-Math.PI/2;case 2:return Math.PI;case 3:return Math.PI/2;default:return 0}}class Lo extends fe{constructor(i,t,n={}){super(i,t);const{facing:s=0,hinge:o="left",open:r=!1}=n;this.audioManager=new Ti,this.facing=s,this.hinge=o,this.open=r,this.mesh=new st,this.mesh.position.set(t.x,t.y,t.z-.4),this.mesh.rotation.y=Do(s),this.pivot=new st;const a=O(64).material,l=O(1064).material,h=new H(1,1,.2);this.doorBottomMesh=new N(h,a),this.doorTopMesh=new N(h,l),this.doorBottomMesh.userData.entity=this,this.doorTopMesh.userData.entity=this,this.doorBottomMesh.position.set(0,0,0),this.doorTopMesh.position.set(0,1,0),this.doorGroup=new st,this.doorGroup.add(this.doorBottomMesh),this.doorGroup.add(this.doorTopMesh);const c=o==="left"?-.5:.5;this.pivot.position.set(c,0,0),this.doorGroup.position.set(-c,0,0),this.pivot.add(this.doorGroup),this.mesh.add(this.pivot),this.targetAngle=this.open?this._openAngle():0,this.pivot.rotation.y=this.targetAngle,this.doorBottomMesh.castShadow=!0,this.doorBottomMesh.receiveShadow=!0,this.doorTopMesh.castShadow=!0,this.doorTopMesh.receiveShadow=!0}_openAngle(){return this.hinge==="left"?-Gi:Gi}setOpen(i,{instant:t=!1}={}){this.open=i,this.open?this.audioManager.playBlockSound("wood","open_door"):this.audioManager.playBlockSound("wood","close_door"),this.targetAngle=i?this._openAngle():0,t&&(this.pivot.rotation.y=this.targetAngle)}toggle({instant:i=!1}={}){this.setOpen(!this.open,{instant:i})}update(i){const n=this.pivot.rotation.y,s=this.targetAngle,o=s-n;if(Math.abs(o)<.001){this.pivot.rotation.y=s;return}this.pivot.rotation.y=n+o*Math.min(1,i*10)}action(i){this.toggle()}hit(){}destroy(){var i;(i=this.mesh)!=null&&i.parent&&this.mesh.parent.remove(this.mesh),this.mesh.traverse(t=>{var n,s,o,r;t.geometry&&((s=(n=t.geometry).dispose)==null||s.call(n)),t.material&&(Array.isArray(t.material)?t.material.forEach(a=>{var l;return(l=a.dispose)==null?void 0:l.call(a)}):(r=(o=t.material).dispose)==null||r.call(o))})}}class Ro{constructor(i,t=20,n=20){this.heartsEl=i,this.maxHealth=t,this.health=n,this.render()}render(){const i=Math.ceil(this.maxHealth/2);this.heartsEl.innerHTML="";for(let t=0;t<i;t++){const n=document.createElement("span");n.className="heart";const s=t*2+2;this.health>=s?n.classList.add("full"):this.health===s-1?n.classList.add("half"):n.classList.add("empty"),this.heartsEl.appendChild(n)}}setMaxHealth(i){this.maxHealth=Math.max(2,i),this.health=Math.min(this.health,this.maxHealth),this.render()}setHealth(i){this.health=Math.max(0,Math.min(i,this.maxHealth)),this.render()}add(i){this.setHealth(this.health+i)}remove(i){this.setHealth(this.health-i)}}var Ot;class Oo{constructor(i,t,n){m(this,"radius",.5);m(this,"height",1.8);m(this,"maxSpeed",7);m(this,"maxRun",5);m(this,"run",0);m(this,"inWater",!1);m(this,"riding",null);m(this,"jumpSpeed",10);m(this,"onGround",!1);m(this,"input",new I);m(this,"velocity",new I(0,0,0));Zi(this,Ot,new I);m(this,"camera",new so(75,window.innerWidth/window.innerHeight,.1,100));m(this,"selectedCoords",null);m(this,"selectedCoordsNormal",null);m(this,"selectedEntity",null);if(this.health=new Ro(document.getElementById("hearts"),20,20),!/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent))this.controls=new So(this.camera,document.body),this.usePointerLock=!0;else{this.controls=new zo(this.camera,document.body),this.usePointerLock=!1;const d=document.getElementById("move-forward"),p=document.getElementById("move-backward"),b=document.getElementById("move-left"),g=document.getElementById("move-right"),v=document.getElementById("jump");d.addEventListener("touchstart",()=>this.input.z=this.maxSpeed),d.addEventListener("touchend",()=>this.input.z=0),p.addEventListener("touchstart",()=>this.input.z=-this.maxSpeed),p.addEventListener("touchend",()=>this.input.z=0),b.addEventListener("touchstart",()=>this.input.x=-this.maxSpeed),b.addEventListener("touchend",()=>this.input.x=0),g.addEventListener("touchstart",()=>this.input.x=this.maxSpeed),g.addEventListener("touchend",()=>this.input.x=0),v.addEventListener("touchstart",()=>{this.onGround&&(this.velocity.y+=this.jumpSpeed)}),document.getElementById("mobile-controls").style.display="block",document.addEventListener("touchstart",k=>{this.isMouseDown=!0,setTimeout(()=>{this.isMouseDown?this.startDestroyingBlock():this.addBlock()},200)}),document.addEventListener("touchend",this.onMouseUp.bind(this))}this.socket=n,this.position.set(10,60,10),i.add(this.camera),this.scene=i,this.world=t,window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),this.boundsHelper=new N(new oo(this.radius,this.radius,this.height,16),new Vt({wireframe:!0}));const o=new H(.1,.1,.3),r=new Re().load("images/hand.png");r.colorSpace=$n,r.magFilter=ee,r.minFilter=ee;const a=new Vt({map:r});this.handMesh=new N(o,a),this.handMesh.position.set(.4,-.25,-.4),this.handMesh.rotation.x=.6,this.handMesh.rotation.z=-.4,this.handMesh.rotation.y=-.5,i.add(this.handMesh),this.camera.add(this.handMesh),this.punchDirection=1;const l=new Vt({color:0,transparent:!0,opacity:.2}),h=new Re().load("images/break.png"),c=new y({map:h,transparent:!0}),u=new H(1.01,1.01,1.01);this.selectionBreakHelper=new N(u,c),this.scene.add(this.selectionBreakHelper);const f=new H(1.01,1.01,1.01);this.selectionHelper=new N(f,l),i.add(this.selectionHelper),this.raycaster=new ro,this.mouse=new Gn,this.raycaster.far=5,document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),this.isDestroying=!1,this.audioManager=new Ti,this.defaultFog=i.fog,this.underwaterFog=new Kn(3381759,.1,10)}getPlacementDirection(i){let t=new I;this.camera.getWorldDirection(t);const n=Math.max(Math.abs(t.x),0,Math.abs(t.z));let o=new I(Math.abs(t.x)===n?Math.sign(t.x):0,0,Math.abs(t.z)===n?Math.sign(t.z):0).negate();return o.x===1?{x:1,y:0,z:0}:o.x===-1?{x:-1,y:0,z:0}:o.z===1?{x:0,y:0,z:1}:o.z===-1?{x:0,y:0,z:-1}:{x:0,y:1,z:0}}onMouseDown(i){this.usePointerLock&&this.controls.isLocked&&(this.isMouseDown=!0,this.animateHand(),this.selectedCoords?i.button==2?this.addBlock():this.startDestroyingBlock(i):this.selectedEntity&&(i.button==2?this.selectedEntity.action(this):this.selectedEntity.hit(this)))}addBlock(){var n,s,o,r,a;if(this.selectedCoords===null)return;const i=this.world.getBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z),t=O((n=this.inventory.getSelectedItem())==null?void 0:n.block);if(((s=this.inventory.getSelectedItem())==null?void 0:s.block)!==void 0&&O(i.id).interface!==!0&&t.type==="block"){const l=this.getPlacementDirection(this.selectedNormal);this.world.addBlock(this.selectedCoordsNormal.x,this.selectedCoordsNormal.y,this.selectedCoordsNormal.z,this.inventory.getSelectedItem().block,l),this.inventory.removeBlock(this.inventory.getSelectedItem().block),this.audioManager.playBlockSound(t.soundGroup,"place"),(o=this.socket.getSocket())==null||o.emit("addBlock",{x:this.selectedCoordsNormal.x,y:this.selectedCoordsNormal.y,z:this.selectedCoordsNormal.z,blockId:this.inventory.getSelectedItem().block,direction:l})}else if(O(i.id).interface===!0)this.ui.open(i.id),this.audioManager.playBlockSound(O(i.id).soundGroup,"open");else if(((r=this.inventory.getSelectedItem())==null?void 0:r.block)==375){const l=new Mo(this.world,new I(this.selectedCoords.x,this.selectedCoords.y+1,this.selectedCoords.z));l.addToScene(this.scene),this.world.addEntity(l)}else if(((a=this.inventory.getSelectedItem())==null?void 0:a.block)==64){this.audioManager.playBlockSound(t.soundGroup,"place");const l=new Lo(this.world,new I(this.selectedCoords.x,this.selectedCoords.y+1,this.selectedCoords.z));l.addToScene(this.scene),this.world.addEntity(l)}}startDestroyingBlock(i){var c,u;if(!this.isMouseDown||!this.selectedCoords)return;let t=0;const n=this.world.getBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z);let s=O(n.id).hardness*1e3,o=1;s*=1.5;const r=(c=this.inventory.getSelectedItem())==null?void 0:c.block;let a=null;r&&(a=O(r),a.type=="item"&&a.tool_type==O(n.id).tool&&(o=a.tool_material));let l=o/O(n.id).hardness;(u=O(n.id))!=null&&u.need_tool&&!(a&&a.type=="item"&&a.tool_type==O(n.id).tool)?l/=100:l/=30,s=Math.ceil(1/l)/20*1e3,l>1&&(s=0),this.isDestroying=!0,this.animateBlockBreaking(s),this.destructionInterval=setInterval(()=>{var f;if(!this.isMouseDown){clearInterval(this.destructionInterval),this.isDestroying=!1;return}if(t+=100,t>=s){const d=O(n.id);Object.hasOwn(d,"drops")?this.inventory.addBlock(d.drops):this.inventory.addBlock(n.id),this.world.removeBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z),(f=this.socket.getSocket())==null||f.emit("removeBlock",{x:this.selectedCoords.x,y:this.selectedCoords.y,z:this.selectedCoords.z}),this.audioManager.playBlockSound(d.soundGroup,"break"),this.isDestroying=!1,clearInterval(this.destructionInterval),setTimeout(()=>{this.startDestroyingBlock(i)},200)}},100)}onMouseUp(i){(!this.usePointerLock||this.controls.isLocked)&&(!this.usePointerLock||i.button!=2)&&(this.isDestroying=!1,clearInterval(this.destructionInterval),this.isMouseDown=!1)}animateHand(){this.handMesh.position.y+=this.punchDirection*.02,(this.handMesh.position.y>-.4||this.handMesh.position.y<-.6)&&(this.punchDirection*=-1)}update(i){this.updateRaycaster(i)}updateRaycaster(i){const t=[...i.children];for(const s of this.world.entities||[])s.mesh&&t.push(s.mesh);this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.camera=this.camera;const n=this.raycaster.intersectObjects(t,!0);if(!this.usePointerLock||this.controls.isLocked)if(n.length>0){const s=n[0];if(s.instanceId!==void 0){const o=s.object.parent,r=new ci;s.object.getMatrixAt(s.instanceId,r),this.selectedCoords=o.position.clone();const a=new I,l=new Yn;r.decompose(a,l,new I),this.selectedCoords.add(a),this.selectedCoords.set(Math.round(this.selectedCoords.x),Math.round(this.selectedCoords.y),Math.round(this.selectedCoords.z)),this.selectedNormal=s.face.normal.clone(),this.selectedNormal.applyQuaternion(l).normalize(),this.selectedCoordsNormal=this.selectedCoords.clone().add(this.selectedNormal);const h=this.world.getBlock(this.selectedCoords.x,this.selectedCoords.y,this.selectedCoords.z);if(h&&h.id!==E.empty.id){let c=O(h.id).geometry;c.computeBoundingBox();let u=new I;c.boundingBox.getSize(u),this.selectionHelper.scale.set(u.x+.01,u.y+.01,u.z+.01),this.selectedEntity=null}this.selectionHelper.position.copy(this.selectedCoords),this.selectionHelper.visible=!0}else{this.selectedCoords=null,this.selectionHelper.visible=!1;const o=s.object.userData.entity;o&&(this.selectedEntity=o)}}else this.selectedCoords=null,this.selectionHelper.visible=!1,this.selectedEntity=null}animateBlockBreaking(i){this.selectionBreakHelper.position.copy(this.selectedCoords),this.selectionBreakHelper.visible=!0;const n=i/6;this.nextStep(n,0)}nextStep(i,t){if(t<=6&&this.isDestroying){const o=t%2,r=Math.floor(t/2);this.selectionBreakHelper.material.map.offset.set(o/2,r/3),this.selectionBreakHelper.material.map.repeat.set(1/2,1/3),t++,setTimeout(this.nextStep.bind(this),i,i,t)}else this.selectionBreakHelper.visible=!1}setBlockInHand(i){const t=O(i);if(t!=null&&t.material){this.scene.remove(this.meshHandItem),this.camera.remove(this.meshHandItem);const n=t.geometry.clone();n.scale(.3,.3,.3),this.meshHandItem=new N(n,t.material),this.meshHandItem.count=0,this.meshHandItem.castShadow=!0,this.meshHandItem.receiveShadow=!0,this.meshHandItem.rotation.x=-.2,this.meshHandItem.rotation.z=0,this.meshHandItem.rotation.y=.6,this.meshHandItem.position.set(.55,-.45,-.5),this.scene.add(this.meshHandItem),this.camera.add(this.meshHandItem),this.handMesh.visible=!1}else this.meshHandItem&&(this.meshHandItem.visible=!1),this.handMesh.visible=!0}get worldVelocity(){return be(this,Ot).copy(this.velocity),be(this,Ot).applyEuler(new dt(0,this.camera.rotation.y,0)),be(this,Ot)}applyWorldDeltaVelocity(i){i.applyEuler(new dt(0,-this.camera.rotation.y,0)),this.velocity.add(i)}applyInputs(i){var t;if(!this.usePointerLock||this.controls.isLocked){const n=this.world.getBlock(Math.floor(this.position.x),Math.floor(this.position.y+this.height/2),Math.floor(this.position.z));this.inWater=(n==null?void 0:n.id)===E.water.id,this.velocity.x=this.input.x,this.velocity.z=this.input.z,this.inWater&&(this.velocity.x*=.4,this.velocity.z*=.4),this.controls.moveRight(this.velocity.x*i),this.controls.moveForward(this.velocity.z*i),this.position.y+=this.velocity.y*i;let s=this.world.getPlayerBiome(Math.floor(this.position.x),Math.floor(this.position.z));document.getElementById("player-position").innerHTML=this.toString()+" - "+s;const o=new I;this.camera.getWorldDirection(o),(t=this.socket.getSocket())==null||t.emit("playerState",{id:this.socket.id,position:{x:this.position.x,y:this.position.y,z:this.position.z},direction:{x:o.x,y:o.y,z:o.z}}),this.scene.fog=this.inWater?this.underwaterFog:this.defaultFog,this.riding&&(typeof this.riding.setInput=="function"&&this.riding.setInput(this.input),this.position.copy(this.riding.position.clone().add(new I(0,1,0))),this.camera.position.copy(this.position))}}updateBoundsHelper(){this.boundsHelper.position.copy(this.position),this.boundsHelper.position.y-=this.height/2}onKeyDown(i){i.code==="ShiftLeft"&&(this.run=this.maxRun),i.code==="KeyW"&&(this.input.z=this.maxSpeed+this.run),i.code==="KeyS"&&(this.input.z=-this.maxSpeed+this.run),i.code==="KeyA"&&(this.input.x=-this.maxSpeed+this.run),i.code==="KeyD"&&(this.input.x=this.maxSpeed+this.run),i.code==="Space"&&this.onGround&&(this.velocity.y+=this.jumpSpeed),i.code==="F5"&&this.camera.position.set(this.camera.position.x,this.camera.position.y+1,this.camera.position.z)}onKeyUp(i){i.code==="ShiftLeft"&&(this.run=0),i.code==="KeyW"&&(this.input.z=0),i.code==="KeyS"&&(this.input.z=0),i.code==="KeyA"&&(this.input.x=0),i.code==="KeyD"&&(this.input.x=0)}get position(){return this.camera.position}toString(){let i="";return i+=`X: ${this.position.x.toFixed(3)} `,i+=`Y: ${this.position.y.toFixed(3)} `,i+=`Z: ${this.position.z.toFixed(3)}`,i}save(){(async()=>{new Blob([JSON.stringify(this.position)]).size;const i=this.position;await Po(i)})()}load(){(async()=>{const i=await Uo();this.position.set(i.x,i.y,i.z)})()}setInventory(i){this.inventory=i}setUI(i){this.ui=i}toggleDoor(i,t,n){const s=this.world.getBlock(i,t,n);if(!s)return;let o=i,r=t,a=n;(s.id||0)>=1e3&&(r-=1);const c=this.world.getBlock(o,r,a),u=this.world.getBlock(o,r+1,a);if(!c)return;this.world.toggleDoorAt(i,t,n),console.log("toggle door");const f=!c.isOpen;c.isOpen=f,c.mesh&&(c.mesh.rotation.y=f?-Math.PI/2:0),u&&u.id&&(u.isOpen=f,u.mesh&&(u.mesh.rotation.y=f?-Math.PI/2:0));try{const d=O(c.id);d!=null&&d.soundGroup&&this.audioManager.playBlockSound(d.soundGroup,f?"open_door":"close_door")}catch{}}takeDamage(i,t={}){this.health&&(this.health.remove(i),this.audioManager.playBlockSound("player","hurt"))}}Ot=new WeakMap;const No="minecraftDB",ie="minecraftData";function Xn(){return new Promise((e,i)=>{const t=indexedDB.open(No,1);t.onupgradeneeded=function(n){n.target.result.createObjectStore(ie,{keyPath:"id"})},t.onsuccess=function(n){e(n.target.result)},t.onerror=function(n){i(n.target.error)}})}async function Po(e){const t=(await Xn()).transaction([ie],"readwrite");return t.objectStore(ie).put({id:"minecraft_player_position",data:e}),t.complete}async function Uo(){const e=await Xn();return new Promise((i,t)=>{const o=e.transaction([ie],"readonly").objectStore(ie).get("minecraft_player_position");o.onsuccess=function(){var r;i(((r=o.result)==null?void 0:r.data)||null)},o.onerror=function(r){t(r.target.error)}})}class Ho{constructor(){this.data={}}clear(){this.data={}}contains(i,t){const n=this.getKey(i,t);return this.data[n]!==void 0}get(i,t){const n=this.getKey(i,t);return this.data[n]}set(i,t,n){const s=this.getKey(i,t);this.data[s]=n}getKey(i,t){return`${i},${t}`}getData(){return this.data}setData(i){this.data=i}}class Wn{constructor(){m(this,"output",2);m(this,"fuel",1);m(this,"input",0);m(this,"cookDurationSec",5);m(this,"fuelBurnSecById",{302:40});this.smelting=new ao}ensureState(i){return i._furnaceState||(i._furnaceState={burnLeft:0,cookTime:0,lastInputBlock:null}),i._furnaceState}getFuelBurnSeconds(i){return i!=null&&i.block?this.fuelBurnSecById[i.block]??0:0}canOutputAccept(i,t){return t?i?i.block!==t.id?!1:i.quantity+t.quantity<=64:!0:!1}produceOutput(i,t){const n=i[this.output]??null;n?n.quantity+=t.quantity:i[this.output]={block:t.id,quantity:t.quantity}}decreaseQuantity(i,t){const n=i[t];n&&(n.quantity>1?n.quantity-=1:i[t]=null)}tick(i,t){if(!t)return!1;const n=this.ensureState(t);let s=!1;const o=t[this.input]??null,r=t[this.fuel]??null,a=t[this.output]??null,l=this.smelting.getOutput(o),h=(o==null?void 0:o.block)??null;n.lastInputBlock!==h&&(n.lastInputBlock=h,n.cookTime=0,s=!0);const c=!!l&&this.canOutputAccept(a,l);if(n.burnLeft<=0&&c){const u=this.getFuelBurnSeconds(r);u>0&&(this.decreaseQuantity(t,this.fuel),n.burnLeft=u,s=!0)}if(n.burnLeft>0){const u=n.burnLeft;n.burnLeft=Math.max(0,n.burnLeft-i),n.burnLeft!==u&&(s=!0)}if(n.burnLeft>0&&c){if(n.cookTime+=i,n.cookTime>=this.cookDurationSec)for(;n.cookTime>=this.cookDurationSec;){const u=t[this.input]??null,f=t[this.output]??null,d=this.smelting.getOutput(u);if(!d||!this.canOutputAccept(f,d))break;this.produceOutput(t,d),this.decreaseQuantity(t,this.input),s=!0,n.cookTime-=this.cookDurationSec}}else n.cookTime!==0&&(n.cookTime=0,s=!0);return s}getProgress(i){const t=this.ensureState(i),n=this.cookDurationSec,s=n>0?Math.max(0,Math.min(1,t.cookTime/n)):0,o=(i==null?void 0:i[this.fuel])??null,r=t.burnLeft>0?Math.max(1e-6,t.burnLeft):this.getFuelBurnSeconds(o)||0,a=r>0?Math.max(0,Math.min(1,t.burnLeft/r)):0;return{cookPct:s,burnPct:a,cookTime:t.cookTime,cookDuration:n,burnLeft:t.burnLeft,burnMax:r}}}class Ki{constructor(){m(this,"chunkSize",{width:16,height:80});m(this,"drawDistance",2);m(this,"dataStore",new Ho);m(this,"entities",[]);m(this,"furnace",new Wn);m(this,"params",{seed:456789986,terrain:{scale:40,magnitude:.1,offset:.5},biomes:{mountains:{scale:40,magnitude:.2,offset:.5},plains:{scale:80,magnitude:.1,offset:.5},forest:{scale:40,magnitude:.1,offset:.5},desert:{scale:120,magnitude:.1,offset:.5},ocean:{scale:80,magnitude:.12,offset:.42},beach:{scale:160,magnitude:.02,offset:.5}},trees:{trunk:{minHeight:4,maxHeight:7},canopy:{minRadius:3,maxRadius:3,density:.7},frequency:.005},seaLevel:36})}worldToChunkCoords(i,t,n){const s={x:Math.floor(i/this.chunkSize.width),z:Math.floor(n/this.chunkSize.width)},o={x:i-this.chunkSize.width*s.x,y:t,z:n-this.chunkSize.width*s.z};return{chunk:s,block:o}}getBlock(i,t,n){const s=this.worldToChunkCoords(i,t,n),o=this.getChunk(s.chunk.x,s.chunk.z);return o?o.getBlock(s.block.x,s.block.y,s.block.z):null}setBlockInventory(i,t,n,s){const o=this.worldToChunkCoords(i,t,n),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.setBlockInventory(o.block.x,o.block.y,o.block.z,s)}removeBlock(i,t,n){throw new Error("removeBlock must be implemented by child class")}getChunk(i,t){var n;if(typeof((n=this.parent)==null?void 0:n.getChunk)=="function")return this.parent.getChunk(i,t);throw new Error("getChunk must be implemented by child class")}encodeChunk(i,t){var s,o,r,a,l;const n=[];for(let h=0;h<this.chunkSize.width;h++)for(let c=0;c<this.chunkSize.height;c++)for(let u=0;u<this.chunkSize.width;u++){const f=i[h][c][u];n.push(f.id??0);const d=f.instanceId??-1;n.push(...new Uint8Array(new Int32Array([d]).buffer)),n.push(((s=f.direction)==null?void 0:s.x)??0,((o=f.direction)==null?void 0:o.y)??0,((r=f.direction)==null?void 0:r.z)??0);const p=((a=f.inventory)==null?void 0:a.length)>0;if(n.push(p?1:0),p)for(let b=0;b<27;b++){const g=((l=f.inventory)==null?void 0:l[b])??{block:0,quantity:0};n.push((g.block&65280)>>8,g.block&255,g.quantity)}}for(let h=0;h<this.chunkSize.width;h++)for(let c=0;c<this.chunkSize.width;c++){const u=t[h][c]??"plains";n.push(u)}return Uint8Array.from(n)}decodeChunk(i){const t=new DataView(i.buffer||i),n=[],s=[];let o=0;for(let r=0;r<this.chunkSize.width;r++){n[r]=[];for(let a=0;a<this.chunkSize.height;a++){n[r][a]=[];for(let l=0;l<this.chunkSize.width;l++){const h=t.getUint8(o++),c=t.getInt32(o);o+=4;const u={x:t.getInt8(o++),y:t.getInt8(o++),z:t.getInt8(o++)},f=t.getUint8(o++);let d=null;if(f){d=[];for(let p=0;p<27;p++){const b=t.getUint16(o);o+=2;const g=t.getUint8(o++);b!==0&&g>0?d.push({block:b,quantity:g}):d.push(null)}}n[r][a][l]={id:h,instanceId:c,direction:u,inventory:d}}}}for(let r=0;r<this.chunkSize.width;r++){s[r]=[];for(let a=0;a<this.chunkSize.width;a++){const l=t.getUint8(o++);s[r][a]=l??"plains"}}return{data:n,biomes:s}}getPlayerBiome(i,t){const n=this.worldToChunkCoords(i,0,t),s=this.getChunk(n.chunk.x,n.chunk.z);return s?s.getBiome(n.block.x,n.block.z):null}checkRemoveTree(i,t,n){var o;const s=this.getBlock(i,t,n);if(console.log(i,t,n),console.log(s.id),s.id==17)for(let r=-6;r<=6;r++)for(let a=-6;a<=6;a++)for(let l=-6;l<=6;l++){let h=i+r,c=t+a,u=n+l;r===0&&a===0&&l===0||((o=this.getBlock(h,c,u))==null?void 0:o.id)==18&&this.removeBlock(h,c,u)}}isload(i,t,n){const s=this.worldToChunkCoords(i,t,n),o=this.getChunk(s.chunk.x,s.chunk.z);return!!(o&&o.data.length!==0)}addEntity(i){this.entities.push(i)}getLoadedChunks(){var t,n;if(typeof((t=this.parent)==null?void 0:t.getLoadedChunks)=="function")return this.parent.getLoadedChunks();const i=this.chunks??((n=this.parent)==null?void 0:n.chunks);return i?i instanceof Map?i.values():Array.isArray(i)?i:typeof i=="object"?Object.values(i):[]:[]}updateBlockEntities(i){var s,o,r;const t=this.getLoadedChunks();let n=[];for(const a of t){const l=a==null?void 0:a.data;if(!l||l.length===0)continue;let h=!1;for(let c=0;c<this.chunkSize.width;c++){const u=l[c];if(u)for(let f=0;f<this.chunkSize.height;f++){const d=u[f];if(d)for(let p=0;p<this.chunkSize.width;p++){const b=d[p];if(b&&b.id===61&&Array.isArray(b.inventory)){const g=this.furnace.tick(i,b.inventory);g&&(h=!0);const v=(s=b.inventory)==null?void 0:s._furnaceState,k=v&&(v.burnLeftSec>0||v.cookProgress>0),x=c+(((o=a==null?void 0:a.position)==null?void 0:o.x)??0)*this.chunkSize.width,_=p+(((r=a==null?void 0:a.position)==null?void 0:r.z)??0)*this.chunkSize.width;(g||k)&&n.push({x,y:f,z:_,inventory:b.inventory,state:v})}}}}h&&(typeof a.setDirty=="function"?a.setDirty(!0):a.dirty=!0)}return n}removeEntity(i){const t=this.entities.indexOf(i);return t!==-1?(this.entities.splice(t,1),!0):!1}updateEntities(i){for(const t of this.entities)t.update(i)}}class Yi{constructor(i,t,n){m(this,"chunkSize");m(this,"height");m(this,"data");m(this,"biomes");this.chunkSize=i.width,this.height=i.height,this.params=t,this.dataStore=n,this.data=[],this.biomes=[]}getBlock(i,t,n){return this.inBounds(i,t,n)&&this.data[i]?this.data[i][t][n]:null}addBlock(i,t,n,s,o){this.inBounds(i,t,n)&&(this.setBlockId(i,t,n,s),this.setBlockDirection(i,t,n,o))}removeBlock(i,t,n){const s=this.getBlock(i,t,n);s&&s.id!==0&&this.setBlockId(i,t,n,0)}setBlockId(i,t,n,s){this.data[i][t][n].id=s}setBlockDirection(i,t,n,s){this.data[i][t][n].direction=s}inBounds(i,t,n){return i>=0&&i<this.chunkSize&&n>=0&&n<this.chunkSize&&t>=0&&t<this.height}setBiomeMap(i){this.biomes=i}getBiome(i,t){var n;return this.inBounds(i,0,t)&&((n=this.biomes[i])==null?void 0:n[t])||null}setBlockInventory(i,t,n,s){this.inBounds(i,t,n)&&(this.data[i][t][n].inventory=s)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Fo=4,ji=0,Vi=1,qo=2;function Ht(e){let i=e.length;for(;--i>=0;)e[i]=0}const Zo=0,Qn=1,$o=2,Go=3,Ko=258,Bi=29,ue=256,ne=ue+1+Bi,Rt=30,zi=19,Jn=2*ne+1,vt=15,$e=16,Yo=7,Ci=256,ts=16,es=17,is=18,li=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ce=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),jo=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ns=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vo=512,ft=new Array((ne+2)*2);Ht(ft);const Xt=new Array(Rt*2);Ht(Xt);const se=new Array(Vo);Ht(se);const oe=new Array(Ko-Go+1);Ht(oe);const Ai=new Array(Bi);Ht(Ai);const Oe=new Array(Rt);Ht(Oe);function Ge(e,i,t,n,s){this.static_tree=e,this.extra_bits=i,this.extra_base=t,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let ss,os,rs;function Ke(e,i){this.dyn_tree=e,this.max_code=0,this.stat_desc=i}const as=e=>e<256?se[e]:se[256+(e>>>7)],re=(e,i)=>{e.pending_buf[e.pending++]=i&255,e.pending_buf[e.pending++]=i>>>8&255},j=(e,i,t)=>{e.bi_valid>$e-t?(e.bi_buf|=i<<e.bi_valid&65535,re(e,e.bi_buf),e.bi_buf=i>>$e-e.bi_valid,e.bi_valid+=t-$e):(e.bi_buf|=i<<e.bi_valid&65535,e.bi_valid+=t)},nt=(e,i,t)=>{j(e,t[i*2],t[i*2+1])},hs=(e,i)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--i>0);return t>>>1},Xo=e=>{e.bi_valid===16?(re(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},Wo=(e,i)=>{const t=i.dyn_tree,n=i.max_code,s=i.stat_desc.static_tree,o=i.stat_desc.has_stree,r=i.stat_desc.extra_bits,a=i.stat_desc.extra_base,l=i.stat_desc.max_length;let h,c,u,f,d,p,b=0;for(f=0;f<=vt;f++)e.bl_count[f]=0;for(t[e.heap[e.heap_max]*2+1]=0,h=e.heap_max+1;h<Jn;h++)c=e.heap[h],f=t[t[c*2+1]*2+1]+1,f>l&&(f=l,b++),t[c*2+1]=f,!(c>n)&&(e.bl_count[f]++,d=0,c>=a&&(d=r[c-a]),p=t[c*2],e.opt_len+=p*(f+d),o&&(e.static_len+=p*(s[c*2+1]+d)));if(b!==0){do{for(f=l-1;e.bl_count[f]===0;)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[l]--,b-=2}while(b>0);for(f=l;f!==0;f--)for(c=e.bl_count[f];c!==0;)u=e.heap[--h],!(u>n)&&(t[u*2+1]!==f&&(e.opt_len+=(f-t[u*2+1])*t[u*2],t[u*2+1]=f),c--)}},cs=(e,i,t)=>{const n=new Array(vt+1);let s=0,o,r;for(o=1;o<=vt;o++)s=s+t[o-1]<<1,n[o]=s;for(r=0;r<=i;r++){let a=e[r*2+1];a!==0&&(e[r*2]=hs(n[a]++,a))}},Qo=()=>{let e,i,t,n,s;const o=new Array(vt+1);for(t=0,n=0;n<Bi-1;n++)for(Ai[n]=t,e=0;e<1<<li[n];e++)oe[t++]=n;for(oe[t-1]=n,s=0,n=0;n<16;n++)for(Oe[n]=s,e=0;e<1<<Ce[n];e++)se[s++]=n;for(s>>=7;n<Rt;n++)for(Oe[n]=s<<7,e=0;e<1<<Ce[n]-7;e++)se[256+s++]=n;for(i=0;i<=vt;i++)o[i]=0;for(e=0;e<=143;)ft[e*2+1]=8,e++,o[8]++;for(;e<=255;)ft[e*2+1]=9,e++,o[9]++;for(;e<=279;)ft[e*2+1]=7,e++,o[7]++;for(;e<=287;)ft[e*2+1]=8,e++,o[8]++;for(cs(ft,ne+1,o),e=0;e<Rt;e++)Xt[e*2+1]=5,Xt[e*2]=hs(e,5);ss=new Ge(ft,li,ue+1,ne,vt),os=new Ge(Xt,Ce,0,Rt,vt),rs=new Ge(new Array(0),jo,0,zi,Yo)},ls=e=>{let i;for(i=0;i<ne;i++)e.dyn_ltree[i*2]=0;for(i=0;i<Rt;i++)e.dyn_dtree[i*2]=0;for(i=0;i<zi;i++)e.bl_tree[i*2]=0;e.dyn_ltree[Ci*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ds=e=>{e.bi_valid>8?re(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Xi=(e,i,t,n)=>{const s=i*2,o=t*2;return e[s]<e[o]||e[s]===e[o]&&n[i]<=n[t]},Ye=(e,i,t)=>{const n=e.heap[t];let s=t<<1;for(;s<=e.heap_len&&(s<e.heap_len&&Xi(i,e.heap[s+1],e.heap[s],e.depth)&&s++,!Xi(i,n,e.heap[s],e.depth));)e.heap[t]=e.heap[s],t=s,s<<=1;e.heap[t]=n},Wi=(e,i,t)=>{let n,s,o=0,r,a;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+o++]&255,n+=(e.pending_buf[e.sym_buf+o++]&255)<<8,s=e.pending_buf[e.sym_buf+o++],n===0?nt(e,s,i):(r=oe[s],nt(e,r+ue+1,i),a=li[r],a!==0&&(s-=Ai[r],j(e,s,a)),n--,r=as(n),nt(e,r,t),a=Ce[r],a!==0&&(n-=Oe[r],j(e,n,a)));while(o<e.sym_next);nt(e,Ci,i)},di=(e,i)=>{const t=i.dyn_tree,n=i.stat_desc.static_tree,s=i.stat_desc.has_stree,o=i.stat_desc.elems;let r,a,l=-1,h;for(e.heap_len=0,e.heap_max=Jn,r=0;r<o;r++)t[r*2]!==0?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):t[r*2+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=l<2?++l:0,t[h*2]=1,e.depth[h]=0,e.opt_len--,s&&(e.static_len-=n[h*2+1]);for(i.max_code=l,r=e.heap_len>>1;r>=1;r--)Ye(e,t,r);h=o;do r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ye(e,t,1),a=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=a,t[h*2]=t[r*2]+t[a*2],e.depth[h]=(e.depth[r]>=e.depth[a]?e.depth[r]:e.depth[a])+1,t[r*2+1]=t[a*2+1]=h,e.heap[1]=h++,Ye(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Wo(e,i),cs(t,l,e.bl_count)},Qi=(e,i,t)=>{let n,s=-1,o,r=i[0*2+1],a=0,l=7,h=4;for(r===0&&(l=138,h=3),i[(t+1)*2+1]=65535,n=0;n<=t;n++)o=r,r=i[(n+1)*2+1],!(++a<l&&o===r)&&(a<h?e.bl_tree[o*2]+=a:o!==0?(o!==s&&e.bl_tree[o*2]++,e.bl_tree[ts*2]++):a<=10?e.bl_tree[es*2]++:e.bl_tree[is*2]++,a=0,s=o,r===0?(l=138,h=3):o===r?(l=6,h=3):(l=7,h=4))},Ji=(e,i,t)=>{let n,s=-1,o,r=i[0*2+1],a=0,l=7,h=4;for(r===0&&(l=138,h=3),n=0;n<=t;n++)if(o=r,r=i[(n+1)*2+1],!(++a<l&&o===r)){if(a<h)do nt(e,o,e.bl_tree);while(--a!==0);else o!==0?(o!==s&&(nt(e,o,e.bl_tree),a--),nt(e,ts,e.bl_tree),j(e,a-3,2)):a<=10?(nt(e,es,e.bl_tree),j(e,a-3,3)):(nt(e,is,e.bl_tree),j(e,a-11,7));a=0,s=o,r===0?(l=138,h=3):o===r?(l=6,h=3):(l=7,h=4)}},Jo=e=>{let i;for(Qi(e,e.dyn_ltree,e.l_desc.max_code),Qi(e,e.dyn_dtree,e.d_desc.max_code),di(e,e.bl_desc),i=zi-1;i>=3&&e.bl_tree[ns[i]*2+1]===0;i--);return e.opt_len+=3*(i+1)+5+5+4,i},tr=(e,i,t,n)=>{let s;for(j(e,i-257,5),j(e,t-1,5),j(e,n-4,4),s=0;s<n;s++)j(e,e.bl_tree[ns[s]*2+1],3);Ji(e,e.dyn_ltree,i-1),Ji(e,e.dyn_dtree,t-1)},er=e=>{let i=4093624447,t;for(t=0;t<=31;t++,i>>>=1)if(i&1&&e.dyn_ltree[t*2]!==0)return ji;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Vi;for(t=32;t<ue;t++)if(e.dyn_ltree[t*2]!==0)return Vi;return ji};let tn=!1;const ir=e=>{tn||(Qo(),tn=!0),e.l_desc=new Ke(e.dyn_ltree,ss),e.d_desc=new Ke(e.dyn_dtree,os),e.bl_desc=new Ke(e.bl_tree,rs),e.bi_buf=0,e.bi_valid=0,ls(e)},fs=(e,i,t,n)=>{j(e,(Zo<<1)+(n?1:0),3),ds(e),re(e,t),re(e,~t),t&&e.pending_buf.set(e.window.subarray(i,i+t),e.pending),e.pending+=t},nr=e=>{j(e,Qn<<1,3),nt(e,Ci,ft),Xo(e)},sr=(e,i,t,n)=>{let s,o,r=0;e.level>0?(e.strm.data_type===qo&&(e.strm.data_type=er(e)),di(e,e.l_desc),di(e,e.d_desc),r=Jo(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=t+5,t+4<=s&&i!==-1?fs(e,i,t,n):e.strategy===Fo||o===s?(j(e,(Qn<<1)+(n?1:0),3),Wi(e,ft,Xt)):(j(e,($o<<1)+(n?1:0),3),tr(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),Wi(e,e.dyn_ltree,e.dyn_dtree)),ls(e),n&&ds(e)},or=(e,i,t)=>(e.pending_buf[e.sym_buf+e.sym_next++]=i,e.pending_buf[e.sym_buf+e.sym_next++]=i>>8,e.pending_buf[e.sym_buf+e.sym_next++]=t,i===0?e.dyn_ltree[t*2]++:(e.matches++,i--,e.dyn_ltree[(oe[t]+ue+1)*2]++,e.dyn_dtree[as(i)*2]++),e.sym_next===e.sym_end);var rr=ir,ar=fs,hr=sr,cr=or,lr=nr,dr={_tr_init:rr,_tr_stored_block:ar,_tr_flush_block:hr,_tr_tally:cr,_tr_align:lr};const fr=(e,i,t,n)=>{let s=e&65535|0,o=e>>>16&65535|0,r=0;for(;t!==0;){r=t>2e3?2e3:t,t-=r;do s=s+i[n++]|0,o=o+s|0;while(--r);s%=65521,o%=65521}return s|o<<16|0};var ae=fr;const ur=()=>{let e,i=[];for(var t=0;t<256;t++){e=t;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;i[t]=e}return i},pr=new Uint32Array(ur()),_r=(e,i,t,n)=>{const s=pr,o=n+t;e^=-1;for(let r=n;r<o;r++)e=e>>>8^s[(e^i[r])&255];return e^-1};var $=_r,St={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Bt={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:mr,_tr_stored_block:fi,_tr_flush_block:gr,_tr_tally:gt,_tr_align:yr}=dr,{Z_NO_FLUSH:yt,Z_PARTIAL_FLUSH:wr,Z_FULL_FLUSH:br,Z_FINISH:J,Z_BLOCK:en,Z_OK:G,Z_STREAM_END:nn,Z_STREAM_ERROR:ot,Z_DATA_ERROR:kr,Z_BUF_ERROR:je,Z_DEFAULT_COMPRESSION:vr,Z_FILTERED:xr,Z_HUFFMAN_ONLY:ke,Z_RLE:Er,Z_FIXED:Sr,Z_DEFAULT_STRATEGY:Ir,Z_UNKNOWN:Tr,Z_DEFLATED:Ue}=Bt,Br=9,zr=15,Cr=8,Ar=29,Mr=256,ui=Mr+1+Ar,Dr=30,Lr=19,Rr=2*ui+1,Or=15,M=3,mt=258,rt=mt+M+1,Nr=32,Nt=42,Mi=57,pi=69,_i=73,mi=91,gi=103,xt=113,Kt=666,Y=1,Ft=2,It=3,qt=4,Pr=3,Et=(e,i)=>(e.msg=St[i],i),sn=e=>e*2-(e>4?9:0),_t=e=>{let i=e.length;for(;--i>=0;)e[i]=0},Ur=e=>{let i,t,n,s=e.w_size;i=e.hash_size,n=i;do t=e.head[--n],e.head[n]=t>=s?t-s:0;while(--i);i=s,n=i;do t=e.prev[--n],e.prev[n]=t>=s?t-s:0;while(--i)};let Hr=(e,i,t)=>(i<<e.hash_shift^t)&e.hash_mask,wt=Hr;const V=e=>{const i=e.state;let t=i.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+t),e.next_out),e.next_out+=t,i.pending_out+=t,e.total_out+=t,e.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))},W=(e,i)=>{gr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,i),e.block_start=e.strstart,V(e.strm)},L=(e,i)=>{e.pending_buf[e.pending++]=i},$t=(e,i)=>{e.pending_buf[e.pending++]=i>>>8&255,e.pending_buf[e.pending++]=i&255},yi=(e,i,t,n)=>{let s=e.avail_in;return s>n&&(s=n),s===0?0:(e.avail_in-=s,i.set(e.input.subarray(e.next_in,e.next_in+s),t),e.state.wrap===1?e.adler=ae(e.adler,i,s,t):e.state.wrap===2&&(e.adler=$(e.adler,i,s,t)),e.next_in+=s,e.total_in+=s,s)},us=(e,i)=>{let t=e.max_chain_length,n=e.strstart,s,o,r=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-rt?e.strstart-(e.w_size-rt):0,h=e.window,c=e.w_mask,u=e.prev,f=e.strstart+mt;let d=h[n+r-1],p=h[n+r];e.prev_length>=e.good_match&&(t>>=2),a>e.lookahead&&(a=e.lookahead);do if(s=i,!(h[s+r]!==p||h[s+r-1]!==d||h[s]!==h[n]||h[++s]!==h[n+1])){n+=2,s++;do;while(h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&n<f);if(o=mt-(f-n),n=f-mt,o>r){if(e.match_start=i,r=o,o>=a)break;d=h[n+r-1],p=h[n+r]}}while((i=u[i&c])>l&&--t!==0);return r<=e.lookahead?r:e.lookahead},Pt=e=>{const i=e.w_size;let t,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-rt)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),Ur(e),n+=i),e.strm.avail_in===0)break;if(t=yi(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=M)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=wt(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=wt(e,e.ins_h,e.window[s+M-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<rt&&e.strm.avail_in!==0)},ps=(e,i)=>{let t=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,s,o,r=0,a=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>o&&(n=o),n<t&&(n===0&&i!==J||i===yt||n!==s+e.strm.avail_in)))break;r=i===J&&n===s+e.strm.avail_in?1:0,fi(e,0,0,r),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,V(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(yi(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(r===0);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?qt:i!==yt&&i!==J&&e.strm.avail_in===0&&e.strstart===e.block_start?Ft:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(yi(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,t=o>e.w_size?e.w_size:o,s=e.strstart-e.block_start,(s>=t||(s||i===J)&&i!==yt&&e.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,r=i===J&&e.strm.avail_in===0&&n===s?1:0,fi(e,e.block_start,n,r),e.block_start+=n,V(e.strm)),r?It:Y)},Ve=(e,i)=>{let t,n;for(;;){if(e.lookahead<rt){if(Pt(e),e.lookahead<rt&&i===yt)return Y;if(e.lookahead===0)break}if(t=0,e.lookahead>=M&&(e.ins_h=wt(e,e.ins_h,e.window[e.strstart+M-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-rt&&(e.match_length=us(e,t)),e.match_length>=M)if(n=gt(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do e.strstart++,e.ins_h=wt(e,e.ins_h,e.window[e.strstart+M-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=wt(e,e.ins_h,e.window[e.strstart+1]);else n=gt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(W(e,!1),e.strm.avail_out===0))return Y}return e.insert=e.strstart<M-1?e.strstart:M-1,i===J?(W(e,!0),e.strm.avail_out===0?It:qt):e.sym_next&&(W(e,!1),e.strm.avail_out===0)?Y:Ft},Mt=(e,i)=>{let t,n,s;for(;;){if(e.lookahead<rt){if(Pt(e),e.lookahead<rt&&i===yt)return Y;if(e.lookahead===0)break}if(t=0,e.lookahead>=M&&(e.ins_h=wt(e,e.ins_h,e.window[e.strstart+M-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-rt&&(e.match_length=us(e,t),e.match_length<=5&&(e.strategy===xr||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-M,n=gt(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=wt(e,e.ins_h,e.window[e.strstart+M-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=M-1,e.strstart++,n&&(W(e,!1),e.strm.avail_out===0))return Y}else if(e.match_available){if(n=gt(e,0,e.window[e.strstart-1]),n&&W(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Y}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=gt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,i===J?(W(e,!0),e.strm.avail_out===0?It:qt):e.sym_next&&(W(e,!1),e.strm.avail_out===0)?Y:Ft},Fr=(e,i)=>{let t,n,s,o;const r=e.window;for(;;){if(e.lookahead<=mt){if(Pt(e),e.lookahead<=mt&&i===yt)return Y;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(s=e.strstart-1,n=r[s],n===r[++s]&&n===r[++s]&&n===r[++s])){o=e.strstart+mt;do;while(n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&s<o);e.match_length=mt-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(t=gt(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=gt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(W(e,!1),e.strm.avail_out===0))return Y}return e.insert=0,i===J?(W(e,!0),e.strm.avail_out===0?It:qt):e.sym_next&&(W(e,!1),e.strm.avail_out===0)?Y:Ft},qr=(e,i)=>{let t;for(;;){if(e.lookahead===0&&(Pt(e),e.lookahead===0)){if(i===yt)return Y;break}if(e.match_length=0,t=gt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(W(e,!1),e.strm.avail_out===0))return Y}return e.insert=0,i===J?(W(e,!0),e.strm.avail_out===0?It:qt):e.sym_next&&(W(e,!1),e.strm.avail_out===0)?Y:Ft};function it(e,i,t,n,s){this.good_length=e,this.max_lazy=i,this.nice_length=t,this.max_chain=n,this.func=s}const Yt=[new it(0,0,0,0,ps),new it(4,4,8,4,Ve),new it(4,5,16,8,Ve),new it(4,6,32,32,Ve),new it(4,4,16,16,Mt),new it(8,16,32,32,Mt),new it(8,16,128,128,Mt),new it(8,32,128,256,Mt),new it(32,128,258,1024,Mt),new it(32,258,258,4096,Mt)],Zr=e=>{e.window_size=2*e.w_size,_t(e.head),e.max_lazy_match=Yt[e.level].max_lazy,e.good_match=Yt[e.level].good_length,e.nice_match=Yt[e.level].nice_length,e.max_chain_length=Yt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=M-1,e.match_available=0,e.ins_h=0};function $r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ue,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Rr*2),this.dyn_dtree=new Uint16Array((2*Dr+1)*2),this.bl_tree=new Uint16Array((2*Lr+1)*2),_t(this.dyn_ltree),_t(this.dyn_dtree),_t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Or+1),this.heap=new Uint16Array(2*ui+1),_t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ui+1),_t(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const pe=e=>{if(!e)return 1;const i=e.state;return!i||i.strm!==e||i.status!==Nt&&i.status!==Mi&&i.status!==pi&&i.status!==_i&&i.status!==mi&&i.status!==gi&&i.status!==xt&&i.status!==Kt?1:0},_s=e=>{if(pe(e))return Et(e,ot);e.total_in=e.total_out=0,e.data_type=Tr;const i=e.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?Mi:i.wrap?Nt:xt,e.adler=i.wrap===2?0:1,i.last_flush=-2,mr(i),G},ms=e=>{const i=_s(e);return i===G&&Zr(e.state),i},Gr=(e,i)=>pe(e)||e.state.wrap!==2?ot:(e.state.gzhead=i,G),gs=(e,i,t,n,s,o)=>{if(!e)return ot;let r=1;if(i===vr&&(i=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),s<1||s>Br||t!==Ue||n<8||n>15||i<0||i>9||o<0||o>Sr||n===8&&r!==1)return Et(e,ot);n===8&&(n=9);const a=new $r;return e.state=a,a.strm=e,a.status=Nt,a.wrap=r,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+M-1)/M),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=i,a.strategy=o,a.method=t,ms(e)},Kr=(e,i)=>gs(e,i,Ue,zr,Cr,Ir),Yr=(e,i)=>{if(pe(e)||i>en||i<0)return e?Et(e,ot):ot;const t=e.state;if(!e.output||e.avail_in!==0&&!e.input||t.status===Kt&&i!==J)return Et(e,e.avail_out===0?je:ot);const n=t.last_flush;if(t.last_flush=i,t.pending!==0){if(V(e),e.avail_out===0)return t.last_flush=-1,G}else if(e.avail_in===0&&sn(i)<=sn(n)&&i!==J)return Et(e,je);if(t.status===Kt&&e.avail_in!==0)return Et(e,je);if(t.status===Nt&&t.wrap===0&&(t.status=xt),t.status===Nt){let s=Ue+(t.w_bits-8<<4)<<8,o=-1;if(t.strategy>=ke||t.level<2?o=0:t.level<6?o=1:t.level===6?o=2:o=3,s|=o<<6,t.strstart!==0&&(s|=Nr),s+=31-s%31,$t(t,s),t.strstart!==0&&($t(t,e.adler>>>16),$t(t,e.adler&65535)),e.adler=1,t.status=xt,V(e),t.pending!==0)return t.last_flush=-1,G}if(t.status===Mi){if(e.adler=0,L(t,31),L(t,139),L(t,8),t.gzhead)L(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),L(t,t.gzhead.time&255),L(t,t.gzhead.time>>8&255),L(t,t.gzhead.time>>16&255),L(t,t.gzhead.time>>24&255),L(t,t.level===9?2:t.strategy>=ke||t.level<2?4:0),L(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(L(t,t.gzhead.extra.length&255),L(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=$(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=pi;else if(L(t,0),L(t,0),L(t,0),L(t,0),L(t,0),L(t,t.level===9?2:t.strategy>=ke||t.level<2?4:0),L(t,Pr),t.status=xt,V(e),t.pending!==0)return t.last_flush=-1,G}if(t.status===pi){if(t.gzhead.extra){let s=t.pending,o=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+o>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(e.adler=$(e.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=a,V(e),t.pending!==0)return t.last_flush=-1,G;s=0,o-=a}let r=new Uint8Array(t.gzhead.extra);t.pending_buf.set(r.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending+=o,t.gzhead.hcrc&&t.pending>s&&(e.adler=$(e.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=_i}if(t.status===_i){if(t.gzhead.name){let s=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(e.adler=$(e.adler,t.pending_buf,t.pending-s,s)),V(e),t.pending!==0)return t.last_flush=-1,G;s=0}t.gzindex<t.gzhead.name.length?o=t.gzhead.name.charCodeAt(t.gzindex++)&255:o=0,L(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>s&&(e.adler=$(e.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=mi}if(t.status===mi){if(t.gzhead.comment){let s=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(e.adler=$(e.adler,t.pending_buf,t.pending-s,s)),V(e),t.pending!==0)return t.last_flush=-1,G;s=0}t.gzindex<t.gzhead.comment.length?o=t.gzhead.comment.charCodeAt(t.gzindex++)&255:o=0,L(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>s&&(e.adler=$(e.adler,t.pending_buf,t.pending-s,s))}t.status=gi}if(t.status===gi){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(V(e),t.pending!==0))return t.last_flush=-1,G;L(t,e.adler&255),L(t,e.adler>>8&255),e.adler=0}if(t.status=xt,V(e),t.pending!==0)return t.last_flush=-1,G}if(e.avail_in!==0||t.lookahead!==0||i!==yt&&t.status!==Kt){let s=t.level===0?ps(t,i):t.strategy===ke?qr(t,i):t.strategy===Er?Fr(t,i):Yt[t.level].func(t,i);if((s===It||s===qt)&&(t.status=Kt),s===Y||s===It)return e.avail_out===0&&(t.last_flush=-1),G;if(s===Ft&&(i===wr?yr(t):i!==en&&(fi(t,0,0,!1),i===br&&(_t(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),V(e),e.avail_out===0))return t.last_flush=-1,G}return i!==J?G:t.wrap<=0?nn:(t.wrap===2?(L(t,e.adler&255),L(t,e.adler>>8&255),L(t,e.adler>>16&255),L(t,e.adler>>24&255),L(t,e.total_in&255),L(t,e.total_in>>8&255),L(t,e.total_in>>16&255),L(t,e.total_in>>24&255)):($t(t,e.adler>>>16),$t(t,e.adler&65535)),V(e),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?G:nn)},jr=e=>{if(pe(e))return ot;const i=e.state.status;return e.state=null,i===xt?Et(e,kr):G},Vr=(e,i)=>{let t=i.length;if(pe(e))return ot;const n=e.state,s=n.wrap;if(s===2||s===1&&n.status!==Nt||n.lookahead)return ot;if(s===1&&(e.adler=ae(e.adler,i,t,0)),n.wrap=0,t>=n.w_size){s===0&&(_t(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(i.subarray(t-n.w_size,t),0),i=l,t=n.w_size}const o=e.avail_in,r=e.next_in,a=e.input;for(e.avail_in=t,e.next_in=0,e.input=i,Pt(n);n.lookahead>=M;){let l=n.strstart,h=n.lookahead-(M-1);do n.ins_h=wt(n,n.ins_h,n.window[l+M-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--h);n.strstart=l,n.lookahead=M-1,Pt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=M-1,n.match_available=0,e.next_in=r,e.input=a,e.avail_in=o,n.wrap=s,G};var Xr=Kr,Wr=gs,Qr=ms,Jr=_s,ta=Gr,ea=Yr,ia=jr,na=Vr,sa="pako deflate (from Nodeca project)",Wt={deflateInit:Xr,deflateInit2:Wr,deflateReset:Qr,deflateResetKeep:Jr,deflateSetHeader:ta,deflate:ea,deflateEnd:ia,deflateSetDictionary:na,deflateInfo:sa};const oa=(e,i)=>Object.prototype.hasOwnProperty.call(e,i);var ra=function(e){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const t=i.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)oa(t,n)&&(e[n]=t[n])}}return e},aa=e=>{let i=0;for(let n=0,s=e.length;n<s;n++)i+=e[n].length;const t=new Uint8Array(i);for(let n=0,s=0,o=e.length;n<o;n++){let r=e[n];t.set(r,s),s+=r.length}return t},He={assign:ra,flattenChunks:aa};let ys=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ys=!1}const he=new Uint8Array(256);for(let e=0;e<256;e++)he[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;he[254]=he[254]=1;var ha=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let i,t,n,s,o,r=e.length,a=0;for(s=0;s<r;s++)t=e.charCodeAt(s),(t&64512)===55296&&s+1<r&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(i=new Uint8Array(a),o=0,s=0;o<a;s++)t=e.charCodeAt(s),(t&64512)===55296&&s+1<r&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),t<128?i[o++]=t:t<2048?(i[o++]=192|t>>>6,i[o++]=128|t&63):t<65536?(i[o++]=224|t>>>12,i[o++]=128|t>>>6&63,i[o++]=128|t&63):(i[o++]=240|t>>>18,i[o++]=128|t>>>12&63,i[o++]=128|t>>>6&63,i[o++]=128|t&63);return i};const ca=(e,i)=>{if(i<65534&&e.subarray&&ys)return String.fromCharCode.apply(null,e.length===i?e:e.subarray(0,i));let t="";for(let n=0;n<i;n++)t+=String.fromCharCode(e[n]);return t};var la=(e,i)=>{const t=i||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,i));let n,s;const o=new Array(t*2);for(s=0,n=0;n<t;){let r=e[n++];if(r<128){o[s++]=r;continue}let a=he[r];if(a>4){o[s++]=65533,n+=a-1;continue}for(r&=a===2?31:a===3?15:7;a>1&&n<t;)r=r<<6|e[n++]&63,a--;if(a>1){o[s++]=65533;continue}r<65536?o[s++]=r:(r-=65536,o[s++]=55296|r>>10&1023,o[s++]=56320|r&1023)}return ca(o,s)},da=(e,i)=>{i=i||e.length,i>e.length&&(i=e.length);let t=i-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?i:t+he[e[t]]>i?t:i},ce={string2buf:ha,buf2string:la,utf8border:da};function fa(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ws=fa;const bs=Object.prototype.toString,{Z_NO_FLUSH:ua,Z_SYNC_FLUSH:pa,Z_FULL_FLUSH:_a,Z_FINISH:ma,Z_OK:Ne,Z_STREAM_END:ga,Z_DEFAULT_COMPRESSION:ya,Z_DEFAULT_STRATEGY:wa,Z_DEFLATED:ba}=Bt;function _e(e){this.options=He.assign({level:ya,method:ba,chunkSize:16384,windowBits:15,memLevel:8,strategy:wa},e||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ws,this.strm.avail_out=0;let t=Wt.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(t!==Ne)throw new Error(St[t]);if(i.header&&Wt.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=ce.string2buf(i.dictionary):bs.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,t=Wt.deflateSetDictionary(this.strm,n),t!==Ne)throw new Error(St[t]);this._dict_set=!0}}_e.prototype.push=function(e,i){const t=this.strm,n=this.options.chunkSize;let s,o;if(this.ended)return!1;for(i===~~i?o=i:o=i===!0?ma:ua,typeof e=="string"?t.input=ce.string2buf(e):bs.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(o===pa||o===_a)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(s=Wt.deflate(t,o),s===ga)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=Wt.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Ne;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};_e.prototype.onData=function(e){this.chunks.push(e)};_e.prototype.onEnd=function(e){e===Ne&&(this.result=He.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Di(e,i){const t=new _e(i);if(t.push(e,!0),t.err)throw t.msg||St[t.err];return t.result}function ka(e,i){return i=i||{},i.raw=!0,Di(e,i)}function va(e,i){return i=i||{},i.gzip=!0,Di(e,i)}var xa=_e,Ea=Di,Sa=ka,Ia=va,Ta=Bt,Ba={Deflate:xa,deflate:Ea,deflateRaw:Sa,gzip:Ia,constants:Ta};const ve=16209,za=16191;var Ca=function(i,t){let n,s,o,r,a,l,h,c,u,f,d,p,b,g,v,k,x,_,B,q,S,R,D,T;const C=i.state;n=i.next_in,D=i.input,s=n+(i.avail_in-5),o=i.next_out,T=i.output,r=o-(t-i.avail_out),a=o+(i.avail_out-257),l=C.dmax,h=C.wsize,c=C.whave,u=C.wnext,f=C.window,d=C.hold,p=C.bits,b=C.lencode,g=C.distcode,v=(1<<C.lenbits)-1,k=(1<<C.distbits)-1;t:do{p<15&&(d+=D[n++]<<p,p+=8,d+=D[n++]<<p,p+=8),x=b[d&v];e:for(;;){if(_=x>>>24,d>>>=_,p-=_,_=x>>>16&255,_===0)T[o++]=x&65535;else if(_&16){B=x&65535,_&=15,_&&(p<_&&(d+=D[n++]<<p,p+=8),B+=d&(1<<_)-1,d>>>=_,p-=_),p<15&&(d+=D[n++]<<p,p+=8,d+=D[n++]<<p,p+=8),x=g[d&k];i:for(;;){if(_=x>>>24,d>>>=_,p-=_,_=x>>>16&255,_&16){if(q=x&65535,_&=15,p<_&&(d+=D[n++]<<p,p+=8,p<_&&(d+=D[n++]<<p,p+=8)),q+=d&(1<<_)-1,q>l){i.msg="invalid distance too far back",C.mode=ve;break t}if(d>>>=_,p-=_,_=o-r,q>_){if(_=q-_,_>c&&C.sane){i.msg="invalid distance too far back",C.mode=ve;break t}if(S=0,R=f,u===0){if(S+=h-_,_<B){B-=_;do T[o++]=f[S++];while(--_);S=o-q,R=T}}else if(u<_){if(S+=h+u-_,_-=u,_<B){B-=_;do T[o++]=f[S++];while(--_);if(S=0,u<B){_=u,B-=_;do T[o++]=f[S++];while(--_);S=o-q,R=T}}}else if(S+=u-_,_<B){B-=_;do T[o++]=f[S++];while(--_);S=o-q,R=T}for(;B>2;)T[o++]=R[S++],T[o++]=R[S++],T[o++]=R[S++],B-=3;B&&(T[o++]=R[S++],B>1&&(T[o++]=R[S++]))}else{S=o-q;do T[o++]=T[S++],T[o++]=T[S++],T[o++]=T[S++],B-=3;while(B>2);B&&(T[o++]=T[S++],B>1&&(T[o++]=T[S++]))}}else if(_&64){i.msg="invalid distance code",C.mode=ve;break t}else{x=g[(x&65535)+(d&(1<<_)-1)];continue i}break}}else if(_&64)if(_&32){C.mode=za;break t}else{i.msg="invalid literal/length code",C.mode=ve;break t}else{x=b[(x&65535)+(d&(1<<_)-1)];continue e}break}}while(n<s&&o<a);B=p>>3,n-=B,p-=B<<3,d&=(1<<p)-1,i.next_in=n,i.next_out=o,i.avail_in=n<s?5+(s-n):5-(n-s),i.avail_out=o<a?257+(a-o):257-(o-a),C.hold=d,C.bits=p};const Dt=15,on=852,rn=592,an=0,Xe=1,hn=2,Aa=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ma=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Da=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),La=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ra=(e,i,t,n,s,o,r,a)=>{const l=a.bits;let h=0,c=0,u=0,f=0,d=0,p=0,b=0,g=0,v=0,k=0,x,_,B,q,S,R=null,D;const T=new Uint16Array(Dt+1),C=new Uint16Array(Dt+1);let kt=null,Fi,ye,we;for(h=0;h<=Dt;h++)T[h]=0;for(c=0;c<n;c++)T[i[t+c]]++;for(d=l,f=Dt;f>=1&&T[f]===0;f--);if(d>f&&(d=f),f===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<f&&T[u]===0;u++);for(d<u&&(d=u),g=1,h=1;h<=Dt;h++)if(g<<=1,g-=T[h],g<0)return-1;if(g>0&&(e===an||f!==1))return-1;for(C[1]=0,h=1;h<Dt;h++)C[h+1]=C[h]+T[h];for(c=0;c<n;c++)i[t+c]!==0&&(r[C[i[t+c]]++]=c);if(e===an?(R=kt=r,D=20):e===Xe?(R=Aa,kt=Ma,D=257):(R=Da,kt=La,D=0),k=0,c=0,h=u,S=o,p=d,b=0,B=-1,v=1<<d,q=v-1,e===Xe&&v>on||e===hn&&v>rn)return 1;for(;;){Fi=h-b,r[c]+1<D?(ye=0,we=r[c]):r[c]>=D?(ye=kt[r[c]-D],we=R[r[c]-D]):(ye=96,we=0),x=1<<h-b,_=1<<p,u=_;do _-=x,s[S+(k>>b)+_]=Fi<<24|ye<<16|we|0;while(_!==0);for(x=1<<h-1;k&x;)x>>=1;if(x!==0?(k&=x-1,k+=x):k=0,c++,--T[h]===0){if(h===f)break;h=i[t+r[c]]}if(h>d&&(k&q)!==B){for(b===0&&(b=d),S+=u,p=h-b,g=1<<p;p+b<f&&(g-=T[p+b],!(g<=0));)p++,g<<=1;if(v+=1<<p,e===Xe&&v>on||e===hn&&v>rn)return 1;B=k&q,s[B]=d<<24|p<<16|S-o|0}}return k!==0&&(s[S+k]=h-b<<24|64<<16|0),a.bits=d,0};var Qt=Ra;const Oa=0,ks=1,vs=2,{Z_FINISH:cn,Z_BLOCK:Na,Z_TREES:xe,Z_OK:Tt,Z_STREAM_END:Pa,Z_NEED_DICT:Ua,Z_STREAM_ERROR:tt,Z_DATA_ERROR:xs,Z_MEM_ERROR:Es,Z_BUF_ERROR:Ha,Z_DEFLATED:ln}=Bt,Fe=16180,dn=16181,fn=16182,un=16183,pn=16184,_n=16185,mn=16186,gn=16187,yn=16188,wn=16189,Pe=16190,lt=16191,We=16192,bn=16193,Qe=16194,kn=16195,vn=16196,xn=16197,En=16198,Ee=16199,Se=16200,Sn=16201,In=16202,Tn=16203,Bn=16204,zn=16205,Je=16206,Cn=16207,An=16208,P=16209,Ss=16210,Is=16211,Fa=852,qa=592,Za=15,$a=Za,Mn=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function Ga(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const zt=e=>{if(!e)return 1;const i=e.state;return!i||i.strm!==e||i.mode<Fe||i.mode>Is?1:0},Ts=e=>{if(zt(e))return tt;const i=e.state;return e.total_in=e.total_out=i.total=0,e.msg="",i.wrap&&(e.adler=i.wrap&1),i.mode=Fe,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(Fa),i.distcode=i.distdyn=new Int32Array(qa),i.sane=1,i.back=-1,Tt},Bs=e=>{if(zt(e))return tt;const i=e.state;return i.wsize=0,i.whave=0,i.wnext=0,Ts(e)},zs=(e,i)=>{let t;if(zt(e))return tt;const n=e.state;return i<0?(t=0,i=-i):(t=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?tt:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=t,n.wbits=i,Bs(e))},Cs=(e,i)=>{if(!e)return tt;const t=new Ga;e.state=t,t.strm=e,t.window=null,t.mode=Fe;const n=zs(e,i);return n!==Tt&&(e.state=null),n},Ka=e=>Cs(e,$a);let Dn=!0,ti,ei;const Ya=e=>{if(Dn){ti=new Int32Array(512),ei=new Int32Array(32);let i=0;for(;i<144;)e.lens[i++]=8;for(;i<256;)e.lens[i++]=9;for(;i<280;)e.lens[i++]=7;for(;i<288;)e.lens[i++]=8;for(Qt(ks,e.lens,0,288,ti,0,e.work,{bits:9}),i=0;i<32;)e.lens[i++]=5;Qt(vs,e.lens,0,32,ei,0,e.work,{bits:5}),Dn=!1}e.lencode=ti,e.lenbits=9,e.distcode=ei,e.distbits=5},As=(e,i,t,n)=>{let s;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(i.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>n&&(s=n),o.window.set(i.subarray(t-n,t-n+s),o.wnext),n-=s,n?(o.window.set(i.subarray(t-n,t),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0},ja=(e,i)=>{let t,n,s,o,r,a,l,h,c,u,f,d,p,b,g=0,v,k,x,_,B,q,S,R;const D=new Uint8Array(4);let T,C;const kt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(zt(e)||!e.output||!e.input&&e.avail_in!==0)return tt;t=e.state,t.mode===lt&&(t.mode=We),r=e.next_out,s=e.output,l=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,h=t.hold,c=t.bits,u=a,f=l,R=Tt;t:for(;;)switch(t.mode){case Fe:if(t.wrap===0){t.mode=We;break}for(;c<16;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(t.wrap&2&&h===35615){t.wbits===0&&(t.wbits=15),t.check=0,D[0]=h&255,D[1]=h>>>8&255,t.check=$(t.check,D,2,0),h=0,c=0,t.mode=dn;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((h&255)<<8)+(h>>8))%31){e.msg="incorrect header check",t.mode=P;break}if((h&15)!==ln){e.msg="unknown compression method",t.mode=P;break}if(h>>>=4,c-=4,S=(h&15)+8,t.wbits===0&&(t.wbits=S),S>15||S>t.wbits){e.msg="invalid window size",t.mode=P;break}t.dmax=1<<t.wbits,t.flags=0,e.adler=t.check=1,t.mode=h&512?wn:lt,h=0,c=0;break;case dn:for(;c<16;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(t.flags=h,(t.flags&255)!==ln){e.msg="unknown compression method",t.mode=P;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=P;break}t.head&&(t.head.text=h>>8&1),t.flags&512&&t.wrap&4&&(D[0]=h&255,D[1]=h>>>8&255,t.check=$(t.check,D,2,0)),h=0,c=0,t.mode=fn;case fn:for(;c<32;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}t.head&&(t.head.time=h),t.flags&512&&t.wrap&4&&(D[0]=h&255,D[1]=h>>>8&255,D[2]=h>>>16&255,D[3]=h>>>24&255,t.check=$(t.check,D,4,0)),h=0,c=0,t.mode=un;case un:for(;c<16;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}t.head&&(t.head.xflags=h&255,t.head.os=h>>8),t.flags&512&&t.wrap&4&&(D[0]=h&255,D[1]=h>>>8&255,t.check=$(t.check,D,2,0)),h=0,c=0,t.mode=pn;case pn:if(t.flags&1024){for(;c<16;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}t.length=h,t.head&&(t.head.extra_len=h),t.flags&512&&t.wrap&4&&(D[0]=h&255,D[1]=h>>>8&255,t.check=$(t.check,D,2,0)),h=0,c=0}else t.head&&(t.head.extra=null);t.mode=_n;case _n:if(t.flags&1024&&(d=t.length,d>a&&(d=a),d&&(t.head&&(S=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(o,o+d),S)),t.flags&512&&t.wrap&4&&(t.check=$(t.check,n,d,o)),a-=d,o+=d,t.length-=d),t.length))break t;t.length=0,t.mode=mn;case mn:if(t.flags&2048){if(a===0)break t;d=0;do S=n[o+d++],t.head&&S&&t.length<65536&&(t.head.name+=String.fromCharCode(S));while(S&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=$(t.check,n,d,o)),a-=d,o+=d,S)break t}else t.head&&(t.head.name=null);t.length=0,t.mode=gn;case gn:if(t.flags&4096){if(a===0)break t;d=0;do S=n[o+d++],t.head&&S&&t.length<65536&&(t.head.comment+=String.fromCharCode(S));while(S&&d<a);if(t.flags&512&&t.wrap&4&&(t.check=$(t.check,n,d,o)),a-=d,o+=d,S)break t}else t.head&&(t.head.comment=null);t.mode=yn;case yn:if(t.flags&512){for(;c<16;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(t.wrap&4&&h!==(t.check&65535)){e.msg="header crc mismatch",t.mode=P;break}h=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=lt;break;case wn:for(;c<32;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}e.adler=t.check=Mn(h),h=0,c=0,t.mode=Pe;case Pe:if(t.havedict===0)return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,t.hold=h,t.bits=c,Ua;e.adler=t.check=1,t.mode=lt;case lt:if(i===Na||i===xe)break t;case We:if(t.last){h>>>=c&7,c-=c&7,t.mode=Je;break}for(;c<3;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}switch(t.last=h&1,h>>>=1,c-=1,h&3){case 0:t.mode=bn;break;case 1:if(Ya(t),t.mode=Ee,i===xe){h>>>=2,c-=2;break t}break;case 2:t.mode=vn;break;case 3:e.msg="invalid block type",t.mode=P}h>>>=2,c-=2;break;case bn:for(h>>>=c&7,c-=c&7;c<32;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if((h&65535)!==(h>>>16^65535)){e.msg="invalid stored block lengths",t.mode=P;break}if(t.length=h&65535,h=0,c=0,t.mode=Qe,i===xe)break t;case Qe:t.mode=kn;case kn:if(d=t.length,d){if(d>a&&(d=a),d>l&&(d=l),d===0)break t;s.set(n.subarray(o,o+d),r),a-=d,o+=d,l-=d,r+=d,t.length-=d;break}t.mode=lt;break;case vn:for(;c<14;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(t.nlen=(h&31)+257,h>>>=5,c-=5,t.ndist=(h&31)+1,h>>>=5,c-=5,t.ncode=(h&15)+4,h>>>=4,c-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=P;break}t.have=0,t.mode=xn;case xn:for(;t.have<t.ncode;){for(;c<3;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}t.lens[kt[t.have++]]=h&7,h>>>=3,c-=3}for(;t.have<19;)t.lens[kt[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,T={bits:t.lenbits},R=Qt(Oa,t.lens,0,19,t.lencode,0,t.work,T),t.lenbits=T.bits,R){e.msg="invalid code lengths set",t.mode=P;break}t.have=0,t.mode=En;case En:for(;t.have<t.nlen+t.ndist;){for(;g=t.lencode[h&(1<<t.lenbits)-1],v=g>>>24,k=g>>>16&255,x=g&65535,!(v<=c);){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(x<16)h>>>=v,c-=v,t.lens[t.have++]=x;else{if(x===16){for(C=v+2;c<C;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(h>>>=v,c-=v,t.have===0){e.msg="invalid bit length repeat",t.mode=P;break}S=t.lens[t.have-1],d=3+(h&3),h>>>=2,c-=2}else if(x===17){for(C=v+3;c<C;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}h>>>=v,c-=v,S=0,d=3+(h&7),h>>>=3,c-=3}else{for(C=v+7;c<C;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}h>>>=v,c-=v,S=0,d=11+(h&127),h>>>=7,c-=7}if(t.have+d>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=P;break}for(;d--;)t.lens[t.have++]=S}}if(t.mode===P)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=P;break}if(t.lenbits=9,T={bits:t.lenbits},R=Qt(ks,t.lens,0,t.nlen,t.lencode,0,t.work,T),t.lenbits=T.bits,R){e.msg="invalid literal/lengths set",t.mode=P;break}if(t.distbits=6,t.distcode=t.distdyn,T={bits:t.distbits},R=Qt(vs,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,T),t.distbits=T.bits,R){e.msg="invalid distances set",t.mode=P;break}if(t.mode=Ee,i===xe)break t;case Ee:t.mode=Se;case Se:if(a>=6&&l>=258){e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,t.hold=h,t.bits=c,Ca(e,f),r=e.next_out,s=e.output,l=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,h=t.hold,c=t.bits,t.mode===lt&&(t.back=-1);break}for(t.back=0;g=t.lencode[h&(1<<t.lenbits)-1],v=g>>>24,k=g>>>16&255,x=g&65535,!(v<=c);){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(k&&!(k&240)){for(_=v,B=k,q=x;g=t.lencode[q+((h&(1<<_+B)-1)>>_)],v=g>>>24,k=g>>>16&255,x=g&65535,!(_+v<=c);){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}h>>>=_,c-=_,t.back+=_}if(h>>>=v,c-=v,t.back+=v,t.length=x,k===0){t.mode=zn;break}if(k&32){t.back=-1,t.mode=lt;break}if(k&64){e.msg="invalid literal/length code",t.mode=P;break}t.extra=k&15,t.mode=Sn;case Sn:if(t.extra){for(C=t.extra;c<C;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}t.length+=h&(1<<t.extra)-1,h>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=In;case In:for(;g=t.distcode[h&(1<<t.distbits)-1],v=g>>>24,k=g>>>16&255,x=g&65535,!(v<=c);){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(!(k&240)){for(_=v,B=k,q=x;g=t.distcode[q+((h&(1<<_+B)-1)>>_)],v=g>>>24,k=g>>>16&255,x=g&65535,!(_+v<=c);){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}h>>>=_,c-=_,t.back+=_}if(h>>>=v,c-=v,t.back+=v,k&64){e.msg="invalid distance code",t.mode=P;break}t.offset=x,t.extra=k&15,t.mode=Tn;case Tn:if(t.extra){for(C=t.extra;c<C;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}t.offset+=h&(1<<t.extra)-1,h>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=P;break}t.mode=Bn;case Bn:if(l===0)break t;if(d=f-l,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=P;break}d>t.wnext?(d-=t.wnext,p=t.wsize-d):p=t.wnext-d,d>t.length&&(d=t.length),b=t.window}else b=s,p=r-t.offset,d=t.length;d>l&&(d=l),l-=d,t.length-=d;do s[r++]=b[p++];while(--d);t.length===0&&(t.mode=Se);break;case zn:if(l===0)break t;s[r++]=t.length,l--,t.mode=Se;break;case Je:if(t.wrap){for(;c<32;){if(a===0)break t;a--,h|=n[o++]<<c,c+=8}if(f-=l,e.total_out+=f,t.total+=f,t.wrap&4&&f&&(e.adler=t.check=t.flags?$(t.check,s,f,r-f):ae(t.check,s,f,r-f)),f=l,t.wrap&4&&(t.flags?h:Mn(h))!==t.check){e.msg="incorrect data check",t.mode=P;break}h=0,c=0}t.mode=Cn;case Cn:if(t.wrap&&t.flags){for(;c<32;){if(a===0)break t;a--,h+=n[o++]<<c,c+=8}if(t.wrap&4&&h!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=P;break}h=0,c=0}t.mode=An;case An:R=Pa;break t;case P:R=xs;break t;case Ss:return Es;case Is:default:return tt}return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,t.hold=h,t.bits=c,(t.wsize||f!==e.avail_out&&t.mode<P&&(t.mode<Je||i!==cn))&&As(e,e.output,e.next_out,f-e.avail_out),u-=e.avail_in,f-=e.avail_out,e.total_in+=u,e.total_out+=f,t.total+=f,t.wrap&4&&f&&(e.adler=t.check=t.flags?$(t.check,s,f,e.next_out-f):ae(t.check,s,f,e.next_out-f)),e.data_type=t.bits+(t.last?64:0)+(t.mode===lt?128:0)+(t.mode===Ee||t.mode===Qe?256:0),(u===0&&f===0||i===cn)&&R===Tt&&(R=Ha),R},Va=e=>{if(zt(e))return tt;let i=e.state;return i.window&&(i.window=null),e.state=null,Tt},Xa=(e,i)=>{if(zt(e))return tt;const t=e.state;return t.wrap&2?(t.head=i,i.done=!1,Tt):tt},Wa=(e,i)=>{const t=i.length;let n,s,o;return zt(e)||(n=e.state,n.wrap!==0&&n.mode!==Pe)?tt:n.mode===Pe&&(s=1,s=ae(s,i,t,0),s!==n.check)?xs:(o=As(e,i,t,t),o?(n.mode=Ss,Es):(n.havedict=1,Tt))};var Qa=Bs,Ja=zs,th=Ts,eh=Ka,ih=Cs,nh=ja,sh=Va,oh=Xa,rh=Wa,ah="pako inflate (from Nodeca project)",ut={inflateReset:Qa,inflateReset2:Ja,inflateResetKeep:th,inflateInit:eh,inflateInit2:ih,inflate:nh,inflateEnd:sh,inflateGetHeader:oh,inflateSetDictionary:rh,inflateInfo:ah};function hh(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ch=hh;const Ms=Object.prototype.toString,{Z_NO_FLUSH:lh,Z_FINISH:dh,Z_OK:le,Z_STREAM_END:ii,Z_NEED_DICT:ni,Z_STREAM_ERROR:fh,Z_DATA_ERROR:Ln,Z_MEM_ERROR:uh}=Bt;function me(e){this.options=He.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(e&&e.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15||(i.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ws,this.strm.avail_out=0;let t=ut.inflateInit2(this.strm,i.windowBits);if(t!==le)throw new Error(St[t]);if(this.header=new ch,ut.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=ce.string2buf(i.dictionary):Ms.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(t=ut.inflateSetDictionary(this.strm,i.dictionary),t!==le)))throw new Error(St[t])}me.prototype.push=function(e,i){const t=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?dh:lh,Ms.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),o=ut.inflate(t,r),o===ni&&s&&(o=ut.inflateSetDictionary(t,s),o===le?o=ut.inflate(t,r):o===Ln&&(o=ni));t.avail_in>0&&o===ii&&t.state.wrap>0&&e[t.next_in]!==0;)ut.inflateReset(t),o=ut.inflate(t,r);switch(o){case fh:case Ln:case ni:case uh:return this.onEnd(o),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||o===ii))if(this.options.to==="string"){let l=ce.utf8border(t.output,t.next_out),h=t.next_out-l,c=ce.buf2string(t.output,l);t.next_out=h,t.avail_out=n-h,h&&t.output.set(t.output.subarray(l,l+h),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===le&&a===0)){if(o===ii)return o=ut.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};me.prototype.onData=function(e){this.chunks.push(e)};me.prototype.onEnd=function(e){e===le&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=He.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Li(e,i){const t=new me(i);if(t.push(e),t.err)throw t.msg||St[t.err];return t.result}function ph(e,i){return i=i||{},i.raw=!0,Li(e,i)}var _h=me,mh=Li,gh=ph,yh=Li,wh=Bt,bh={Inflate:_h,inflate:mh,inflateRaw:gh,ungzip:yh,constants:wh};const{Deflate:kh,deflate:vh,deflateRaw:xh,gzip:Eh}=Ba,{Inflate:Sh,inflate:Ih,inflateRaw:Th,ungzip:Bh}=bh;var zh=kh,Ch=vh,Ah=xh,Mh=Eh,Dh=Sh,Lh=Ih,Rh=Th,Oh=Bh,Nh=Bt,Ph={Deflate:zh,deflate:Ch,deflateRaw:Ah,gzip:Mh,Inflate:Dh,inflate:Lh,inflateRaw:Rh,ungzip:Oh,constants:Nh};class Uh{constructor(i){m(this,"m_w",123456789);m(this,"m_z",987654321);m(this,"mask",4294967295);this.m_w=123456789+i&this.mask,this.m_z=987654321-i&this.mask}random(){this.m_z=36969*(this.m_z&65535)+(this.m_z>>16)&this.mask,this.m_w=18e3*(this.m_w&65535)+(this.m_w>>16)&this.mask;let i=(this.m_z<<16)+(this.m_w&65535)>>>0;return i/=4294967296,i}}const K=class K extends st{constructor(t,n,s){super();m(this,"meshs");m(this,"activeLights",[]);this.params=n,this.rng=new Uh(this.params.seed),this.base=new Yi(t,n,s);const o=Object.getOwnPropertyNames(K.prototype);Object.getOwnPropertyNames(Yi.prototype).forEach(r=>{o.includes(r)||(this[r]=this.base[r].bind(this))}),Object.keys(this.base).forEach(r=>{this[r]=this.base[r]})}addBlock(t,n,s,o,r){this.getBlock(t,n,s).id===E.empty.id&&(this.setBlockId(t,n,s,o),this.setBlockDirection(t,n,s,r),this.addBlockInstance(t,n,s),this.dataStore.set(this.position.x,this.position.z,this.data))}removeBlock(t,n,s){const o=this.getBlock(t,n,s);o&&o.id!==E.empty.id&&(this.deleteBlockInstance(t,n,s),this.setBlockId(t,n,s,E.empty.id),this.dataStore.set(this.position.x,this.position.z,this.data),this.activeLights=this.activeLights.filter(r=>Math.abs(r.position.x-t)<1&&Math.abs(r.position.y-n)<1&&Math.abs(r.position.z-s)<1?(this.remove(r),!1):!0))}deleteBlockInstance(t,n,s){const o=this.getBlock(t,n,s);if(o.id===E.empty.id||o.instanceId===null)return;const r=this.children.find(c=>c.name===o.id),a=o.instanceId,l=new ci;r.getMatrixAt(r.count-1,l);const h=new I;h.applyMatrix4(l),this.setBlockInstanceId(h.x,Math.round(h.y),h.z,a),r.setMatrixAt(a,l),r.count--,r.instanceMatrix.needsUpdate=!0,r.computeBoundingSphere(),this.setBlockInstanceId(t,n,s,null)}generate(t=null){var n;if(this.dataStore.contains(this.position.x,this.position.z))this.data=this.dataStore.get(this.position.x,this.position.z),this.generateMesh();else if(t&&t.getSocket())(n=t.getSocket())==null||n.emit("getChunkData",{x:this.position.x/this.chunkSize,z:this.position.z/this.chunkSize},s=>{const o=Ph.inflate(s,{to:"string"}),r=JSON.parse(o);console.log(r),this.data=r.data,this.biomes=r.biomes,this.dataStore.set(this.position.x,this.position.z,this.data),this.generateMesh()});else{const s=new Worker(new URL("/minecraft-threejs/assets/chunkWorker-Dmbb01nE.js",import.meta.url),{type:"module"});s.onmessage=o=>{const{data:r,biomes:a}=o.data;this.biomes=a,this.data=r,this.dataStore.set(this.position.x,this.position.z,this.data),this.generateMesh(),s.terminate()},s.onerror=o=>{console.error(o),s.terminate()},s.onmessageerror=o=>{console.error("Message error in Worker:",o)},s.postMessage({chunkSize:this.chunkSize,chunkHeight:this.height,params:this.params,position:this.position,rng:this.rng})}}generateMesh(){const t=this.chunkSize*this.chunkSize*40,n={},s=K._addBlockInstanceMatrix,o=K._addBlockInstanceDirection,r=K._addBlockInstanceSize;Object.values(E).filter(a=>a.id!==E.empty.id&&a.type==="block").forEach(a=>{a.geometry.computeBoundingBox();const l=new ho(a.geometry,a.material,t);l.name=a.id,l.count=0,l.castShadow=!0,l.receiveShadow=!0,n[a.id]=l});for(let a=0;a<this.chunkSize;a++)for(let l=0;l<this.chunkSize;l++)for(let h=0;h<this.height;h++){const c=this.getBlock(a,h,l);if(!this.isBlockObscured(a,h,l)&&c&&c.id!==E.empty.id){if(O(c.id).geometry.boundingBox.getSize(r),c.direction){o.set(c.direction.x,c.direction.y,c.direction.z);const b=K.getQuaternionFromDirection(o);s.compose(new I(a,h,l),b,new I(1,1,1))}const f=(1-r.y)/2;s.setPosition(a,h-f,l),n[c.id].setMatrixAt(n[c.id].count,s);const p=n[c.id].count;this.setBlockInstanceId(a,h,l,p),n[c.id].count++,c.id==E.torch.id&&this.addLight(a,h,l)}}this.meshs=n,this.add(...Object.values(n)),this.updateBoundingSpheres()}disposeInstances(){this.traverse(t=>{t.dispose&&t.dispose()}),this.clear()}isBlockObscured(t,n,s){const o=this.getBlock(t,n+1,s),r=!o||o.id===E.empty.id||O(o.id).transparent,a=this.getBlock(t,n-1,s),l=!a||a.id===E.empty.id||O(a.id).transparent,h=this.getBlock(t+1,n,s),c=!h||h.id===E.empty.id||O(h.id).transparent,u=this.getBlock(t-1,n,s),f=!u||u.id===E.empty.id||O(u.id).transparent,d=this.getBlock(t,n,s+1),p=!d||d.id===E.empty.id||O(d.id).transparent,b=this.getBlock(t,n,s-1),g=!b||b.id===E.empty.id||O(b.id).transparent;return this.getBlock(t,n,s).id===9&&o.id===9?!0:!(r||l||c||f||p||g)}setBlockInstanceId(t,n,s,o){this.inBounds(t,n,s)&&(this.data[t][n][s].instanceId=o)}revealBlock(t,n,s){const o=this.worldToChunkCoords(t,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.addBlockInstance(o.block.x,o.block.y,o.block.z)}addBlockInstance(t,n,s){var p;const o=this.getBlock(t,n,s);if(!o||o.id===E.empty.id||o.instanceId!==null&&o.instanceId!==-1)return;const r=this.meshs[o.id];console.log(r);const a=r.count++;this.setBlockInstanceId(t,n,s,a);const l=K._addBlockInstanceMatrix,h=K._addBlockInstanceDirection,c=K._addBlockInstanceSize;h.set(o.direction.x,o.direction.y,o.direction.z);const u=K.getQuaternionFromDirection(h);l.compose(new I(t,n,s),u,new I(1,1,1)),((p=this.meshs[o.id])==null?void 0:p.geometry).boundingBox.getSize(c);const d=(1-c.y)/2;l.setPosition(t,n-d,s),r.setMatrixAt(a,l),r.instanceMatrix.needsUpdate=!0,r.computeBoundingSphere(),o.id==E.torch.id&&this.addLight(t,n,s)}addLight(t,n,s){if(this.activeLights||(this.activeLights=[]),this.activeLights.length>=8)return;const o=new co(16776928,2,14,.1);o.position.set(t,n+.1,s),o.castShadow=!1,this.add(o),this.activeLights.push(o)}static getQuaternionFromDirection(t){const n=K._addBlockInstanceQuaternion;return n.identity(),t.x===1&&t.y===0&&t.z===0?n.setFromEuler(new dt(0,Math.PI/2,0)):t.x===-1&&t.y===0&&t.z===0?n.setFromEuler(new dt(0,-Math.PI/2,0)):t.x===0&&t.y===0&&t.z===1?n.setFromEuler(new dt(0,0,0)):t.x===0&&t.y===0&&t.z===-1?n.setFromEuler(new dt(0,Math.PI,0)):t.x===0&&t.y===1&&t.z===0?n.setFromEuler(new dt(-Math.PI/2,0,0)):t.x===0&&t.y===-1&&t.z===0&&n.setFromEuler(new dt(Math.PI/2,0,0)),n}updateBoundingSpheres(){for(const t of Object.values(this.meshs))t.computeBoundingSphere()}};m(K,"_addBlockInstanceMatrix",new ci),m(K,"_addBlockInstanceQuaternion",new Yn),m(K,"_addBlockInstanceDirection",new I),m(K,"_addBlockInstanceSize",new I);let wi=K;const Lt=class Lt extends st{constructor(){super();m(this,"asyncLoading",!1);this.base=new Ki;const t=Object.getOwnPropertyNames(Lt.prototype);Object.getOwnPropertyNames(Ki.prototype).forEach(n=>{t.includes(n)||(this[n]=this.base[n].bind(this))}),Object.keys(this.base).forEach(n=>{this[n]=this.base[n]})}generate(){this.clear(),this.dataStore.clear();for(let t=-this.drawDistance;t<=this.drawDistance;t++)for(let n=-this.drawDistance;n<=this.drawDistance;n++)this.generateChunk()}generateChunk(t,n){const s=new wi(this.chunkSize,this.params,this.dataStore);s.position.set(t*this.chunkSize.width,0,n*this.chunkSize.width),s.userData={x:t,z:n},this.asyncLoading?requestIdleCallback(()=>s.generate(this.client),{timeout:2e3}):s.generate(this.client),this.add(s)}getChunk(t,n){return this.children.find(s=>s.userData.x===t&&s.userData.z===n)}addBlock(t,n,s,o,r){const a=this.worldToChunkCoords(t,n,s),l=this.getChunk(a.chunk.x,a.chunk.z);if(!l)return;if(l.addBlock(a.block.x,a.block.y,a.block.z,o,r),!O(o).transparent)for(const[c,u,f]of Lt.neighborOffsets)this.hideBlock(t+c,n+u,s+f)}removeBlock(t,n,s){const o=this.worldToChunkCoords(t,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);if(!(!r||o.block.y===0)){r.removeBlock(o.block.x,o.block.y,o.block.z);for(const[a,l,h]of Lt.neighborOffsets)this.revealBlock(t+a,n+l,s+h)}}hideBlock(t,n,s){const o=this.worldToChunkCoords(t,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.isBlockObscured(o.block.x,o.block.y,o.block.z)&&r.deleteBlockInstance(o.block.x,o.block.y,o.block.z)}setClient(t){this.client=t}update(t){const n=this.getVisibleChunks(t),s=this.getChunksToAdd(n);this.removeUnusedChunks(n);for(const o of s)this.generateChunk(o.x,o.z)}getVisibleChunks(t){const n=[],s=this.worldToChunkCoords(t.position.x,t.position.y,t.position.z),o=s.chunk.x,r=s.chunk.z;for(let a=o-this.drawDistance;a<=o+this.drawDistance;a++)for(let l=r-this.drawDistance;l<=r+this.drawDistance;l++)n.push({x:a,z:l});return n}getChunksToAdd(t){return t.filter(n=>!this.children.map(o=>o.userData).find(({x:o,z:r})=>n.x===o&&n.z===r))}removeUnusedChunks(t){const n=this.children.filter(s=>{const{x:o,z:r}=s.userData;return!t.find(l=>l.x===o&&l.z===r)});for(const s of n)s.disposeInstances(),this.remove(s)}revealBlock(t,n,s){const o=this.worldToChunkCoords(t,n,s),r=this.getChunk(o.chunk.x,o.chunk.z);r&&r.addBlockInstance(o.block.x,o.block.y,o.block.z)}getLoadedChunks(){return this.children}};m(Lt,"neighborOffsets",[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]]);let bi=Lt;const Hh=new Re;function z(e){const i=Hh.load(e);return i.colorSpace=$n,i.magFilter=ee,i.minFilter=ee,i}const w={pig_head_front:z("images/mob/pig/pig_head_front.png"),pig_head_right:z("images/mob/pig/pig_head_right.png"),pig_head_left:z("images/mob/pig/pig_head_left.png"),pig_head_top:z("images/mob/pig/pig_head_top.png"),pig_feet:z("images/mob/pig/pig_feet_side.png"),pig_body_back:z("images/mob/pig/pig_body_back.png"),pig_body_side:z("images/mob/pig/pig_body_side.png"),pig_body_right:z("images/mob/pig/pig_body_right.png"),pig_noise_front:z("images/mob/pig/pig_noise_front.png"),steve_head_front:z("images/player/steve_head_front.png"),steve_head_back:z("images/player/steve_head_back.png"),steve_head_right:z("images/player/steve_head_right.png"),steve_head_left:z("images/player/steve_head_left.png"),steve_head_top:z("images/player/steve_head_top.png"),steve_head_bottom:z("images/player/steve_head_bottom.png"),steve_body_top:z("images/player/steve_body_top.png"),steve_body_front:z("images/player/steve_body_front.png"),steve_body_back:z("images/player/steve_body_back.png"),steve_body_right:z("images/player/steve_body_right.png"),steve_body_left:z("images/player/steve_body_left.png"),steve_arm_top:z("images/player/steve_arm_top.png"),steve_arm_bottom:z("images/player/steve_arm_bottom.png"),steve_arm_front:z("images/player/steve_arm_front.png"),steve_arm_right:z("images/player/steve_arm_right.png"),steve_arm_left:z("images/player/steve_arm_left.png"),steve_arm_back:z("images/player/steve_arm_back.png"),steve_leg_front:z("images/player/steve_leg_front.png"),steve_leg_back:z("images/player/steve_leg_back.png"),steve_leg_right:z("images/player/steve_leg_right.png"),steve_leg_left:z("images/player/steve_leg_left.png"),cow_head_front:z("images/mob/cow/cow_head_front.png"),cow_head_top:z("images/mob/cow/cow_head_top.png"),cow_head_left:z("images/mob/cow/cow_head_left.png"),cow_head_right:z("images/mob/cow/cow_head_right.png"),cow_body_left:z("images/mob/cow/cow_body_left.png"),cow_body_right:z("images/mob/cow/cow_body_right.png"),cow_body_top:z("images/mob/cow/cow_body_top.png"),cow_body_bottom:z("images/mob/cow/cow_body_bottom.png")},X={pig:{id:1,name:"pig",head:{material:[new y({map:w.pig_head_left}),new y({map:w.pig_head_right}),new y({map:w.pig_head_top}),new y({map:w.pig_body_side}),new y({map:w.pig_head_front}),new y({map:w.pig_body_side})]},body:{material:[new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_body_right}),new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_body_back})]},feet:{material:[new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet})]},noise:{material:[new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_noise_front}),new y({map:w.pig_body_side})]}},cow:{id:2,name:"cow",head:{material:[new y({map:w.cow_head_left}),new y({map:w.pig_head_right}),new y({map:w.cow_head_top}),new y({map:w.pig_body_side}),new y({map:w.cow_head_front}),new y({map:w.pig_body_side})]},body:{material:[new y({map:w.cow_head_left}),new y({map:w.cow_head_right}),new y({map:w.cow_head_top}),new y({map:w.cow_head_bottom}),new y({map:w.pig_body_side}),new y({map:w.pig_body_back})]},feet:{material:[new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.pig_feet})]},noise:{material:[new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_body_side}),new y({map:w.pig_noise_front}),new y({map:w.pig_body_side})]}},steve:{id:1,name:"pig",head:{material:[new y({map:w.steve_head_left}),new y({map:w.steve_head_right}),new y({map:w.steve_head_top}),new y({map:w.steve_head_bottom}),new y({map:w.steve_head_front}),new y({map:w.steve_head_back})]},body:{material:[new y({map:w.steve_body_right}),new y({map:w.steve_body_left}),new y({map:w.steve_body_top}),new y({map:w.pig_body_side}),new y({map:w.steve_body_front}),new y({map:w.steve_body_back})]},leg:{material:[new y({map:w.steve_leg_right}),new y({map:w.steve_leg_left}),new y({map:w.pig_feet}),new y({map:w.pig_feet}),new y({map:w.steve_leg_front}),new y({map:w.steve_leg_back})]},arm:{material:[new y({map:w.steve_arm_right}),new y({map:w.steve_arm_left}),new y({map:w.steve_arm_top}),new y({map:w.steve_arm_bottom}),new y({map:w.steve_arm_front}),new y({map:w.steve_arm_back})]}}};class Fh extends fe{constructor(t,n){super(t,n);m(this,"mesh",new st);m(this,"radius",2);m(this,"height",1);m(this,"path",[]);m(this,"pathIndex",0);m(this,"repathCooldown",0);m(this,"stuckTime",60);m(this,"lastPos",new I);m(this,"health",10);const s=new H(.9,.7,1.6),o=new H(.7,.7,.7),r=new H(.32,.25,.1),a=new H(.4,.5,.4),l=new N(s,X.pig.body.material);l.position.set(0,.6,0),l.userData.entity=this,this.mesh.add(l);const h=new N(o,X.pig.head.material);h.position.set(0,.8,1),h.userData.entity=this,this.mesh.add(h);const c=new N(r,X.pig.noise.material);c.position.set(0,.7,1.4),c.userData.entity=this,this.mesh.add(c);for(let u=0;u<4;u++){const f=new N(a,X.pig.feet.material);f.userData.entity=this,f.position.set(u<2?-.25:.25,0,u%2===0?-.7:.6),f.isLeg=!0,this.mesh.add(f)}this.BOUNDARY={minX:-50,maxX:50,minZ:-50,maxZ:50},this.target=this.getRandomTarget(),this.pigVelocity=new I(0,0,0),this.mesh.position.copy(this.position),this.lastPos.copy(this.mesh.position),this.hitTime=0,this.originalMaterials=this.mesh.children.map(u=>u.material),this.redMaterial=new te({color:16711680}),this.redMaterial.needsUpdate=!0}getRandomTarget(){const t=Math.random()*(this.BOUNDARY.maxX-this.BOUNDARY.minX)+this.BOUNDARY.minX,n=Math.random()*(this.BOUNDARY.maxZ-this.BOUNDARY.minZ)+this.BOUNDARY.minZ,s=this.getGroundYAt(Math.round(t),Math.round(n),Math.round(this.mesh.position.y));return new I(t,s,n)}hit(){console.log("hit pig"),this.hitTime=.3,this.runTime=3,this.pigVelocity.y+=.2,this.mesh.children.forEach((t,n)=>{t.material&&(t.material=this.redMaterial)}),this.target=this.getRandomTarget(),this.audioManager.playBlockSound("pig","hurt"),this.path=[],this.pathIndex=0,this.health-=.5,this.health<=0&&this.world.removeEntity(this)}update(t){var l,h;let n=0;this.lastPos.distanceToSquared(this.mesh.position)<4e-4?this.stuckTime+=t:(this.stuckTime=0,this.lastPos.copy(this.mesh.position)),this.repathCooldown>0&&(this.repathCooldown-=t),this.broadPhase(),this.hitTime>0&&(n=2,this.hitTime-=t,this.hitTime<=0&&this.mesh.children.forEach((c,u)=>{this.originalMaterials[u]&&(c.material=this.originalMaterials[u])})),this.runTime>0&&(this.runTime-=t,n=3);const s=this.mesh.position.distanceTo(this.target);if((this.path.length===0&&s>2||this.stuckTime>.75)&&this.repathCooldown<=0){const c=new I(Math.round(this.mesh.position.x),Math.round(this.mesh.position.y),Math.round(this.mesh.position.z)),u=new I(Math.round(this.target.x),Math.round(this.target.y),Math.round(this.target.z)),f=this.findPath(c,u,3e3,32);f&&f.length?(this.path=f,this.pathIndex=0):this.target=this.getRandomTarget(),this.repathCooldown=.5,this.stuckTime=0}((l=this.world.getBlock(Math.floor(this.mesh.position.x),Math.floor(this.mesh.position.y),Math.floor(this.mesh.position.z)))==null?void 0:l.id)==0?this.pigVelocity.y-=.01:((h=this.world.getBlock(Math.floor(this.mesh.position.x),Math.ceil(this.mesh.position.y),Math.floor(this.mesh.position.z)))==null?void 0:h.id)>0?this.pigVelocity.y+=.05:this.pigVelocity.y=0,this.mesh.position.add(this.pigVelocity);const o=1+n;let r=this.target;if(this.path.length>0&&this.pathIndex<this.path.length){const c=this.path[this.pathIndex];r=new I(c.x+.5,c.y,c.z+.5),this.mesh.position.distanceTo(r)<.5&&(this.pathIndex++,this.pathIndex>=this.path.length&&(this.path=[],this.pathIndex=0))}const a=r.clone().sub(this.mesh.position);a.y=0,a.lengthSq()>1e-6&&a.normalize(),this.mesh.position.add(a.multiplyScalar(o*t)),this.path.length===0&&this.mesh.position.distanceTo(this.target)<2&&(this.target=this.getRandomTarget()),this.target.y=this.mesh.position.y,this.mesh.lookAt(new I(r.x,this.mesh.position.y,r.z)),this.animatePigLegs(o)}broadPhase(){var h;const t=[],n=Math.floor(this.mesh.position.x-this.radius),s=Math.ceil(this.mesh.position.x+this.radius),o=Math.floor(this.mesh.position.y-this.height),r=Math.ceil(this.mesh.position.y),a=Math.floor(this.mesh.position.z-this.radius),l=Math.ceil(this.mesh.position.z+this.radius);for(let c=n;c<=s;c++)for(let u=o;u<=r;u++)for(let f=a;f<=l;f++){const d=(h=this.world.getBlock(c,u,f))==null?void 0:h.id;if(d&&d!==E.empty.id&&d!==E.water.id){let p={},b=!1;d==53||d==67?(p={x:1,y:1,z:1},b=!0):d==50?p={x:.1,y:.1}:p={x:1,y:1,z:1};const g={x:c,y:u,z:f,size:p,hasStep:b};t.push(g)}}return t}getGroundYAt(t,n,s){const o=Math.max(s-3,1),r=s+3;for(let a=r;a>=o;a--)if(this.isWalkable(t,a,n))return a;return s}isWalkable(t,n,s){var u,f,d;const o=((u=this.world.getBlock(t,n-1,s))==null?void 0:u.id)||0,r=((f=this.world.getBlock(t,n,s))==null?void 0:f.id)||0,a=((d=this.world.getBlock(t,n+1,s))==null?void 0:d.id)||0,l=o&&o!==E.empty.id&&o!==E.water.id,h=r===0||r===E.empty.id||r===E.water.id,c=a===0||a===E.empty.id||a===E.water.id;return l&&h&&c}neighbors(t,n,s){const o=[],r=[[1,0],[-1,0],[0,1],[0,-1]];for(const[a,l]of r){if(this.isWalkable(t+a,n,s+l)){o.push({x:t+a,y:n,z:s+l});continue}if(this.isWalkable(t+a,n+1,s+l)){o.push({x:t+a,y:n+1,z:s+l});continue}if(this.isWalkable(t+a,n-1,s+l)){o.push({x:t+a,y:n-1,z:s+l});continue}}return o}findPath(t,n,s=3e3,o=32){const r=this.getGroundYAt(t.x,t.z,t.y),a=this.getGroundYAt(n.x,n.z,n.y);t={x:t.x,y:r,z:t.z},n={x:n.x,y:a,z:n.z};const l=k=>`${k.x}|${k.y}|${k.z}`,h=(k,x)=>Math.abs(k.x-x.x)+Math.abs(k.z-x.z)+Math.abs(k.y-x.y)*.5,c=new Map,u=[],f=new Map,d=new Map,p=(k,x)=>{c.set(l(k),k),u.push({p:k,f:x})},b=()=>{let k=0;for(let _=1;_<u.length;_++)u[_].f<u[k].f&&(k=_);const x=u.splice(k,1)[0];return c.delete(l(x.p)),x.p};p(t,0),d.set(l(t),0);const g=new Set;let v=0;for(;u.length&&v++<s;){const k=b();if(k.x===n.x&&k.y===n.y&&k.z===n.z){const x=[];let _=l(k),B=k;for(;f.has(_);)x.push(B),B=f.get(_),_=l(B);return x.reverse(),x}if(g.add(l(k)),!(Math.abs(k.x-t.x)>o||Math.abs(k.z-t.z)>o))for(const x of this.neighbors(k.x,k.y,k.z)){const _=l(x);if(g.has(_))continue;const B=(d.get(l(k))||0)+1;if(!c.has(_)||B<(d.get(_)||1/0)){f.set(_,k),d.set(_,B);const q=B+h(x,n);c.has(_)||p(x,q)}}}return[]}animatePigLegs(t){const n=Math.sin(Date.now()*.005*t*2);this.mesh.children.forEach(s=>{s.isLeg&&(s.rotation.x=n*.2)})}}class qh extends fe{constructor(t,n){super(t,n);m(this,"mesh",new st);m(this,"health",10);const s=new H(.9,.8,1.6),o=new H(.7,.7,.5);new H(.32,.25,.1);const r=new H(.3,.8,.3),a=new N(s,X.cow.body.material);a.position.set(0,.8,0),a.userData.entity=this,this.mesh.add(a);const l=new N(o,X.cow.head.material);l.position.set(0,1,1),l.userData.entity=this,this.mesh.add(l);for(let h=0;h<4;h++){const c=new N(r,X.cow.feet.material);c.userData.entity=this,c.position.set(h<2?-.25:.25,0,h%2===0?-.6:.6),c.isLeg=!0,this.mesh.add(c)}this.BOUNDARY={minX:-50,maxX:50,minZ:-50,maxZ:50},this.target=this.getRandomTarget(),this.cowVelocity=new I(0,0,0),this.mesh.position.copy(this.position),this.hitTime=0,this.originalMaterials=this.mesh.children.map(h=>h.material),this.redMaterial=new te({color:16711680}),this.redMaterial.needsUpdate=!0}getRandomTarget(){const t=Math.random()*(this.BOUNDARY.maxX-this.BOUNDARY.minX)+this.BOUNDARY.minX,n=Math.random()*(this.BOUNDARY.maxZ-this.BOUNDARY.minZ)+this.BOUNDARY.minZ;return new I(t,75,n)}hit(){console.log("hit cow"),this.hitTime=.3,this.runTime=3,this.cowVelocity.y+=.2,this.mesh.children.forEach((t,n)=>{t.material&&(t.material=this.redMaterial)}),this.target=this.getRandomTarget(),this.audioManager.playBlockSound("cow","hurt"),this.health-=.5,this.health<=0&&this.world.removeEntity(this)}update(t){this.hitTime>0&&(this.hitTime-=t,this.hitTime<=0&&this.mesh.children.forEach((n,s)=>{this.originalMaterials[s]&&(n.material=this.originalMaterials[s])}))}animatecowLegs(t){const n=Math.sin(Date.now()*.005*t*2);this.mesh.children.forEach(s=>{s.isLeg&&(s.rotation.x=n*.2)})}}const Zh=new Vt({color:16711680,transparent:!0,opacity:.2}),$h=new H(1.001,1.001,1.001),Gh=new Vt({wireframe:!0,color:65280}),Kh=new lo(.05,6,6);class Yh{constructor(i){m(this,"simulationRate",250);m(this,"timestep",1/this.simulationRate);m(this,"accumulator",0);m(this,"gravity",32);m(this,"gravityWaterFactor",.6);m(this,"waterVerticalDrag",.95);m(this,"swimUpSpeed",8);m(this,"fallDamageThreshold",3);this.helpers=new st,i.add(this.helpers)}update(i,t,n){var s,o;for(this.accumulator+=i;this.accumulator>=this.timestep;){t.fallDistance===void 0&&(t.fallDistance=0),t._wasOnGround===void 0&&(t._wasOnGround=!1),t._cactusDamageCooldown===void 0&&(t._cactusDamageCooldown=0),t._cactusDamageCooldown>0&&(t._cactusDamageCooldown=Math.max(0,t._cactusDamageCooldown-this.timestep));const r=t.position.y;if(t.applyInputs(this.timestep),(!t.usePointerLock||t.controls.isLocked)&&n.isload(t.position.x,t.position.y,t.position.z)){const a=!!t.inWater,l=!!((s=t.input)!=null&&s.jump||t.inputJump||t.jumpPressed);a?(t.velocity.y-=this.gravity*this.gravityWaterFactor*this.timestep,t.velocity.y*=this.waterVerticalDrag,l&&(t.velocity.y=Math.max(t.velocity.y,this.swimUpSpeed))):t.velocity.y-=this.gravity*this.timestep}if(t.updateBoundsHelper(),this.detectCollisions(t,n),!t.onGround){const a=r-t.position.y;a>0&&(t.fallDistance+=a)}if(!t._wasOnGround&&t.onGround){const a=Math.floor(t.position.x),l=Math.floor(t.position.y-t.height),h=Math.floor(t.position.z);if(!(((o=n.getBlock(a,l,h))==null?void 0:o.id)===E.water.id)){const f=t.fallDistance,d=Math.floor(f-this.fallDamageThreshold);d>0&&t.takeDamage(d,{type:"fall",fallDistance:f})}t.fallDistance=0}t.onGround&&(t.fallDistance=0),t._wasOnGround=t.onGround,this.accumulator-=this.timestep}}detectCollisions(i,t){i.onGround=!1,this.helpers.clear();const n=this.broadPhase(i,t),s=this.narrowPhase(n,i);s.length>0&&!i.riding&&this.resolveCollisions(s,i)}broadPhase(i,t){var c;const n=[],s=Math.floor(i.position.x-i.radius),o=Math.ceil(i.position.x+i.radius),r=Math.floor(i.position.y-i.height),a=Math.ceil(i.position.y),l=Math.floor(i.position.z-i.radius),h=Math.ceil(i.position.z+i.radius);for(let u=s;u<=o;u++)for(let f=r;f<=a;f++)for(let d=l;d<=h;d++){const p=(c=t.getBlock(u,f,d))==null?void 0:c.id;if(p&&p!==E.empty.id&&p!==E.water.id){let b={},g=!1;p==53||p==67?(b={x:1,y:1,z:1},g=!0):p==50?b={x:.1,y:.1}:b={x:1,y:1,z:1};const v={id:p,x:u,y:f,z:d,size:b,hasStep:g};n.push(v)}}return n}narrowPhase(i,t){const n=[];for(const s of i){const o={x:s.size.x/2,y:s.size.y/2,z:s.size.z/2},r={x:Math.max(s.x-o.x,Math.min(t.position.x,s.x+o.x)),y:Math.max(s.y-o.y,Math.min(t.position.y-t.height/2,s.y+o.y)),z:Math.max(s.z-o.z,Math.min(t.position.z,s.z+o.z))},a=r.x-t.position.x,l=r.y-(t.position.y-t.height/2),h=r.z-t.position.z;if(this.pointInPlayerBoundingCylinder(r,t)){const c=E.cactus.id;if(s.id===c&&(t._cactusDamageCooldown===void 0&&(t._cactusDamageCooldown=0),t._cactusDamageCooldown<=0)){const b=new I(-a,0,-h);b.lengthSq()>1e-6&&b.normalize().multiplyScalar(4),t.takeDamage(1,{type:"cactus",knockback:{x:b.x,y:b.y,z:b.z}}),t._cactusDamageCooldown=.5}const u=t.height/2-Math.abs(l),f=t.radius-Math.sqrt(a*a+h*h);let d,p;if(u<f?(d=new I(0,-Math.sign(l),0),p=u,t.onGround=!0):(d=new I(-a,0,-h).normalize(),p=f),s.hasStep&&l>-.6&&l<1.2){t.position.y+=Math.min(s.size.y,.1),t.onGround=!0;continue}n.push({block:s,contactPoint:r,normal:d,overlap:p}),this.addContactPointerHelper(r)}}return n}resolveCollisions(i,t){i.sort((n,s)=>n.overlap<s.overlap);for(const n of i){if(!this.pointInPlayerBoundingCylinder(n.contactPoint,t))continue;let s=n.normal.clone();s.multiplyScalar(n.overlap),t.position.add(s);let o=t.worldVelocity.dot(n.normal),r=n.normal.clone().multiplyScalar(o);t.applyWorldDeltaVelocity(r.negate())}}pointInPlayerBoundingCylinder(i,t){const n=i.x-t.position.x,s=i.y-(t.position.y-t.height/2),o=i.z-t.position.z,r=n*n+o*o;return Math.abs(s)<t.height/2&&r<t.radius*t.radius}addCollisionHelper(i){const t=new N($h,Zh);t.position.copy(i),this.helpers.add(t)}addContactPointerHelper(i){const t=new N(Kh,Gh);t.position.copy(i),this.helpers.add(t)}}const jh=e=>{let i={};for(let t=0;t<e;t++)i[t]={type:"input"};return i},Ie={0:{slot:{0:{type:"input"},1:{type:"input"},2:{type:"input"},3:{type:"input"},4:{type:"ouput"}},grid:2,id:0,name:"empty",visible:!1},61:{slot:{0:{type:"input"},1:{type:"input"},2:{type:"ouput"}},grid:1,id:0,name:"empty",visible:!1},58:{slot:{0:{type:"input"},1:{type:"input"},2:{type:"input"},3:{type:"input"},4:{type:"input"},5:{type:"input"},6:{type:"input"},7:{type:"input"},8:{type:"input"},9:{type:"ouput"}},grid:3,id:0,name:"empty",visible:!1},54:{slot:jh(27),grid:9,id:0,name:"empty",visible:!1}};class Vh{constructor(i,t){this.player=i,this.inventory=t}open(i){this.player.controls.unlock(),this.inventory.show(i)}}class Xh{constructor(i,t,n){m(this,"inventoryContainer",document.getElementById("inventory"));m(this,"inventoryStockage",document.getElementById("stockage"));m(this,"inventoryCrafter",document.getElementById("crafter"));m(this,"inventoryOutput",document.getElementById("output"));m(this,"bar",document.getElementById("bar"));m(this,"hearts",document.getElementById("hearts"));m(this,"selectedItemId",27);m(this,"UIID",0);m(this,"output",0);m(this,"_lastUiRefreshMs",0);m(this,"items",[{block:E.grass.id,quantity:20},{block:E.stone.id,quantity:20},{block:E.craftingTable.id,quantity:20},{block:E.planks.id,quantity:10},{block:E.log.id,quantity:10},{block:E.furnace.id,quantity:10},{block:E.chest.id,quantity:4},{block:E.glass.id,quantity:40},{block:E.stick.id,quantity:40},{block:E.oak_door.id,quantity:1},{block:E.oak_fence.id,quantity:10},{block:E.oak_boat.id,quantity:1},{block:E.coal.id,quantity:32},{block:E.sand.id,quantity:32}]);m(this,"inventory",Array(41).fill(null));m(this,"blockInventory",Array(41).fill(null));m(this,"player",null);m(this,"heldItem",null);m(this,"heldItemElement",document.getElementById("held-item"));this.player=i,this.world=t,this.socket=n,this.isShow=!1,this.inventory[0]=this.items[2],this.inventory[1]=this.items[1],this.inventory[3]=this.items[8],this.inventory[27]=this.items[0],this.inventory[28]=this.items[3],this.inventory[29]=this.items[4],this.inventory[30]=this.items[5],this.inventory[31]=this.items[6],this.inventory[32]=this.items[7],this.inventory[33]=this.items[8],this.inventory[33]=this.items[9],this.inventory[34]=this.items[10],this.inventory[35]=this.items[11],this.inventory[4]=this.items[12],this.inventory[5]=this.items[13],this.renderInventory(),this.renderBar(),document.addEventListener("mousemove",s=>{this.heldItem&&(this.heldItemElement.style.left=`${s.pageX-20}px`,this.heldItemElement.style.top=`${s.pageY-20}px`)}),this.recipes=new fo,this.furnace=new Wn,document.addEventListener("keydown",this.onKeyDown.bind(this))}show(i=0){if(this.isShow=!0,this.inventoryContainer.style.display="block",this.bar.style.display="none",this.hearts.style.display="none",this.UIID=i,this._lastUiRefreshMs=0,this.blockInventory=Array(41).fill(null),this.UIID){const t=this.world.getBlock(this.player.selectedCoords.x,this.player.selectedCoords.y,this.player.selectedCoords.z);console.log(t),t.inventory||(t.inventory=Array(41).fill(null)),this.blockInventory=t.inventory}this.renderInventory()}hide(){var i;this.inventoryContainer.style.display="none",this.bar.style.display="grid",this.hearts.style.display="grid",this.renderBar(),this.UIID&&(this.world.setBlockInventory(this.player.selectedCoords.x,this.player.selectedCoords.y,this.player.selectedCoords.z,this.blockInventory),(i=this.socket.getSocket())==null||i.emit("setBlockInventory",{x:this.player.selectedCoords.x,y:this.player.selectedCoords.y,z:this.player.selectedCoords.z,inventory:this.blockInventory})),this.isShow=!1}update(i){if(this.isShow&&this.UIID===E.furnace.id){const t=this.world.getBlock(this.player.selectedCoords.x,this.player.selectedCoords.y,this.player.selectedCoords.z);t!=null&&t.inventory&&t.inventory!==this.blockInventory&&(this.blockInventory=t.inventory);const n=typeof performance<"u"&&performance.now?performance.now():Date.now();n-this._lastUiRefreshMs>100&&(this._lastUiRefreshMs=n,this.renderInventory())}}getBlock(i){return this.inventory[i]}getSelectedItem(){return this.inventory[this.selectedItemId]}selectItem(i){var t;if(i){document.querySelectorAll(".slot").forEach(o=>{o.classList.remove("selected")});const s=document.querySelector('.slot[data-index_bar="'+i+'"]');s&&(s.classList.add("selected"),this.selectedItemId=i),this.player.setBlockInHand((t=this.getBlock(i))==null?void 0:t.block)}}renderInventory(){var n;this.inventoryStockage.innerHTML="",this.inventoryCrafter.innerHTML="",this.inventoryOutput.innerHTML="",this.inventory.forEach((s,o)=>{const r=document.createElement("div");if(r.classList.add("slot"),r.dataset.index=o,s){const a=document.createElement("img"),l=document.createElement("div"),h=Object.values(E).find(c=>c.id===s.block);a.src=h.icon,a.alt=s.block,a.width=200,l.innerHTML=s.quantity,l.classList.add("slot-quantity"),r.appendChild(a),h.stackable&&r.appendChild(l)}r.addEventListener("mousedown",a=>this.handleSlotClick(o,a)),o<36&&this.inventoryStockage.appendChild(r)});const i=(n=Ie[this.UIID])==null?void 0:n.slot,t=Ie[this.UIID].grid;this.inventoryCrafter.style.gridTemplateColumns="repeat("+t+", 50px)";for(const s in i)if(i.hasOwnProperty(s)){const o=i[s],r=document.createElement("div");if(r.classList.add("slot"),r.dataset.index=o.name,this.blockInventory[s]!==null){const a=document.createElement("img"),l=document.createElement("div"),h=Object.values(E).find(c=>c.id===this.blockInventory[s].block);a.src=h.icon,a.alt=this.blockInventory[s].block,a.width=200,l.innerHTML=this.blockInventory[s].quantity,l.classList.add("slot-quantity"),r.appendChild(a),h.stackable&&r.appendChild(l)}r.addEventListener("mousedown",a=>this.handleSlotBlockClick(s,a)),i[s].type=="input"?this.inventoryCrafter.appendChild(r):(this.output=s,this.inventoryOutput.appendChild(r))}if(this.UIID===E.furnace.id){const s=this.furnace.getProgress(this.blockInventory),o=document.createElement("div");o.classList.add("furnace-progress"),o.style.setProperty("--cook",String(s.cookPct)),o.style.setProperty("--burn",String(s.burnPct));const r=document.createElement("div");r.classList.add("fp-flame","fp-frame");const a=document.createElement("div");a.classList.add("fp-arrow","fp-frame");const l=document.createElement("div");l.classList.add("fp-arrow-fill"),a.appendChild(l),o.appendChild(r),o.appendChild(a),this.inventoryOutput.appendChild(o)}this.inventoryOutput.innerHTML==""?this.inventoryOutput.style.display="none":this.inventoryOutput.style.display="grid"}renderBar(){this.bar.innerHTML="",this.inventory.forEach((i,t)=>{if(t>=27&&t<36){const n=document.createElement("div");if(n.classList.add("slot"),n.dataset.index_bar=t,t==this.selectedItemId&&n.classList.add("selected"),i){const s=document.createElement("img"),o=document.createElement("div"),r=Object.values(E).find(a=>a.id===i.block);s.src=r.icon,s.alt=i.block,s.width=200,o.innerHTML=i.quantity,o.classList.add("slot-quantity"),n.appendChild(s),r.stackable&&n.appendChild(o)}this.bar.appendChild(n)}})}inventoryToGrid(){var r,a,l;const i=Ie[this.UIID].grid;let t=[];for(let h=0;h<i;h++){const c=[];for(let u=0;u<i;u++)c.push(null);t.push(c)}const n=(r=Ie[this.UIID])==null?void 0:r.slot;let s=0,o=0;for(const h in n){if(o>=i&&(o=0,s++,s>=i))break;(a=this.blockInventory[h])!=null&&a.block?t[s][o]=(l=this.blockInventory[h])==null?void 0:l.block:t[s][o]=null,o++}return t}handleSlotClick(i,t){const n=this.inventory[i];if(this.heldItem)if(!n)t.button==0?(this.inventory[i]=this.heldItem,this.clearHeldItem()):(this.inventory[i]={...this.heldItem},this.inventory[i].quantity=1,this.setHeldItem(this.heldItem.block,this.heldItem.quantity-=1));else if(this.inventory[i].block==this.heldItem.block&&O(this.inventory[i].block).stackable)this.inventory[i].quantity+=this.heldItem.quantity,this.clearHeldItem();else{[this.inventory[i],this.heldItem]=[this.heldItem,this.inventory[i]];const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon}else if(n)if(t.button==0){this.heldItem=this.inventory[i],this.inventory[i]=null;const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon,this.heldItemElement.style.display="block"}else{this.heldItem={...this.inventory[i]},this.heldItem.quantity=Math.round(this.heldItem.quantity/2),this.inventory[i].quantity=Math.floor(this.inventory[i].quantity/2);const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon,this.heldItemElement.style.display="block"}this.renderInventory()}handleSlotBlockClick(i,t){const n=this.blockInventory[i];if(this.heldItem){if(!n)t.button==0?i!=this.output&&(this.blockInventory[i]=this.heldItem,this.clearHeldItem()):(this.blockInventory[i]={...this.heldItem},this.blockInventory[i].quantity=1,this.setHeldItem(this.heldItem.block,this.heldItem.quantity-=1));else if(this.blockInventory[i].block==this.heldItem.block&&O(this.blockInventory[i].block).stackable)i==this.output?this.setHeldItem(this.heldItem.block,this.heldItem.quantity+=this.blockInventory[i].quantity):(this.blockInventory[i].quantity+=this.heldItem.quantity,this.clearHeldItem());else if(i!=this.output){[this.blockInventory[i],this.heldItem]=[this.heldItem,this.blockInventory[i]];const s=Object.values(E).find(o=>o.id===this.heldItem.block);this.heldItemElement.src=s.icon}}else n&&(t.button==0?(this.setHeldItem(this.blockInventory[i].block,this.blockInventory[i].quantity),this.blockInventory[i]=null):(this.setHeldItem(this.blockInventory[i].block,Math.round(this.blockInventory[i].quantity/2)),this.blockInventory[i].quantity=Math.floor(this.blockInventory[i].quantity/2)));if(this.UIID==0||this.UIID==58){const s=this.recipes.checkRecipe(this.inventoryToGrid());s?this.blockInventory[this.output]={block:s.id,quantity:s.quantity}:this.blockInventory[this.output]=null}else this.UIID==E.furnace.id;this.renderInventory()}clearHeldItem(){this.heldItem=null,this.heldItemElement.style.display="none"}setHeldItem(i,t){this.heldItem={block:i,quantity:t};const n=O(i);this.heldItemElement.src=n.icon,this.heldItemElement.style.display="block",t<1&&this.clearHeldItem()}addBlock(i){let t=!1;this.inventory.forEach((n,s)=>{s<36&&(n==null?void 0:n.block)==i&&(n.quantity+=1,t=!0)}),t||this.inventory.forEach((n,s)=>{s<36&&!t&&n==null&&(console.log(i),this.inventory[s]={quantity:1,block:i},t=!0)}),this.renderBar()}removeBlock(i){this.inventory.forEach((t,n)=>{n<36&&(t==null?void 0:t.block)==i&&(t.quantity-=1,t.quantity<=0&&(this.inventory[n]=null))}),this.renderBar()}save(){(async()=>{new Blob([JSON.stringify(this.inventory)]).size;const i=this.inventory;await Qh(i)})()}load(){(async()=>{const i=await Jh();this.inventory=i,this.renderBar()})()}onKeyDown(i){document.querySelectorAll(".item").forEach(n=>n.classList.remove("selected"));let t=null;i.code==="Digit1"&&(t=27),i.code==="Digit2"&&(t=28),i.code==="Digit3"&&(t=29),i.code==="Digit4"&&(t=30),i.code==="Digit5"&&(t=31),i.code==="Digit6"&&(t=32),i.code==="Digit7"&&(t=33),i.code==="Digit8"&&(t=34),i.code==="Digit9"&&(t=35),t&&this.selectItem(t),i.key==="Escape"&&this.isShow&&(this.hide(),this.player.controls.lock())}}const Wh="minecraftDB",de="minecraftData";function Ds(){return new Promise((e,i)=>{const t=indexedDB.open(Wh,1);t.onupgradeneeded=function(n){n.target.result.createObjectStore(de,{keyPath:"id"})},t.onsuccess=function(n){e(n.target.result)},t.onerror=function(n){i(n.target.error)}})}async function Qh(e){const t=(await Ds()).transaction([de],"readwrite");return t.objectStore(de).put({id:"minecraft_inventory",data:e}),t.complete}async function Jh(){const e=await Ds();return new Promise((i,t)=>{const o=e.transaction([de],"readonly").objectStore(de).get("minecraft_inventory");o.onsuccess=function(){var r;i(((r=o.result)==null?void 0:r.data)||null)},o.onerror=function(r){t(r.target.error)}})}class tc{constructor(i,t,n,s,o){this.world=i,this.player=t,this.inventory=n,this.client=s,this.chat=o,document.getElementById("backToGame").addEventListener("click",()=>this.backToGame()),document.getElementById("save").addEventListener("click",()=>this.save()),document.getElementById("load").addEventListener("click",()=>this.load()),document.getElementById("connect").addEventListener("click",()=>this.connect()),window.addEventListener("keydown",c=>{c.key==="Escape"&&this.inventory.isShow===!1&&this.openMenu()})}backToGame(){document.getElementById("menu").style.display="none",this.player.usePointerLock&&this.player.controls.lock(),this.inventory.hide()}openMenu(){document.getElementById("menu").style.display="block",this.inventory.hide()}save(){this.world.save(),this.inventory.save(),this.player.save(),this.chat.add("Saved game")}load(){this.world.load(),this.inventory.load(),this.player.load(),this.chat.add("Load saved")}connect(){this.client.getSocket()||this.client.init()}}class ec{constructor(i,t,n){this.scene=i,this.sun=new uo,this.time=n,this.setupLights(),this.player=t,this.dayDuration=1200*1e3;const s=new Re().load("images/environment/sun_light.png");s.magFilter=s.minFilter=ee,s.generateMipmaps=!1,this.sunMesh=new jn(new Vn({map:s,transparent:!0,fog:!1})),this.sunMesh.position.set(0,100,0),this.sunMesh.scale.set(8,8,1),i.add(this.sunMesh)}setupLights(){this.sun.intensity=1.5,this.sun.position.set(50,120,-10),this.sun.castShadow=!0,this.sun.shadow.camera.left=-40,this.sun.shadow.camera.right=40,this.sun.shadow.camera.top=40,this.sun.shadow.camera.bottom=-40,this.sun.shadow.camera.near=.1,this.sun.shadow.camera.far=200,this.sun.shadow.bias=-1e-4,this.sun.shadow.mapSize=new Gn(2048,2048),this.scene.add(this.sun),this.scene.add(this.sun.target),new po(this.sun.shadow.camera);const i=new _o;i.intensity=.1,this.scene.add(i)}update(i){this.updateDayNightCycle(i)}updateDayNightCycle(i){this.time+=i/this.dayDuration,this.time>1&&(this.time=0);const t=this.time*Math.PI*2;this.sun.position.copy(this.player.camera.position),this.sun.position.sub(new I(-Math.cos(t)*50,-(Math.sin(t)*50),-10)),this.sunMesh.position.copy(this.player.camera.position),this.sunMesh.position.sub(new I(-Math.cos(t)*50,-(Math.sin(t)*50),-10)),this.sunMesh.material.rotation=-this.player.camera.rotation.z,this.sun.target.position.copy(this.player.camera.position)}getTime(){let i=this.time*24*60,t=parseInt(i/60),n=parseInt(i%60);return t+"H"+n}}const ht=Object.create(null);ht.open="0";ht.close="1";ht.ping="2";ht.pong="3";ht.message="4";ht.upgrade="5";ht.noop="6";const Ae=Object.create(null);Object.keys(ht).forEach(e=>{Ae[ht[e]]=e});const ki={type:"error",data:"parser error"},Ls=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Rs=typeof ArrayBuffer=="function",Os=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Ri=({type:e,data:i},t,n)=>Ls&&i instanceof Blob?t?n(i):Rn(i,n):Rs&&(i instanceof ArrayBuffer||Os(i))?t?n(i):Rn(new Blob([i]),n):n(ht[e]+(i||"")),Rn=(e,i)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];i("b"+(n||""))},t.readAsDataURL(e)};function On(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let si;function ic(e,i){if(Ls&&e.data instanceof Blob)return e.data.arrayBuffer().then(On).then(i);if(Rs&&(e.data instanceof ArrayBuffer||Os(e.data)))return i(On(e.data));Ri(e,!1,t=>{si||(si=new TextEncoder),i(si.encode(t))})}const Nn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Nn.length;e++)jt[Nn.charCodeAt(e)]=e;const nc=e=>{let i=e.length*.75,t=e.length,n,s=0,o,r,a,l;e[e.length-1]==="="&&(i--,e[e.length-2]==="="&&i--);const h=new ArrayBuffer(i),c=new Uint8Array(h);for(n=0;n<t;n+=4)o=jt[e.charCodeAt(n)],r=jt[e.charCodeAt(n+1)],a=jt[e.charCodeAt(n+2)],l=jt[e.charCodeAt(n+3)],c[s++]=o<<2|r>>4,c[s++]=(r&15)<<4|a>>2,c[s++]=(a&3)<<6|l&63;return h},sc=typeof ArrayBuffer=="function",Oi=(e,i)=>{if(typeof e!="string")return{type:"message",data:Ns(e,i)};const t=e.charAt(0);return t==="b"?{type:"message",data:oc(e.substring(1),i)}:Ae[t]?e.length>1?{type:Ae[t],data:e.substring(1)}:{type:Ae[t]}:ki},oc=(e,i)=>{if(sc){const t=nc(e);return Ns(t,i)}else return{base64:!0,data:e}},Ns=(e,i)=>{switch(i){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},Ps="",rc=(e,i)=>{const t=e.length,n=new Array(t);let s=0;e.forEach((o,r)=>{Ri(o,!1,a=>{n[r]=a,++s===t&&i(n.join(Ps))})})},ac=(e,i)=>{const t=e.split(Ps),n=[];for(let s=0;s<t.length;s++){const o=Oi(t[s],i);if(n.push(o),o.type==="error")break}return n};function hc(){return new TransformStream({transform(e,i){ic(e,t=>{const n=t.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const o=new DataView(s.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{s=new Uint8Array(9);const o=new DataView(s.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}e.data&&typeof e.data!="string"&&(s[0]|=128),i.enqueue(s),i.enqueue(t)})}})}let oi;function Te(e){return e.reduce((i,t)=>i+t.length,0)}function Be(e,i){if(e[0].length===i)return e.shift();const t=new Uint8Array(i);let n=0;for(let s=0;s<i;s++)t[s]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),t}function cc(e,i){oi||(oi=new TextDecoder);const t=[];let n=0,s=-1,o=!1;return new TransformStream({transform(r,a){for(t.push(r);;){if(n===0){if(Te(t)<1)break;const l=Be(t,1);o=(l[0]&128)===128,s=l[0]&127,s<126?n=3:s===126?n=1:n=2}else if(n===1){if(Te(t)<2)break;const l=Be(t,2);s=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(Te(t)<8)break;const l=Be(t,8),h=new DataView(l.buffer,l.byteOffset,l.length),c=h.getUint32(0);if(c>Math.pow(2,21)-1){a.enqueue(ki);break}s=c*Math.pow(2,32)+h.getUint32(4),n=3}else{if(Te(t)<s)break;const l=Be(t,s);a.enqueue(Oi(o?l:oi.decode(l),i)),n=0}if(s===0||s>e){a.enqueue(ki);break}}}})}const Us=4;function Z(e){if(e)return lc(e)}function lc(e){for(var i in Z.prototype)e[i]=Z.prototype[i];return e}Z.prototype.on=Z.prototype.addEventListener=function(e,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(i),this};Z.prototype.once=function(e,i){function t(){this.off(e,t),i.apply(this,arguments)}return t.fn=i,this.on(e,t),this};Z.prototype.off=Z.prototype.removeListener=Z.prototype.removeAllListeners=Z.prototype.removeEventListener=function(e,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+e];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var n,s=0;s<t.length;s++)if(n=t[s],n===i||n.fn===i){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+e],this};Z.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),t=this._callbacks["$"+e],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,s=t.length;n<s;++n)t[n].apply(this,i)}return this};Z.prototype.emitReserved=Z.prototype.emit;Z.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Z.prototype.hasListeners=function(e){return!!this.listeners(e).length};const qe=typeof Promise=="function"&&typeof Promise.resolve=="function"?i=>Promise.resolve().then(i):(i,t)=>t(i,0),Q=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),dc="arraybuffer";function Hs(e,...i){return i.reduce((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t),{})}const fc=Q.setTimeout,uc=Q.clearTimeout;function Ze(e,i){i.useNativeTimers?(e.setTimeoutFn=fc.bind(Q),e.clearTimeoutFn=uc.bind(Q)):(e.setTimeoutFn=Q.setTimeout.bind(Q),e.clearTimeoutFn=Q.clearTimeout.bind(Q))}const pc=1.33;function _c(e){return typeof e=="string"?mc(e):Math.ceil((e.byteLength||e.size)*pc)}function mc(e){let i=0,t=0;for(let n=0,s=e.length;n<s;n++)i=e.charCodeAt(n),i<128?t+=1:i<2048?t+=2:i<55296||i>=57344?t+=3:(n++,t+=4);return t}function Fs(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function gc(e){let i="";for(let t in e)e.hasOwnProperty(t)&&(i.length&&(i+="&"),i+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return i}function yc(e){let i={},t=e.split("&");for(let n=0,s=t.length;n<s;n++){let o=t[n].split("=");i[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return i}class wc extends Error{constructor(i,t,n){super(i),this.description=t,this.context=n,this.type="TransportError"}}class Ni extends Z{constructor(i){super(),this.writable=!1,Ze(this,i),this.opts=i,this.query=i.query,this.socket=i.socket,this.supportsBinary=!i.forceBase64}onError(i,t,n){return super.emitReserved("error",new wc(i,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(i){this.readyState==="open"&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const t=Oi(i,this.socket.binaryType);this.onPacket(t)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,t={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const i=this.opts.hostname;return i.indexOf(":")===-1?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(i){const t=gc(i);return t.length?"?"+t:""}}class bc extends Ni{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(i){this.readyState="pausing";const t=()=>{this.readyState="paused",i()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};ac(i,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const i=()=>{this.write([{type:"close"}])};this.readyState==="open"?i():this.once("open",i)}write(i){this.writable=!1,rc(i,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Fs()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(i,t)}}let qs=!1;try{qs=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const kc=qs;function vc(){}class xc extends bc{constructor(i){if(super(i),typeof location<"u"){const t=location.protocol==="https:";let n=location.port;n||(n=t?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||n!==i.port}}doWrite(i,t){const n=this.request({method:"POST",data:i});n.on("success",t),n.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=i}}class at extends Z{constructor(i,t,n){super(),this.createRequest=i,Ze(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var i;const t=Hs(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let s in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this._opts.extraHeaders[s])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(i=this._opts.cookieJar)===null||i===void 0||i.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var s;n.readyState===3&&((s=this._opts.cookieJar)===null||s===void 0||s.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(s){this.setTimeoutFn(()=>{this._onError(s)},0);return}typeof document<"u"&&(this._index=at.requestsCount++,at.requests[this._index]=this)}_onError(i){this.emitReserved("error",i,this._xhr),this._cleanup(!0)}_cleanup(i){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=vc,i)try{this._xhr.abort()}catch{}typeof document<"u"&&delete at.requests[this._index],this._xhr=null}}_onLoad(){const i=this._xhr.responseText;i!==null&&(this.emitReserved("data",i),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}at.requestsCount=0;at.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Pn);else if(typeof addEventListener=="function"){const e="onpagehide"in Q?"pagehide":"unload";addEventListener(e,Pn,!1)}}function Pn(){for(let e in at.requests)at.requests.hasOwnProperty(e)&&at.requests[e].abort()}const Ec=function(){const e=Zs({xdomain:!1});return e&&e.responseType!==null}();class Sc extends xc{constructor(i){super(i);const t=i&&i.forceBase64;this.supportsBinary=Ec&&!t}request(i={}){return Object.assign(i,{xd:this.xd},this.opts),new at(Zs,this.uri(),i)}}function Zs(e){const i=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||kc))return new XMLHttpRequest}catch{}if(!i)try{return new Q[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const $s=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ic extends Ni{get name(){return"websocket"}doOpen(){const i=this.uri(),t=this.opts.protocols,n=$s?{}:Hs(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(i,t,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let t=0;t<i.length;t++){const n=i[t],s=t===i.length-1;Ri(n,this.supportsBinary,o=>{try{this.doWrite(n,o)}catch{}s&&qe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Fs()),this.supportsBinary||(t.b64=1),this.createUri(i,t)}}const ri=Q.WebSocket||Q.MozWebSocket;class Tc extends Ic{createSocket(i,t,n){return $s?new ri(i,t,n):t?new ri(i,t):new ri(i)}doWrite(i,t){this.ws.send(t)}}class Bc extends Ni{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(i){return this.emitReserved("error",i)}this._transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(i=>{const t=cc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=i.readable.pipeThrough(t).getReader(),s=hc();s.readable.pipeTo(i.writable),this._writer=s.writable.getWriter();const o=()=>{n.read().then(({done:a,value:l})=>{a||(this.onPacket(l),o())}).catch(a=>{})};o();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then(()=>this.onOpen())})})}write(i){this.writable=!1;for(let t=0;t<i.length;t++){const n=i[t],s=t===i.length-1;this._writer.write(n).then(()=>{s&&qe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var i;(i=this._transport)===null||i===void 0||i.close()}}const zc={websocket:Tc,webtransport:Bc,polling:Sc},Cc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ac=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function vi(e){if(e.length>8e3)throw"URI too long";const i=e,t=e.indexOf("["),n=e.indexOf("]");t!=-1&&n!=-1&&(e=e.substring(0,t)+e.substring(t,n).replace(/:/g,";")+e.substring(n,e.length));let s=Cc.exec(e||""),o={},r=14;for(;r--;)o[Ac[r]]=s[r]||"";return t!=-1&&n!=-1&&(o.source=i,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Mc(o,o.path),o.queryKey=Dc(o,o.query),o}function Mc(e,i){const t=/\/{2,9}/g,n=i.replace(t,"/").split("/");return(i.slice(0,1)=="/"||i.length===0)&&n.splice(0,1),i.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Dc(e,i){const t={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,o){s&&(t[s]=o)}),t}const xi=typeof addEventListener=="function"&&typeof removeEventListener=="function",Me=[];xi&&addEventListener("offline",()=>{Me.forEach(e=>e())},!1);class bt extends Z{constructor(i,t){if(super(),this.binaryType=dc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,i&&typeof i=="object"&&(t=i,i=null),i){const n=vi(i);t.hostname=n.host,t.secure=n.protocol==="https"||n.protocol==="wss",t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=vi(t.host).host);Ze(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(n=>{const s=n.prototype.name;this.transports.push(s),this._transportsByName[s]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=yc(this.opts.query)),xi&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Me.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(i){const t=Object.assign({},this.opts.query);t.EIO=Us,t.transport=i,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[i]);return new this._transportsByName[i](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const i=this.opts.rememberUpgrade&&bt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(i);t.open(),this.setTransport(t)}setTransport(i){this.transport&&this.transport.removeAllListeners(),this.transport=i,i.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",bt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",i),this.emitReserved("heartbeat"),i.type){case"open":this.onHandshake(JSON.parse(i.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=i.data,this._onError(t);break;case"message":this.emitReserved("data",i.data),this.emitReserved("message",i.data);break}}onHandshake(i){this.emitReserved("handshake",i),this.id=i.sid,this.transport.query.sid=i.sid,this._pingInterval=i.pingInterval,this._pingTimeout=i.pingTimeout,this._maxPayload=i.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const i=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+i,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},i),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const i=this._getWritablePackets();this.transport.send(i),this._prevBufferLen=i.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+=_c(s)),n>0&&t>this._maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const i=Date.now()>this._pingTimeoutTime;return i&&(this._pingTimeoutTime=0,qe(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),i}write(i,t,n){return this._sendPacket("message",i,t,n),this}send(i,t,n){return this._sendPacket("message",i,t,n),this}_sendPacket(i,t,n,s){if(typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:i,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){const i=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),i()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():i()}):this.upgrading?n():i()),this}_onError(i){if(bt.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",i),this._onClose("transport error",i)}_onClose(i,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),xi&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=Me.indexOf(this._offlineEventListener);n!==-1&&Me.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",i,t),this.writeBuffer=[],this._prevBufferLen=0}}}bt.protocol=Us;class Lc extends bt{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(i){let t=this.createTransport(i),n=!1;bt.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;bt.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=t.name,this.emitReserved("upgradeError",f)}}))};function o(){n||(n=!0,c(),t.close(),t=null)}const r=u=>{const f=new Error("probe error: "+u);f.transport=t.name,o(),this.emitReserved("upgradeError",f)};function a(){r("transport closed")}function l(){r("socket closed")}function h(u){t&&u.name!==t.name&&o()}const c=()=>{t.removeListener("open",s),t.removeListener("error",r),t.removeListener("close",a),this.off("close",l),this.off("upgrading",h)};t.once("open",s),t.once("error",r),t.once("close",a),this.once("close",l),this.once("upgrading",h),this._upgrades.indexOf("webtransport")!==-1&&i!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(i){this._upgrades=this._filterUpgrades(i.upgrades),super.onHandshake(i)}_filterUpgrades(i){const t=[];for(let n=0;n<i.length;n++)~this.transports.indexOf(i[n])&&t.push(i[n]);return t}}let Rc=class extends Lc{constructor(i,t={}){const n=typeof i=="object"?i:t;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(s=>zc[s]).filter(s=>!!s)),super(i,n)}};function Oc(e,i="",t){let n=e;t=t||typeof location<"u"&&location,e==null&&(e=t.protocol+"//"+t.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=t.protocol+e:e=t.host+e),/^(https?|wss?):\/\//.test(e)||(typeof t<"u"?e=t.protocol+"//"+e:e="https://"+e),n=vi(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+i,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}const Nc=typeof ArrayBuffer=="function",Pc=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Gs=Object.prototype.toString,Uc=typeof Blob=="function"||typeof Blob<"u"&&Gs.call(Blob)==="[object BlobConstructor]",Hc=typeof File=="function"||typeof File<"u"&&Gs.call(File)==="[object FileConstructor]";function Pi(e){return Nc&&(e instanceof ArrayBuffer||Pc(e))||Uc&&e instanceof Blob||Hc&&e instanceof File}function De(e,i){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(De(e[t]))return!0;return!1}if(Pi(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return De(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&De(e[t]))return!0;return!1}function Fc(e){const i=[],t=e.data,n=e;return n.data=Ei(t,i),n.attachments=i.length,{packet:n,buffers:i}}function Ei(e,i){if(!e)return e;if(Pi(e)){const t={_placeholder:!0,num:i.length};return i.push(e),t}else if(Array.isArray(e)){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=Ei(e[n],i);return t}else if(typeof e=="object"&&!(e instanceof Date)){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=Ei(e[n],i));return t}return e}function qc(e,i){return e.data=Si(e.data,i),delete e.attachments,e}function Si(e,i){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<i.length)return i[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=Si(e[t],i);else if(typeof e=="object")for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=Si(e[t],i));return e}const Zc=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],$c=5;var A;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(A||(A={}));class Gc{constructor(i){this.replacer=i}encode(i){return(i.type===A.EVENT||i.type===A.ACK)&&De(i)?this.encodeAsBinary({type:i.type===A.EVENT?A.BINARY_EVENT:A.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id}):[this.encodeAsString(i)]}encodeAsString(i){let t=""+i.type;return(i.type===A.BINARY_EVENT||i.type===A.BINARY_ACK)&&(t+=i.attachments+"-"),i.nsp&&i.nsp!=="/"&&(t+=i.nsp+","),i.id!=null&&(t+=i.id),i.data!=null&&(t+=JSON.stringify(i.data,this.replacer)),t}encodeAsBinary(i){const t=Fc(i),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}}function Un(e){return Object.prototype.toString.call(e)==="[object Object]"}class Ui extends Z{constructor(i){super(),this.reviver=i}add(i){let t;if(typeof i=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(i);const n=t.type===A.BINARY_EVENT;n||t.type===A.BINARY_ACK?(t.type=n?A.EVENT:A.ACK,this.reconstructor=new Kc(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Pi(i)||i.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(i),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+i)}decodeString(i){let t=0;const n={type:Number(i.charAt(0))};if(A[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===A.BINARY_EVENT||n.type===A.BINARY_ACK){const o=t+1;for(;i.charAt(++t)!=="-"&&t!=i.length;);const r=i.substring(o,t);if(r!=Number(r)||i.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(r)}if(i.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(i.charAt(t)===","||t===i.length););n.nsp=i.substring(o,t)}else n.nsp="/";const s=i.charAt(t+1);if(s!==""&&Number(s)==s){const o=t+1;for(;++t;){const r=i.charAt(t);if(r==null||Number(r)!=r){--t;break}if(t===i.length)break}n.id=Number(i.substring(o,t+1))}if(i.charAt(++t)){const o=this.tryParse(i.substr(t));if(Ui.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,t){switch(i){case A.CONNECT:return Un(t);case A.DISCONNECT:return t===void 0;case A.CONNECT_ERROR:return typeof t=="string"||Un(t);case A.EVENT:case A.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Zc.indexOf(t[0])===-1);case A.ACK:case A.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Kc{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const t=qc(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Yc=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ui,Encoder:Gc,get PacketType(){return A},protocol:$c},Symbol.toStringTag,{value:"Module"}));function et(e,i,t){return e.on(i,t),function(){e.off(i,t)}}const jc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ks extends Z{constructor(i,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[et(i,"open",this.onopen.bind(this)),et(i,"packet",this.onpacket.bind(this)),et(i,"error",this.onerror.bind(this)),et(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...t){var n,s,o;if(jc.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(t.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:A.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const c=this.ids++,u=t.pop();this._registerAckCallback(c,u),r.id=c}const a=(s=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||s===void 0?void 0:s.writable,l=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(i,t){var n;const s=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(s===void 0){this.acks[i]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===i&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},s),r=(...a)=>{this.io.clearTimeoutFn(o),t.apply(this,a)};r.withError=!0,this.acks[i]=r}emitWithAck(i,...t){return new Promise((n,s)=>{const o=(r,a)=>r?s(r):n(a);o.withError=!0,t.push(o),this.emit(i,...t)})}_addToQueue(i){let t;typeof i[i.length-1]=="function"&&(t=i.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((s,...o)=>n!==this._queue[0]?void 0:(s!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!i||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){typeof this.auth=="function"?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:A.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(i=>{if(!this.sendBuffer.some(n=>String(n.id)===i)){const n=this.acks[i];delete this.acks[i],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case A.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case A.EVENT:case A.BINARY_EVENT:this.onevent(i);break;case A.ACK:case A.BINARY_ACK:this.onack(i);break;case A.DISCONNECT:this.ondisconnect();break;case A.CONNECT_ERROR:this.destroy();const n=new Error(i.data.message);n.data=i.data.data,this.emitReserved("connect_error",n);break}}onevent(i){const t=i.data||[];i.id!=null&&t.push(this.ack(i.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&typeof i[i.length-1]=="string"&&(this._lastOffset=i[i.length-1])}ack(i){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:A.ACK,id:i,data:s}))}}onack(i){const t=this.acks[i.id];typeof t=="function"&&(delete this.acks[i.id],t.withError&&i.data.unshift(null),t.apply(this,i.data))}onconnect(i,t){this.id=i,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:A.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(i===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(i===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,i.data)}}}function Zt(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Zt.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),t=Math.floor(i*this.jitter*e);e=Math.floor(i*10)&1?e+t:e-t}return Math.min(e,this.max)|0};Zt.prototype.reset=function(){this.attempts=0};Zt.prototype.setMin=function(e){this.ms=e};Zt.prototype.setMax=function(e){this.max=e};Zt.prototype.setJitter=function(e){this.jitter=e};class Ii extends Z{constructor(i,t){var n;super(),this.nsps={},this.subs=[],i&&typeof i=="object"&&(t=i,i=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ze(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Zt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=i;const s=t.parser||Yc;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,i||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var t;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(t=this.backoff)===null||t===void 0||t.setMin(i),this)}randomizationFactor(i){var t;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(t=this.backoff)===null||t===void 0||t.setJitter(i),this)}reconnectionDelayMax(i){var t;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(t=this.backoff)===null||t===void 0||t.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new Rc(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=et(t,"open",function(){n.onopen(),i&&i()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),i?i(a):this.maybeReconnectOnOpen()},r=et(t,"error",o);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{s(),o(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(s),this.subs.push(r),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(et(i,"ping",this.onping.bind(this)),et(i,"data",this.ondata.bind(this)),et(i,"error",this.onerror.bind(this)),et(i,"close",this.onclose.bind(this)),et(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(t){this.onclose("parse error",t)}}ondecoded(i){qe(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,t){let n=this.nsps[i];return n?this._autoConnect&&!n.active&&n.connect():(n=new Ks(this,i,t),this.nsps[i]=n),n}_destroy(i){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(i){const t=this.encoder.encode(i);for(let n=0;n<t.length;n++)this.engine.write(t[n],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(i,t){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(s=>{s?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",s)):i.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const Gt={};function Le(e,i){typeof e=="object"&&(i=e,e=void 0),i=i||{};const t=Oc(e,i.path||"/socket.io"),n=t.source,s=t.id,o=t.path,r=Gt[s]&&o in Gt[s].nsps,a=i.forceNew||i["force new connection"]||i.multiplex===!1||r;let l;return a?l=new Ii(n,i):(Gt[s]||(Gt[s]=new Ii(n,i)),l=Gt[s]),t.query&&!i.query&&(i.query=t.queryKey),l.socket(t.path,i)}Object.assign(Le,{Manager:Ii,Socket:Ks,io:Le,connect:Le});class Vc extends fe{constructor(t,n,s){super(t,n);m(this,"mesh",new st);m(this,"radius",2);m(this,"height",1);new te({color:65280});const o=new N(new H(.25,.72,.25),X.steve.leg.material);o.position.set(-.12,-1.45,0),o.userData.entity=this,this.mesh.add(o);const r=new N(new H(.25,.72,.25),X.steve.leg.material);r.position.set(.12,-1.45,0),r.userData.entity=this,this.mesh.add(r);const a=new N(new H(.5,.71,.25),X.steve.body.material);a.position.set(0,-.75,0),a.userData.entity=this,this.mesh.add(a);const l=new N(new H(.5,.5,.5),X.steve.head.material);l.position.set(0,-.15,0),l.name="head",l.userData.entity=this,this.mesh.add(l);const h=this.createNameTag(s);h.name="nameTag",this.mesh.add(h);const c=new N(new H(.25,.71,.25),X.steve.arm.material);c.position.set(-.38,-.75,0),c.userData.entity=this,this.mesh.add(c);const u=new N(new H(.25,.71,.25),X.steve.arm.material);u.position.set(.38,-.75,0),u.userData.entity=this,this.mesh.add(u),this.mesh.position.copy(this.position),this.hitTime=0,this.originalMaterials=this.mesh.children.map(f=>f.material),this.redMaterial=new te({color:16711680}),this.redMaterial.needsUpdate=!0}hit(){console.log("hit player"),this.hitTime=.3,this.runTime=3,this.mesh.children.forEach((t,n)=>{t.material&&t.name!="nameTag"&&(t.material=this.redMaterial)}),this.target=this.getRandomTarget()}update(t){this.hitTime>0&&(this.hitTime-=t,this.hitTime<=0&&this.mesh.children.forEach((n,s)=>{this.originalMaterials[s]&&(n.material=this.originalMaterials[s])}))}updatePosition(t){this.mesh.position.set(t.position.x,t.position.y,t.position.z);const n=this.mesh.position.x+t.direction.x,s=this.mesh.position.y+t.direction.y,o=this.mesh.position.z+t.direction.z,r=new I(n,this.mesh.position.y,o),a=Math.atan2(r.z-this.mesh.position.z,r.x-this.mesh.position.x);this.mesh.rotation.y=a,this.mesh.lookAt(new I(n,this.mesh.position.y,o)),this.mesh.getObjectByName("head").lookAt(new I(n,s,o)),this.animateLegs(1)}animateLegs(t){const n=Math.sin(Date.now()*.005*t*2);this.mesh.children.forEach(s=>{s.isLeg&&(s.rotation.x=n*.2)})}createNameTag(t){const n=document.createElement("canvas");n.width=256,n.height=64;const s=n.getContext("2d");s.fillStyle="white",s.font="24px Arial",s.textAlign="center",s.fillText(t,128,40);const o=new mo(n),r=new Vn({map:o,transparent:!0}),a=new jn(r);return a.scale.set(1.5,.4,1),a.position.set(0,.6,0),a}}class Xc{constructor(i,t,n){m(this,"serverAddress","https://baptiste-texier.ddns.net:3000");this.players={},this.world=i,this.scene=t,this.socket=null,this.chat=n,window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this))}getSocket(){return this.socket}init(){this.socket=Le(this.serverAddress),this.socket.on("connect",i=>{this.chat.add("Connected to server","#FFFF55"),this.socket.emit("join",{username:"Joueur1",position:{x:0,y:71,z:10},direction:{x:0,y:0,z:0}}),this.world.generate()}),this.socket.on("connect_error",i=>{this.chat.add("Unable to connect to server"),this.players={}}),this.socket.on("player-connect",i=>{console.log("Joueurs connects:",i),this.chat.add(i.id+" joined the game","#FFFF55"),this.updatePlayers({[i.id]:i})}),this.socket.on("player-disconnect",i=>{console.log("Joueurs dconnect:",i),this.chat.add(i+" left the game"),this.players[i].removeToScene(this.scene),delete this.players[i]}),this.socket.on("addBlock",i=>{this.world.addBlock(i.x,i.y,i.z,i.blockId,i.direction)}),this.socket.on("removeBlock",i=>{this.world.removeBlock(i.x,i.y,i.z)}),this.socket.on("setBlockInventory",i=>{this.world.setBlockInventory(i.x,i.y,i.z,i.inventory)}),this.socket.on("furnaceUpdate",({x:i,y:t,z:n,inventory:s,state:o})=>{s._furnaceState=o,this.world.setBlockInventory(i,t,n,s)}),this.socket.on("playerState",i=>{this.updatePlayers(i)})}updatePlayers(i){for(let t in i)if(t!=this.socket.id){if(!this.players[t]){const n=new Vc(this.world,new I(10,45,10),i[t].username);n.addToScene(this.scene),this.world.addEntity(n),this.players[t]=n}this.players[t].updatePosition(i[t])}}displayPlayersList(){let i=document.getElementById("playerList");if(this.socket){let t="";t+="<span>"+this.socket.id+"</span><br>";for(const n in this.players)this.players.hasOwnProperty(n)&&(t+="<span>"+n+"</span><br>");i.innerHTML=t,i.style.display="block"}}hidePlayersList(){let i=document.getElementById("playerList");i.style.display="none"}onKeyDown(i){i.code==="KeyL"&&this.displayPlayersList()}onKeyUp(i){i.code==="KeyL"&&this.hidePlayersList()}}class Wc{constructor(){m(this,"content",[]);m(this,"element");this.element=document.getElementById("chat"),window.addEventListener("keydown",this.onKeyDown.bind(this))}add(i,t="#AAAAAA"){this.content.push({msg:i,color:t}),this.display()}display(){let i="";this.content.forEach(t=>{i+='<span style="color: '+t.color+';">'+t.msg+"</span><br>"}),this.element.innerHTML=i,this.element.style.display="block",setTimeout(()=>{this.element.style.display="none"},1e4)}onKeyDown(i){i.code==="KeyT"&&this.display()}}var Jt=function(){var e=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(c){c.preventDefault(),n(++e%i.children.length)},!1);function t(c){return i.appendChild(c.dom),c}function n(c){for(var u=0;u<i.children.length;u++)i.children[u].style.display=u===c?"block":"none";e=c}var s=(performance||Date).now(),o=s,r=0,a=t(new Jt.Panel("FPS","#0ff","#002")),l=t(new Jt.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new Jt.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){r++;var c=(performance||Date).now();if(l.update(c-s,200),c>=o+1e3&&(a.update(r*1e3/(c-o),100),o=c,r=0,h)){var u=performance.memory;h.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return c},update:function(){s=this.end()},domElement:i,setMode:n}};Jt.Panel=function(e,i,t){var n=1/0,s=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,l=48*r,h=3*r,c=2*r,u=3*r,f=15*r,d=74*r,p=30*r,b=document.createElement("canvas");b.width=a,b.height=l,b.style.cssText="width:80px;height:48px";var g=b.getContext("2d");return g.font="bold "+9*r+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=t,g.fillRect(0,0,a,l),g.fillStyle=i,g.fillText(e,h,c),g.fillRect(u,f,d,p),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(u,f,d,p),{dom:b,update:function(v,k){n=Math.min(n,v),s=Math.max(s,v),g.fillStyle=t,g.globalAlpha=1,g.fillRect(0,0,a,f),g.fillStyle=i,g.fillText(o(v)+" "+e+" ("+o(n)+"-"+o(s)+")",h,c),g.drawImage(b,u+r,f,d-r,p,u,f,d-r,p),g.fillRect(u+d-r,f,r,p),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(u+d-r,f,r,o((1-v/k)*p))}}};const ct=new go,F=new bi;F.generate();ct.add(F);ct.fog=new Kn(8429792,F.chunkSize.width*F.drawDistance*.9,F.chunkSize.width*F.drawDistance);const pt=new yo;pt.setPixelRatio(window.devicePixelRatio);pt.setSize(window.innerWidth,window.innerHeight);pt.setClearColor(8429792);pt.shadowMap.enabled=!0;pt.shadowMap.type=wo;document.body.appendChild(pt.domElement);const Qc=document.getElementById("fps"),Jc=document.getElementById("time"),Ys=new Wc,ge=new Xc(F,ct,Ys);F.setClient(ge);const U=new Oo(ct,F,ge),tl=new Yh(ct),Ut=new Xh(U,F,ge);new tc(F,U,Ut,ge,Ys);const el=new Vh(U,Ut),Hn=new ec(ct,U,.2),js=new Fh(F,new I(10,45,10));js.addToScene(ct);F.addEntity(js);const Vs=new qh(F,new I(10,36,10));Vs.addToScene(ct);F.addEntity(Vs);U.setInventory(Ut);U.setUI(el);window.addEventListener("keydown",e=>{e.code==="KeyE"&&(U.controls.isLocked?(U.controls.unlock(),Ut.show()):(U.controls.lock(),Ut.hide()))});window.addEventListener("keydown",e=>{e.code==="KeyF"&&F.entities.forEach(i=>{U.position.distanceTo(i.position)<5&&!U.riding?(U.riding=i,i.driver=U):U.riding&&(U.riding.driver=null,U.riding=null)})});ct.background=new bo(7254527);var ai=performance.now(),Fn=0,hi=0,qn=0;const il=new ko,Xs=new Jt;document.body.appendChild(Xs.dom);let Zn=performance.now();function Ws(){var o;const e=performance.now();il.getDelta();let i=(e-qn)/1e3;tl.update(i,U,F),F.update(U),U.update(F),Ut.update(i),qn=e,F.updateEntities(i),((o=ge.getSocket())==null?void 0:o.connected)||F.updateBlockEntities(i),hi++,e-ai>1e3&&(Fn=Math.round(hi*1e3/(e-ai)),Qc.textContent=`FPS: ${Fn}`,ai=e,hi=0,Jc.textContent=Hn.getTime());const n=performance.now(),s=n-Zn;Zn=n,Hn.update(s),pt.render(ct,U.camera),requestAnimationFrame(Ws),Xs.update()}Ws();document.addEventListener("contextmenu",function(e){e.preventDefault()},!1);window.addEventListener("resize",()=>{const e=window.innerWidth,i=window.innerHeight;pt.setSize(e,i),U.camera.aspect=e/i,U.camera.updateProjectionMatrix()});const Hi=pt.domElement;Hi.style.touchAction="none";const Qs=e=>{e.preventDefault()};Hi.addEventListener("touchstart",Qs,{passive:!1});Hi.addEventListener("touchmove",Qs,{passive:!1});const ze=document.getElementById("mobile-controls");ze&&(ze.style.touchAction="none",ze.addEventListener("touchstart",e=>e.preventDefault(),{passive:!1}),ze.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}));
