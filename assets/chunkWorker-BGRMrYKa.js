var W0=Object.defineProperty;var X0=(H,G,b)=>G in H?W0(H,G,{enumerable:!0,configurable:!0,writable:!0,value:b}):H[G]=b;var a0=(H,G,b)=>X0(H,typeof G!="symbol"?G+"":G,b);(function(){"use strict";class H{constructor(s=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(s.random()*256);this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[t&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(s,t,n){return s[0]*t+s[1]*n}dot3(s,t,n,o){return s[0]*t+s[1]*n+s[2]*o}dot4(s,t,n,o,r){return s[0]*t+s[1]*n+s[2]*o+s[3]*r}noise(s,t){let n,o,r;const c=.5*(Math.sqrt(3)-1),i=(s+t)*c,l=Math.floor(s+i),e=Math.floor(t+i),m=(3-Math.sqrt(3))/6,_=(l+e)*m,k=l-_,p=e-_,w=s-k,v=t-p;let O,R;w>v?(O=1,R=0):(O=0,R=1);const y=w-O+m,z=v-R+m,h=w-1+2*m,f=v-1+2*m,a=l&255,j=e&255,q=this.perm[a+this.perm[j]]%12,u=this.perm[a+O+this.perm[j+R]]%12,g=this.perm[a+1+this.perm[j+1]]%12;let x=.5-w*w-v*v;x<0?n=0:(x*=x,n=x*x*this.dot(this.grad3[q],w,v));let M=.5-y*y-z*z;M<0?o=0:(M*=M,o=M*M*this.dot(this.grad3[u],y,z));let B=.5-h*h-f*f;return B<0?r=0:(B*=B,r=B*B*this.dot(this.grad3[g],h,f)),70*(n+o+r)}noise3d(s,t,n){let o,r,c,i;const e=(s+t+n)*.3333333333333333,m=Math.floor(s+e),_=Math.floor(t+e),k=Math.floor(n+e),p=1/6,w=(m+_+k)*p,v=m-w,O=_-w,R=k-w,y=s-v,z=t-O,h=n-R;let f,a,j,q,u,g;y>=z?z>=h?(f=1,a=0,j=0,q=1,u=1,g=0):y>=h?(f=1,a=0,j=0,q=1,u=0,g=1):(f=0,a=0,j=1,q=1,u=0,g=1):z<h?(f=0,a=0,j=1,q=0,u=1,g=1):y<h?(f=0,a=1,j=0,q=0,u=1,g=1):(f=0,a=1,j=0,q=1,u=1,g=0);const x=y-f+p,M=z-a+p,B=h-j+p,X=y-q+2*p,A=z-u+2*p,J=h-g+2*p,K=y-1+3*p,L=z-1+3*p,T=h-1+3*p,N=m&255,Y=_&255,E=k&255,i0=this.perm[N+this.perm[Y+this.perm[E]]]%12,c0=this.perm[N+f+this.perm[Y+a+this.perm[E+j]]]%12,l0=this.perm[N+q+this.perm[Y+u+this.perm[E+g]]]%12,r0=this.perm[N+1+this.perm[Y+1+this.perm[E+1]]]%12;let V=.6-y*y-z*z-h*h;V<0?o=0:(V*=V,o=V*V*this.dot3(this.grad3[i0],y,z,h));let C=.6-x*x-M*M-B*B;C<0?r=0:(C*=C,r=C*C*this.dot3(this.grad3[c0],x,M,B));let D=.6-X*X-A*A-J*J;D<0?c=0:(D*=D,c=D*D*this.dot3(this.grad3[l0],X,A,J));let I=.6-K*K-L*L-T*T;return I<0?i=0:(I*=I,i=I*I*this.dot3(this.grad3[r0],K,L,T)),32*(o+r+c+i)}noise4d(s,t,n,o){const r=this.grad4,c=this.simplex,i=this.perm,l=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20;let m,_,k,p,w;const v=(s+t+n+o)*l,O=Math.floor(s+v),R=Math.floor(t+v),y=Math.floor(n+v),z=Math.floor(o+v),h=(O+R+y+z)*e,f=O-h,a=R-h,j=y-h,q=z-h,u=s-f,g=t-a,x=n-j,M=o-q,B=u>g?32:0,X=u>x?16:0,A=g>x?8:0,J=u>M?4:0,K=g>M?2:0,L=x>M?1:0,T=B+X+A+J+K+L,N=c[T][0]>=3?1:0,Y=c[T][1]>=3?1:0,E=c[T][2]>=3?1:0,i0=c[T][3]>=3?1:0,c0=c[T][0]>=2?1:0,l0=c[T][1]>=2?1:0,r0=c[T][2]>=2?1:0,V=c[T][3]>=2?1:0,C=c[T][0]>=1?1:0,D=c[T][1]>=1?1:0,I=c[T][2]>=1?1:0,v0=c[T][3]>=1?1:0,d0=u-N+e,m0=g-Y+e,f0=x-E+e,h0=M-i0+e,u0=u-c0+2*e,g0=g-l0+2*e,b0=x-r0+2*e,p0=M-V+2*e,y0=u-C+3*e,x0=g-D+3*e,M0=x-I+3*e,k0=M-v0+3*e,z0=u-1+4*e,_0=g-1+4*e,j0=x-1+4*e,w0=M-1+4*e,P=O&255,Q=R&255,U=y&255,Z=z&255,D0=i[P+i[Q+i[U+i[Z]]]]%32,I0=i[P+N+i[Q+Y+i[U+E+i[Z+i0]]]]%32,N0=i[P+c0+i[Q+l0+i[U+r0+i[Z+V]]]]%32,Y0=i[P+C+i[Q+D+i[U+I+i[Z+v0]]]]%32,E0=i[P+1+i[Q+1+i[U+1+i[Z+1]]]]%32;let $=.6-u*u-g*g-x*x-M*M;$<0?m=0:($*=$,m=$*$*this.dot4(r[D0],u,g,x,M));let S=.6-d0*d0-m0*m0-f0*f0-h0*h0;S<0?_=0:(S*=S,_=S*S*this.dot4(r[I0],d0,m0,f0,h0));let t0=.6-u0*u0-g0*g0-b0*b0-p0*p0;t0<0?k=0:(t0*=t0,k=t0*t0*this.dot4(r[N0],u0,g0,b0,p0));let s0=.6-y0*y0-x0*x0-M0*M0-k0*k0;s0<0?p=0:(s0*=s0,p=s0*s0*this.dot4(r[Y0],y0,x0,M0,k0));let e0=.6-z0*z0-_0*_0-j0*j0-w0*w0;return e0<0?w=0:(e0*=e0,w=e0*e0*this.dot4(r[E0],z0,_0,j0,w0)),27*(m+_+k+p+w)}}class G{constructor(s){a0(this,"m_w",123456789);a0(this,"m_z",987654321);a0(this,"mask",4294967295);this.m_w=123456789+s&this.mask,this.m_z=987654321-s&this.mask}random(){this.m_z=36969*(this.m_z&65535)+(this.m_z>>16)&this.mask,this.m_w=18e3*(this.m_w&65535)+(this.m_w>>16)&this.mask;let s=(this.m_z<<16)+(this.m_w&65535)>>>0;return s/=4294967296,s}}const b={empty:{id:0,name:"empty",visible:!1},grass:{id:1,name:"grass"},dirt:{id:2,name:"dirt"},bedrock:{id:7,name:"bedrock"},sand:{id:12,name:"sand"},gravel:{id:13,name:"gravel"},stone:{id:3,name:"stone",scale:{x:30,y:30,z:30},scarcity:.8},coalOre:{id:16,name:"coal_ore",scale:{x:20,y:20,z:20},scarcity:.8},ironOre:{id:15,name:"iron_ore",scale:{x:40,y:40,z:40},scarcity:.9},diamondOre:{id:56,name:"diamond_ore",scale:{x:40,y:40,z:40},scarcity:.99},log:{id:17,name:"log"},leaves:{id:18,name:"leaves"},craftingTable:{id:58,name:"Crafting Table"}},T0=[b.coalOre,b.ironOre,b.diamondOre];let W=[],o0=[];self.onmessage=function(d){const{chunkData:s,chunkSize:t,chunkHeight:n,params:o,position:r}=d.data,c=new G(o.seed);O0(t,n),R0(t),q0(t,n,o,c,r),self.postMessage({data:W,biomes:o0})};function O0(d,s){for(let t=0;t<d;t++){const n=[];for(let o=0;o<s;o++){const r=[];for(let c=0;c<d;c++)r.push({id:0,instanceId:null});n.push(r)}W.push(n)}}function R0(d){for(let s=0;s<d;s++){let t=[];for(let n=0;n<d;n++)t.push({});o0.push(t)}}function q0(d,s,t,n,o){var c,i;const r=new H(n);for(let l=0;l<d;l++)for(let e=0;e<d;e++){let m=C0(r,l,e,o),_=m.biome1,k=_,p=m.biome2,w=m.blend;const v=t.biomes[_].scale,O=r.noise((o.x+l)/v,(o.z+e)/v);let R=t.biomes[_].offset+t.biomes[_].magnitude*O;const y=t.biomes[p].scale,z=r.noise((o.x+l)/y,(o.z+e)/y);let h=t.biomes[p].offset+t.biomes[p].magnitude*z,f=Math.floor(V0(R,h,w)*s);f=Math.max(1,Math.min(f,s-1)),typeof o0[l][e]<"u"&&(o0[l][e]=_);for(let a=0;a<s;a++)if(a<f&&a>f-3&&((c=n0(l,a,e))==null?void 0:c.id)===b.empty.id&&F(l,a,e,b.dirt.id),a==0)F(l,a,e,b.bedrock.id);else if(a<f&&((i=n0(l,a,e))==null?void 0:i.id)===b.empty.id)F(l,a,e,b.stone.id),H0(n,l,a,e,o);else if(a==f){k=="plains"||k=="forest"||k=="mountains"?F(l,a,e,b.grass.id):F(l,a,e,b.sand.id);let j=1;k=="forest"&&(j=6),k=="mountains"&&(j=.5),k!="desert"&&Math.random()<t.trees.frequency*j&&F0(t.seed,1,l,f+1,e,t)}}}function F(d,s,t,n){W[d][s][t].id=n}function n0(d,s,t){return B0(d,s,t)&&typeof W[d]<"u"?W[d][s][t]:null}function B0(d,s,t){return d>=0&&d<16&&t>=0&&t<16&&s>=0&&s<80}function F0(d,s,t,n,o,r){const c=r.trees.trunk.minHeight,i=r.trees.trunk.maxHeight,l=Math.round(c+(i-c)*Math.random()+1);for(let e=n;e<n+l;e++)F(t,e,o,b.log.id);G0(s,t,n+l,o,r)}function G0(d,s,t,n,o){const r=o.trees.canopy.minRadius,c=o.trees.canopy.maxRadius,i=Math.round(r+(c-r)*Math.random());for(let l=-i;l<=i;l++)for(let e=-i;e<=i;e++)for(let m=-i;m<=i;m++){const _=Math.random();if(l*l+e*e+m*m>i*i)continue;const k=n0(s+l,t+e,n+m);k&&k.id!==b.empty.id||_<o.trees.canopy.density&&n0(s+l,t+e,n+m)!==null&&F(s+l,t+e,n+m,b.leaves.id)}}function H0(d,s,t,n,o){const r=new H(d);T0.forEach(c=>{r.noise((o.x+s)/c.scale.x,(o.y+t)/c.scale.y,(o.z+n)/c.scale.z)>c.scarcity&&F(s,t,n,c.id)})}function V0(d,s,t){return d+t*(s-d)}function C0(d,s,t,n){let o=d.noise((n.x+s)/500,(n.z+t)/500);return o+=.2*d.noise((n.x+s)/250,(n.z+t)/250),o=(o+1)/2,o<.2?{biome1:"desert",biome2:"plains",blend:(o-.1)/.1}:o<.4?{biome1:"plains",biome2:"forest",blend:(o-.2)/.2}:o<.6?{biome1:"forest",biome2:"mountains",blend:(o-.4)/.2}:{biome1:"mountains",biome2:"mountains",blend:(o-.6)/.4}}})();
