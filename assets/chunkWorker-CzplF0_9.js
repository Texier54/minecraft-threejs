var N0=Object.defineProperty;var Y0=(I,G,u)=>G in I?N0(I,G,{enumerable:!0,configurable:!0,writable:!0,value:u}):I[G]=u;var l0=(I,G,u)=>Y0(I,typeof G!="symbol"?G+"":G,u);(function(){"use strict";class I{constructor(e){l0(this,"m_w",123456789);l0(this,"m_z",987654321);l0(this,"mask",4294967295);this.m_w=123456789+e&this.mask,this.m_z=987654321-e&this.mask}random(){this.m_z=36969*(this.m_z&65535)+(this.m_z>>16)&this.mask,this.m_w=18e3*(this.m_w&65535)+(this.m_w>>16)&this.mask;let e=(this.m_z<<16)+(this.m_w&65535)>>>0;return e/=4294967296,e}}class G{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(e.random()*256);this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[t&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,n){return e[0]*t+e[1]*n}dot3(e,t,n,s){return e[0]*t+e[1]*n+e[2]*s}dot4(e,t,n,s,o){return e[0]*t+e[1]*n+e[2]*s+e[3]*o}noise(e,t){let n,s,o;const a=.5*(Math.sqrt(3)-1),i=(e+t)*a,p=Math.floor(e+i),l=Math.floor(t+i),h=(3-Math.sqrt(3))/6,y=(p+l)*h,f=p-y,r=l-y,_=e-f,z=t-r;let b,q;_>z?(b=1,q=0):(b=0,q=1);const w=_-b+h,x=z-q+h,M=_-1+2*h,v=z-1+2*h,j=p&255,T=l&255,B=this.perm[j+this.perm[T]]%12,m=this.perm[j+b+this.perm[T+q]]%12,c=this.perm[j+1+this.perm[T+1]]%12;let g=.5-_*_-z*z;g<0?n=0:(g*=g,n=g*g*this.dot(this.grad3[B],_,z));let k=.5-w*w-x*x;k<0?s=0:(k*=k,s=k*k*this.dot(this.grad3[m],w,x));let F=.5-M*M-v*v;return F<0?o=0:(F*=F,o=F*F*this.dot(this.grad3[c],M,v)),70*(n+s+o)}noise3d(e,t,n){let s,o,a,i;const l=(e+t+n)*.3333333333333333,h=Math.floor(e+l),y=Math.floor(t+l),f=Math.floor(n+l),r=1/6,_=(h+y+f)*r,z=h-_,b=y-_,q=f-_,w=e-z,x=t-b,M=n-q;let v,j,T,B,m,c;w>=x?x>=M?(v=1,j=0,T=0,B=1,m=1,c=0):w>=M?(v=1,j=0,T=0,B=1,m=0,c=1):(v=0,j=0,T=1,B=1,m=0,c=1):x<M?(v=0,j=0,T=1,B=0,m=1,c=1):w<M?(v=0,j=1,T=0,B=0,m=1,c=1):(v=0,j=1,T=0,B=1,m=1,c=0);const g=w-v+r,k=x-j+r,F=M-T+r,E=w-B+2*r,W=x-m+2*r,X=M-c+2*r,A=w-1+3*r,J=x-1+3*r,O=M-1+3*r,L=h&255,N=y&255,Y=f&255,n0=this.perm[L+this.perm[N+this.perm[Y]]]%12,o0=this.perm[L+v+this.perm[N+j+this.perm[Y+T]]]%12,i0=this.perm[L+B+this.perm[N+m+this.perm[Y+c]]]%12,c0=this.perm[L+1+this.perm[N+1+this.perm[Y+1]]]%12;let H=.6-w*w-x*x-M*M;H<0?s=0:(H*=H,s=H*H*this.dot3(this.grad3[n0],w,x,M));let V=.6-g*g-k*k-F*F;V<0?o=0:(V*=V,o=V*V*this.dot3(this.grad3[o0],g,k,F));let C=.6-E*E-W*W-X*X;C<0?a=0:(C*=C,a=C*C*this.dot3(this.grad3[i0],E,W,X));let D=.6-A*A-J*J-O*O;return D<0?i=0:(D*=D,i=D*D*this.dot3(this.grad3[c0],A,J,O)),32*(s+o+a+i)}noise4d(e,t,n,s){const o=this.grad4,a=this.simplex,i=this.perm,p=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let h,y,f,r,_;const z=(e+t+n+s)*p,b=Math.floor(e+z),q=Math.floor(t+z),w=Math.floor(n+z),x=Math.floor(s+z),M=(b+q+w+x)*l,v=b-M,j=q-M,T=w-M,B=x-M,m=e-v,c=t-j,g=n-T,k=s-B,F=m>c?32:0,E=m>g?16:0,W=c>g?8:0,X=m>k?4:0,A=c>k?2:0,J=g>k?1:0,O=F+E+W+X+A+J,L=a[O][0]>=3?1:0,N=a[O][1]>=3?1:0,Y=a[O][2]>=3?1:0,n0=a[O][3]>=3?1:0,o0=a[O][0]>=2?1:0,i0=a[O][1]>=2?1:0,c0=a[O][2]>=2?1:0,H=a[O][3]>=2?1:0,V=a[O][0]>=1?1:0,C=a[O][1]>=1?1:0,D=a[O][2]>=1?1:0,j0=a[O][3]>=1?1:0,r0=m-L+l,a0=c-N+l,f0=g-Y+l,m0=k-n0+l,d0=m-o0+2*l,h0=c-i0+2*l,u0=g-c0+2*l,b0=k-H+2*l,g0=m-V+3*l,p0=c-C+3*l,y0=g-D+3*l,M0=k-j0+3*l,x0=m-1+4*l,k0=c-1+4*l,z0=g-1+4*l,w0=k-1+4*l,K=b&255,P=q&255,Q=w&255,U=x&255,V0=i[K+i[P+i[Q+i[U]]]]%32,C0=i[K+L+i[P+N+i[Q+Y+i[U+n0]]]]%32,D0=i[K+o0+i[P+i0+i[Q+c0+i[U+H]]]]%32,I0=i[K+V+i[P+C+i[Q+D+i[U+j0]]]]%32,L0=i[K+1+i[P+1+i[Q+1+i[U+1]]]]%32;let Z=.6-m*m-c*c-g*g-k*k;Z<0?h=0:(Z*=Z,h=Z*Z*this.dot4(o[V0],m,c,g,k));let $=.6-r0*r0-a0*a0-f0*f0-m0*m0;$<0?y=0:($*=$,y=$*$*this.dot4(o[C0],r0,a0,f0,m0));let S=.6-d0*d0-h0*h0-u0*u0-b0*b0;S<0?f=0:(S*=S,f=S*S*this.dot4(o[D0],d0,h0,u0,b0));let t0=.6-g0*g0-p0*p0-y0*y0-M0*M0;t0<0?r=0:(t0*=t0,r=t0*t0*this.dot4(o[I0],g0,p0,y0,M0));let e0=.6-x0*x0-k0*k0-z0*z0-w0*w0;return e0<0?_=0:(e0*=e0,_=e0*e0*this.dot4(o[L0],x0,k0,z0,w0)),27*(h+y+f+r+_)}}const u={empty:{id:0,name:"empty",visible:!1},grass:{id:1,name:"grass"},dirt:{id:2,name:"dirt"},bedrock:{id:7,name:"bedrock"},sand:{id:12,name:"sand"},gravel:{id:13,name:"gravel"},stone:{id:3,name:"stone",scale:{x:30,y:30,z:30},scarcity:.8},coalOre:{id:16,name:"coal_ore",scale:{x:20,y:20,z:20},scarcity:.8},ironOre:{id:15,name:"iron_ore",scale:{x:40,y:40,z:40},scarcity:.9},diamondOre:{id:56,name:"diamond_ore",scale:{x:40,y:40,z:40},scarcity:.99},log:{id:17,name:"log"},leaves:{id:18,name:"leaves"},craftingTable:{id:58,name:"Crafting Table"},cactus:{id:81,name:"cactus"},water:{id:9,name:"water"},sandstone:{id:24,name:"sandstone"}},v0=[u.coalOre,u.ironOre,u.diamondOre];function T0(d,e){let t=[];for(let n=0;n<d;n++){const s=[];for(let o=0;o<e;o++){const a=[];for(let i=0;i<d;i++)a.push({id:0,instanceId:null,inventory:null,direction:{x:0,y:0,z:0}});s.push(a)}t.push(s)}return t}function O0(d){let e=[];for(let t=0;t<d;t++){let n=[];for(let s=0;s<d;s++)n.push({});e.push(n)}return e}function R0(d,e,t,n,s,o,a){var l,h,y;const i=new G(n),p=t.seaLevel;for(let f=0;f<d;f++)for(let r=0;r<d;r++){let _=G0(i,f,r,s),z=_.biome1,b=z,q=_.biome2,w=_.blend;const x=t.biomes[z].scale,M=i.noise((s.x+f)/x,(s.z+r)/x);let v=t.biomes[z].offset+t.biomes[z].magnitude*M;const j=t.biomes[q].scale,T=i.noise((s.x+f)/j,(s.z+r)/j);let B=t.biomes[q].offset+t.biomes[q].magnitude*T,m=Math.floor(H0(v,B,w)*e);m=Math.max(1,Math.min(m,e-1)),typeof a[f][r]<"u"&&(a[f][r]=z);for(let c=0;c<e;c++)if(c<m&&c>m-3&&((l=s0(o,f,c,r))==null?void 0:l.id)===u.empty.id&&(b=="desert"||b=="beach"?R(o,f,c,r,u.sandstone.id):R(o,f,c,r,u.dirt.id)),c==0)R(o,f,c,r,u.bedrock.id);else if(c<m&&((h=s0(o,f,c,r))==null?void 0:h.id)===u.empty.id)R(o,f,c,r,u.stone.id),F0(n,f,c,r,s,o);else if(c==m){b=="plains"||b=="forest"||b=="mountains"?R(o,f,c,r,u.grass.id):(b=="beach",R(o,f,c,r,u.sand.id));let g=1;b=="forest"&&(g=6),b=="mountains"&&(g=.5),b!="ocean"&&b!="beach"&&Math.random()<t.trees.frequency*g&&q0(t.seed,b,f,m+1,r,t,o)}else b==="ocean"&&c<m?R(o,f,c,r,u.stone.id):b==="ocean"&&c>=m&&c<p&&R(o,f,c,r,(y=u.water)==null?void 0:y.id)}return{data:o,biomes:a}}function R(d,e,t,n,s){_0(e,t,n)&&(d[e][t][n].id=s)}function s0(d,e,t,n){return _0(e,t,n)&&typeof d[e]<"u"?d[e][t][n]:null}function _0(d,e,t){return d>=0&&d<16&&t>=0&&t<16&&e>=0&&e<80}function q0(d,e,t,n,s,o,a){const i=o.trees.trunk.minHeight,p=o.trees.trunk.maxHeight,l=Math.round(i+(p-i)*Math.random()+1);for(let h=n;h<n+l;h++)e=="desert"?R(a,t,h,s,u.cactus.id):R(a,t,h,s,u.log.id);e!="desert"&&B0(e,t,n+l,s,o,a)}function B0(d,e,t,n,s,o){const a=s.trees.canopy.minRadius,i=s.trees.canopy.maxRadius,p=Math.round(a+(i-a)*Math.random());for(let l=-p;l<=p;l++)for(let h=-p;h<=p;h++)for(let y=-p;y<=p;y++){const f=Math.random();if(l*l+h*h+y*y>p*p)continue;const r=s0(o,e+l,t+h,n+y);r&&r.id!==u.empty.id||f<s.trees.canopy.density&&s0(o,e+l,t+h,n+y)!==null&&R(o,e+l,t+h,n+y,u.leaves.id)}}function F0(d,e,t,n,s,o){const a=new G(d);v0.forEach(i=>{a.noise((s.x+e)/i.scale.x,(s.y+t)/i.scale.y,(s.z+n)/i.scale.z)>i.scarcity&&R(o,e,t,n,i.id)})}function G0(d,e,t,n){let s=d.noise((n.x+e)/500,(n.z+t)/500);return s+=.2*d.noise((n.x+e)/250,(n.z+t)/250),s=(s+1)/2,s<.07?{biome1:"ocean",biome2:"ocean",blend:0}:s<.09?{biome1:"ocean",biome2:"beach",blend:(s-.07)/.02}:s<.115?{biome1:"beach",biome2:"plains",blend:(s-.09)/.025}:s<.2?{biome1:"plains",biome2:"desert",blend:(s-.09)/.11}:s<.4?{biome1:"desert",biome2:"forest",blend:(s-.2)/.2}:s<.6?{biome1:"forest",biome2:"mountains",blend:(s-.4)/.2}:{biome1:"mountains",biome2:"mountains",blend:(s-.6)/.4}}function H0(d,e,t){return d+t*(e-d)}self.onmessage=function(d){const{chunkData:e,chunkSize:t,chunkHeight:n,params:s,position:o}=d.data,a=new I(s.seed),i=T0(t,n),p=O0(t),l=R0(t,n,s,a,o,i,p);self.postMessage({data:l.data,biomes:l.biomes})}})();
